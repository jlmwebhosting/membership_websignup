{"name":"Membership websignup","tagline":"","body":"Welcome to Membership Web Signup\r\n\r\nmembership_websignup.info:\r\n\r\n; $Id $\r\nname = Websignup\r\ncore = 7.x\r\n\r\nmembership_websignup.module:\r\n\r\n<?php\r\n\tdefine(\"WEBSIGNUP_API\", \"http://10.0.0.127/ava/\");\r\n\trequire_once(\"ChromePhp.php\");\r\n\tfunction ava_websignup_menu() {\r\n\t\t\r\n\t\t$items['web_signup/%/review'] = array(\r\n\t\t'title' => t('Membership and Web sign-up - Review'),\r\n\t\t'page callback' => 'drupal_get_form',\r\n\t\t'page arguments' => array('ava_web_signup_review_form', 1),\r\n\t\t'access callback'  => 'user_access',\r\n\t\t'access arguments' => array('administer admin membership and web sign-up'),\r\n\t\t'description' => t('Form for web sign-up'),\r\n\t\t'file' => 'web_signup_review.inc',\r\n\t\t'type' => MENU_NORMAL_ITEM,\r\n\t  );\r\n\t  \r\n\t  return $items;\r\n\t}\r\n\t\r\n\tfunction ava_websignup_permission() {\r\n\t  return array(\r\n\t\t'administer admin membership and web sign-up' => array(\r\n\t\t  'title' => t('Administer membership and web sign-up module settings'),\r\n\t\t  'description' => t('This is a custom admin permission for membership and web sign-up'),\r\n\t\t),\r\n\t  );\r\n\t}\r\n\t\r\n\tfunction ava_websignup_api_call($method, $url, $data = false){\r\n\t\t$curl = curl_init();\r\n\r\n\t\tswitch ($method)\r\n\t\t{\r\n\t\t\tcase \"POST\":\r\n\t\t\t\tcurl_setopt($curl, CURLOPT_POST, 1);\r\n\r\n\t\t\t\tif ($data)\r\n\t\t\t\t\tcurl_setopt($curl, CURLOPT_POSTFIELDS, $data);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"PUT\":\r\n\t\t\t\tcurl_setopt($curl, CURLOPT_PUT, 1);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tif ($data)\r\n\t\t\t\t\t$url = sprintf(\"%s?%s\", $url, http_build_query($data));\r\n\t\t}\r\n\r\n\t\t//curl_setopt($curl, CURLOPT_HTTPHEADER, array(\"Content-type: application/json\",  'Content-Length: ' . strlen($data), 'Expect: '));\r\n\t\t//curl_setopt($curl, CURLOPT_FOLLOWLOCATION, 1); \r\n\t\tcurl_setopt($curl, CURLOPT_URL, WEBSIGNUP_API.$url);\r\n\t\tcurl_setopt($curl, CURLOPT_RETURNTRANSFER, 1);\r\n\t\t\r\n\t\treturn curl_exec($curl);\r\n\t}\r\n\t\r\n\t\r\n\tfunction ava_websignup_webform_submission_presave($node, &$submission){\r\n\t\t\t\r\n\t} \r\n\t\r\n\t\r\n\tfunction ava_websignup_application_calculate_price($submission, $node){\r\n\t\t\r\n\t\t$all_payment = $submission->data[85]['value'];\r\n\t\t\t\t\r\n\t\t$total = 0;\r\n\t\t\r\n\t\tforeach($submission->data[51]['value'] as $sig){\r\n\t\t\t$total += $all_payment[$sig];\r\n\t\t}\r\n\t\t\r\n\t\t$total += $all_payment[$submission->data[64]['value'][0]]; //this is for national subscription\r\n\t\t$total += $all_payment[$submission->data[63]['value'][0]]; //this is for national subscription\r\n\t\t\t\t\r\n\t\r\n\t\treturn $total; \r\n\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * Calculate the description for the cart from a webform submission\r\n\t * @param $webform_id\r\n\t *     The nid of the webform\r\n\t * @param $submission_id\r\n\t *     The submission id of the webform\r\n\t * @return\r\n\t *     The price of the application\r\n\t */\r\n\tfunction ava_websignup_application_calculate_description($submission, $node) {\r\n\t\t\t\t\r\n\t\t$description = '';\r\n\t  \r\n\t\t$all_payment = $submission->data[85]['value'];\r\n\t\t$all_title = $submission->data[86]['value'];\t\r\n\r\n\t\t$description .= $all_title[$submission->data[64]['value'][0]] . ': ' . uc_currency_format($all_payment[$submission->data[64]['value'][0]]) . '<br />'; //national subscription\r\n\t\t$description .= $all_title[$submission->data[63]['value'][0]] . ': ' . uc_currency_format($all_payment[$submission->data[63]['value'][0]]) . '<br />'; //chapter\r\n\t\t\r\n\t\tforeach($submission->data[51]['value'] as $sig){\r\n\t\t\t $description .= $all_title[$sig] . ': ' . uc_currency_format($all_payment[$sig]) . '<br />'; //sig\r\n\t\t}\r\n\r\n\t\treturn $description;\r\n\t}\r\n\t\r\n\tfunction ava_websignup_webform_submission_insert($node, $submission) {\r\n\t\t\r\n\t\t$node1 = new stdClass();\r\n\t\t$node1->type = 'ava_membership_application';\r\n\t\tnode_object_prepare($node1);\r\n\t\t$node1->title = t('Membership application (Application ID !id)', array('!id' => $submission->sid));\r\n\t\t$node1->language = LANGUAGE_NONE;\r\n\t\t// Modified here\r\n\t\t// $node->webform_id = $submission_info->nid;\r\n\t\t$node1->webform_id = $submission->nid;\r\n\t\t$node1->submission_id = $submission->sid; //$sid;\r\n\t\t// $node->uid = $submission_info->uid;\r\n\t\t$node1->uid = $submission->uid;\r\n\r\n\t\t/* Trapped MalformedEntity in DRUPAL 7 */\r\n\t\t$node1->model = 'MEMBERSHIP/'.$submission->sid; \r\n\t\t$node1->list_price = ava_websignup_application_calculate_price($submission, $node);\r\n\t\t$node1->cost = ava_websignup_application_calculate_price($submission, $node);\r\n\t\t$node1->sell_price = ava_websignup_application_calculate_price($submission, $node);\r\n\t\t$node1->default_qty = 1;\r\n\t\t$node1->pkg_qty = 1;\r\n\t\t$node1->length =0;\r\n\t\t$node1->width = 0;\r\n\t\t$node1->height = 0;\r\n\t\t$node1->shippable = 0;\r\n\t\t\r\n\t\t$node1->status = 1;\r\n\t\t\r\n\t//\tprint_r($node); die();\r\n\t\tnode_save($node1);\r\n\t\t\r\n\t\tif ($node->nid == 61802) {\r\n\t\t\tif($submission->data[58]['value'][0] == \"PBTM\"){\r\n\t\t\t\t\r\n\t\t\t\t$result = webform_get_submission($node1->webform_id,$node1->submission_id);\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tswitch ($result->data[65]['value'][0]){\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\t$title = \"Miss\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\t$title = \"Mr\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\t$title = \"Mrs\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\t$title = \"Ms\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 4:\r\n\t\t\t\t\t\t$title = \"Dr\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 5:\r\n\t\t\t\t\t\t$title = \"Prof\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t$title = \"Dr\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\r\n\t\t\t\t$middle_name = $result->data[6]['value'][0] != \"\" ? strtoupper(substr($result->data[6]['value'][0], 0, 1)).\". \" : \" \";\r\n\t\t\t\t\r\n\t\t\t\t$all_payment = $result->data[85]['value'];\r\n\t\t\t\t$all_title = $result->data[86]['value'];\r\n\t\t\t\t$total12 = 0;\r\n\t\t\t\t$a1_national_price = $all_payment[$result->data[64]['value'][0]];\r\n\t\t\t\t$chapt_price = $all_payment[$result->data[63]['value'][0]];\r\n\t\t\t\t$total12 += $all_payment[$result->data[64]['value'][0]];\r\n\t\t\t\t$total12 += $all_payment[$result->data[63]['value'][0]];\r\n\t\t\t\t$subscriptions_details = '<tr>\r\n\t\t\t\t\t<td>'.$all_title[$result->data[64]['value'][0]].'</td>\r\n\t\t\t\t\t<td align=\"right\">'.uc_currency_format($all_payment[$result->data[64]['value'][0]]).'</td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td>'.$all_title[$result->data[63]['value'][0]].'</td>\r\n\t\t\t\t\t<td align=\"right\">'.uc_currency_format($all_payment[$result->data[63]['value'][0]]).'</td>\r\n\t\t\t\t</tr>';\r\n\t\t\t\t\r\n\t\t\t\tforeach ($result->data[51]['value'] as $value){\r\n\t\t\t\t\t$subscriptions_details .= '<tr>\r\n\t\t\t\t\t\t\t<td>'.$all_title[$value].'</td>\r\n\t\t\t\t\t\t\t<td align=\"right\">'.uc_currency_format($all_payment[$value]).'</td>\r\n\t\t\t\t\t\t</tr>';\r\n\t\t\t\t\t$total12 += $all_payment[$value];\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t$html = '<!DOCTYPE HTML PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\"><html xml:lang=\"en\" xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"en\"><head><meta http-equiv=\"content-type\" content=\"text/html; charset=UTF-8\"><title>Direct Debit (DDR) Request</title><style type=\"text/css\">html,body,h1{margin: 0;}body{font-size: 12px;font-family: Arial;padding: 40px 20px;}.container{border: 1px solid #000;padding: 10px 10px 10px 20px;page-break-after: always;}table{width: 100%;}hr{border: none;border-bottom: 1px solid #000;}ol{padding: 0 10px 0 20px;}ol li{margin: 0 0 10px 0;line-height: 1.25;}.abc-list{list-style-type: lower-alpha;}.abc-list li{margin: 4px 0;}.invisible{visiblity: hidden;position: absolute;left: 999px;}.unstyled{list-style: none;}.ib{display: inline-block;vertical-align: bottom;}.tfield{border: 1px solid #000;height: 13px;padding: 5px;}.pt-24{padding: 24px 0 0 0;}</style></head><body><img src=\"http://www.ava.com.au/sites/default/files/AVATheme_logo.gif\"><br><br><div class=\"container\"  ><h1>Direct Debit (DDR) Request</h1><br><br><br><br><table><tbody><tr><td rowspan=\"3\" width=\"106\" valign=\"top\"><strong>Customer\\'s <br>Authority</strong></td><td><strong>I/We</strong>&nbsp;&nbsp;<span class=\"ib\">Name of Customer/s giving the DDR<div class=\"tfield\" style=\"width:520px;\">'.$title.\". \".$result->data[4]['value'][0].\" \".$middle_name.\" \".$result->data[5]['value'][0].'</div></span></td></tr><tr><td><table><tbody><tr><td valign=\"bottom\"><strong>authorise and request the</strong><span class=\"ib\">Name of Debit User<div class=\"tfield\" style=\"width:230px;\">The Australian Veterinary Association Ltd</div></span></td><td valign=\"bottom\"><span class=\"ib\">APCA User<br/>ID number<div class=\"tfield\" style=\"width:100px;\">402563</div></span></td></tr></tbody></table></td></tr><tr><td><strong>until further notice in writing, to arrange for funds to be debited through the Bulk Electronic Clearing System (BECS) from my/our account at the Financial Institution identified below as instructed by me/us or any other amounts as instructed or authorised to be debited in accordance with the terms and conditions of the Direct Debit Request Service Agreement (DDRSA) as amended from time to time.</strong></td></tr></tbody></table><hr/><table><tbody><tr><td width=\"106\" valign=\"top\"><strong>Payment Details</strong></td><td rowspan=\"2\">This authority allows the debiting of amounts payable by the Customer under the Agreement between the Customer and <strong>The Australian Veterinary Association Ltd</strong></td></tr><tr><td></td></tr></tbody></table><hr/><table><tbody><tr><td rowspan=\"4\" valign=\"top\" width=\"106\"><strong>Details of the<br/>Account to be<br/>debited</strong><br/>All details must be<br/>supplied</td><td valign=\"top\"><table><tbody><tr><td valign=\"bottom\" width=\"50%\"><span class=\"ib\">Name of the Financial Institution<div class=\"tfield\" style=\"width:230px;\"></div></span></td><td valign=\"bottom\" width=\"50%\"><span class=\"ib\">Branch name<div class=\"tfield\" style=\"width:230px;\"></div></span></td></tr></tbody></table></td></tr><tr><td valign=\"top\"><span class=\"ib\">Account name (please insert your name in full)<div class=\"tfield\" style=\"width:550px;\"></div></span></td></tr><tr><td valign=\"top\"><table><tbody><tr><td valign=\"bottom\" width=\"20%\"><span class=\"ib\">BSB number<div class=\"tfield\" style=\"width:80px;\"></div></span></td><td valign=\"bottom\" width=\"30%\"><span class=\"ib\">Account number<div class=\"tfield\" style=\"width:130px;\"></div></span></td><td valign=\"bottom\" width=\"40%\"><span class=\"ib\">ABN/ARBN (if applicable)<div class=\"tfield\" style=\"width:160px;\"></div></span></td></tr></tbody></table></td></tr><tr><td><strong>Note:</strong> Direct debiting is not available on the full range of accounts. If in doubt, please refer to your bank/financial institution.</td></tr></tbody></table><hr/><hr/><table><tbody><tr><td width=\"106\" valign=\"top\" rowspan=\"3\"><strong>Customer<br/>Authorisation</strong><br/>If in join name/s<br/>both signatures<br/>may be required</td><td>By signing below, I/we acknowledge that this Direct Debit arrangement is governed by the terms of Authorisation the DDRSA attached to this request.<br/><br/></td></tr><tr><td><table><tbody><tr><td valign=\"bottom\" width=\"50%\"><span class=\"ib\">Signature<div class=\"tfield\" style=\"width:230px;\"></div></span></td><td valign=\"bottom\" width=\"50%\"><span class=\"ib\">Signature<div class=\"tfield\" style=\"width:230px;\"></div></span></td></tr></tbody></table></td></tr><tr><td><table><tbody><tr><td valign=\"bottom\" width=\"50%\"><span class=\"ib\">Date<div class=\"tfield\" style=\"width:130px;\"></div></span></td><td valign=\"bottom\" width=\"50%\"><span class=\"ib\">Date<div class=\"tfield\" style=\"width:130px;\"></div></span></td></tr></tbody></table></td></tr></tbody></table><br/><br/><br/><div align=\"center\"><strong>Once signed, this request should be returned to the AVA by facsimile on 02 9437 9068</strong></div></div><br/><div class=\"container\" ><h2>Direct Debit Request Service Agreement (DDRSA)</h2><table><tbody><tr><td valign=\"top\" width=\"50%\"><ol><li>By signing the Direct Debit Request, you authorise us to arrange for funds to be debited from your Account in accordance with the Agreement.</li><li>We will advise you 14 days in advance of any changes to the Direct Debit Request.</li><li>For all matters relating to the Direct Debit Request, including cancellation, alteration or suspension of drawing arrangements or to stop or defer a payment, or to investigate or dispute a previous payment, you should:<ol class=\"abc-list\"><li>Contact AVA Membership 1300 137 309<br/><strong>And</strong></li><li>Allow for 14 days for the amendments to take effect or to respond to a dispute.</li></ol>If our investigations show that your Account has been incorrectly debited, we will arrange for the Financial Institution to adjust your Account accordingly. We will also notify you in writing of the amount by which your Account has been adjusted. If, following our investigations, we believe on reasonable grounds that your Account has been correctly debited, we will respond to your query by providing you with reasons and copies of any evidence for this finding.If we cannot resolve the matter, you can still refer it to your Financial Institution, which will obtain details from you of the disputed payment and may lodge a claim on your behalf.</li><li>You should be aware that:<ol class=\"abc-list\"><li>direct debiting through the Bulk Electronic Clearing System (BECS) is not available on all accounts; and</li><li>You should check your Account details (including the Bank State Branch (BSB) number) directly against a recent statement from your Financial Institution.</li></ol>If you are in any doubt, please check with your Financial Institution before completing the drawing authority.</li><li>It is your responsibility to ensure that:<ol class=\"abc-list\"><li>sufficient cleared funds are in the Account when the payments are to be drawn;</li><li>the authorisation to debit the Account is in the same name as the Account signing instruction held by the Financial Institution where the Account is held;</li><li>suitable arrangements are made if the direct debit is cancelled:<ul class=\"unstyled\"><li>- by yourself;</li><li>- by your Financial Institution; or</li><li>- For any other reason.</li></ul></li></ol></li><li>If the due date for payment falls on a day other than a Banking Business Day, the payment will be processed on the next Banking Business Day. If you are uncertain when the payment will be debited from your Account, please check with your Financial Institution.</li></ol></td><td valign=\"top\" width=\"50%\"><ol><li class=\"invisible\"></li><li class=\"invisible\"></li><li class=\"invisible\"></li><li class=\"invisible\"></li><li class=\"invisible\"></li><li class=\"invisible\"></li><li>For returned unpaid transactions, the following procedures or policies will apply:<ol class=\"abc-list\"><li>we treat the payment as if it was never made;</li><li>services may be suspended until the outstanding charges are paid; and/or</li><li>A fee may be applied for drawings that are returned unpaid. We reserve the right to cancel the Direct Debit Request at any time if drawings are turned unpaid by your Financial Institution.</li></ol></li><li>All Customer records and Account details will be kept private and confidential to be disclosed only at your request or at the request of the Financial Institution in connection with a claim made to correct/investigate an alleged incorrect or wrongful debit or otherwise as required by law.</li><li>If any provision of this DDRSA is found to be illegal, void or unenforceable for unfairness or any other reason (for example, if a court or other tribunal or authority declares it so), the remaining provisions of this DDRSA will continue to apply to the extent possible as if the void or unenforceable provision had never existed.</li></ol><div><h4 style=\"margin:20px 0 10px 0;\">Definitions</h4>Unless otherwise defined, a term defined in the Agreement has the same meaning when used in this DDRSA and:<br/><br/>Account means the account nominated in the Direct Debit Request, held at your Financial Institution from which we are authorised to arrange for funds to be debited;<br/><br/>Agreement means the Terms and Conditions (including BPAY), including the Schedules to those Terms and Conditions, as amended from time to time;<br/><br/>Direct Debit Request means the Direct Debit Request between us and you as amended from time to time;<br/><br/>Financial Institution is the financial institution where you hold the account nominated in your Direct Debit Request as the account from which we are authorised to arrange for funds to be debited;<br/><br/><strong>We</strong> means <strong>The Australian Veterinary Association Ltd</strong> ; and<br/><br/>You mean the Customer/s who signed the Direct Debit Request.</div></td></tr></tbody></table></div></body></html>';\r\n\t\t\t\t\r\n\t\t\t//\t$member12 = $result->data[22]['value'][0];\r\n\t\t\t\t\r\n\t\t\t\tif($result->data[22]['value'][0]  == 'FULL/Yr'){\r\n\t\t\t\t\t$yr_member1 = intval(date(\"Y\")) - intval($result->data[41]['value'][0]);\r\n\t\t\t\t\tif($yr_member1 <=1){\r\n\t\t\t\t\t\t// $pricing_list = json_decode(ava_websignup_api_call('POST', 'api/get_pricing', array('cat' => 'FULL/YR1')), true);\r\n\t\t\t\t\t\t$member12 = 'FULL/YR1';\r\n\t\t\t\t\t} else if($yr_member1 ==2){\r\n\t\t\t\t\t\t// $pricing_list = json_decode(ava_websignup_api_call('POST', 'api/get_pricing', array('cat' => 'FULL/YR2')), true);\r\n\t\t\t\t\t\t$member12 = 'FULL/YR2';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// $pricing_list = json_decode(ava_websignup_api_call('POST', 'api/get_pricing', array('cat' => 'FULL/YR3')), true);\r\n\t\t\t\t\t\t$member12 = 'FULL/YR3';\r\n\t\t\t\t\t}\r\n\t\t\t\t}else if($result->data[42]['value'][0]  == 'STUDN'){\r\n\t\t\t\t\t$member12 = 'STUDN/STUDN';\t\r\n\t\t\t\t} else{\r\n\t\t\t\t\t$member12 = $result->data[22]['value'][0];\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t$member12_type = explode('/', $member12);\r\n\t\t\t\t\r\n\t\t\t\t$day_now = intval(date(\"j\"));\r\n\t\t\t\t$month_now = intval(date(\"n\"));\r\n\t\t\t\t$year_now = intval(date(\"Y\"));\r\n\t\t\t\tif($day_now <= 15){\r\n\t\t\t\t\tif($month_now <= 3){\r\n\t\t\t\t\t\t$total_month = 7 - $month_now;\r\n\t\t\t\t\t\t$expire_year_wew = $year_now;\r\n\t\t\t\t\t} else if($month_now >= 4 && $month_now <= 9){\r\n\t\t\t\t\t\t$total_month = 19 - $month_now;\r\n\t\t\t\t\t\t$expire_year_wew = intval($year_now)+1;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$total_month = 19 - $month_now;\r\n\t\t\t\t\t\t$expire_year_wew = intval($year_now)+1;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif($month_now <= 3){\r\n\t\t\t\t\t\t$total_month = 7 - ($month_now + 1);\r\n\t\t\t\t\t\t$expire_year_wew = $year_now;\r\n\t\t\t\t\t} else if($month_now >= 4 && $month_now <= 9){\r\n\t\t\t\t\t\t$total_month = 19 - ($month_now + 1);\r\n\t\t\t\t\t\t$expire_year_wew = intval($year_now)+1;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$total_month = 19 - ($month_now + 1);\r\n\t\t\t\t\t\t$expire_year_wew = intval($year_now)+1;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t$price_per_month = floatval($total12)/$total_month;\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t$html1 = '<!DOCTYPE HTML PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\r\n<html xml:lang=\"en\" xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"en\"><head>\r\n<meta http-equiv=\"content-type\" content=\"text/html; charset=UTF-8\">\r\n<title>Direct Debit (DDR) Request</title>\r\n<style type=\"text/css\">\r\n\thtml,\r\n\tbody,\r\n\th1 {\r\n\t\tmargin: 0;\r\n\t}\r\n\r\n\tbody {\r\n\t\tfont-size: 12px;\r\n\t\tfont-family: Arial;\r\n\t\tpadding: 40px;\r\n\t}\r\n\r\n\t.container {\r\n\t\tborder: 1px solid #000;\r\n\t\tpage-break-after: always;\r\n\t}\r\n\r\n\ttable {\r\n\t\twidth: 100%;\r\n\t}\r\n\r\n\thr {\r\n\t\tborder: none;\r\n\t\tborder-bottom: 3px solid #000;\r\n\t}\r\n\r\n\tol {\r\n\t\tpadding: 0 10px 0 20px;\r\n\t}\r\n\r\n\tol li {\r\n\t\tmargin: 0 0 10px 0;\r\n\t\tline-height: 1.25;\r\n\t}\r\n\r\n\t.abc-list {\r\n\t\tlist-style-type: lower-alpha;\r\n\t}\r\n\r\n\t.abc-list li {\r\n\t\tmargin: 4px 0;\r\n\t}\r\n\r\n\t.invisible {\r\n\t\tvisiblity: hidden;\r\n\t\tposition: absolute;\r\n\t\tleft: 999px;\r\n\t}\r\n\r\n\t.unstyled {\r\n\t\tlist-style: none;\r\n\t}\r\n\r\n\t.right-box {\r\n\t\tborder: 1px solid #000;\r\n\t\tline-height: 20px;\r\n\t}\r\n\r\n\t.normal-font {\r\n\t\tfont-size: 14px;\r\n\t\tfont-family: \"Arial\", sans-serif;\r\n\t}\r\n\r\n\t.und {\r\n\t\ttext-decoration: underline;\r\n\t}\r\n\r\n\t.collapsed {\r\n\t\tborder:1px solid #000;\r\n\t\tborder-collapse: collapse;\r\n\t}\r\n\r\n\t.collapsed tbody tr td {\r\n\t\tborder: 1px solid #000;\r\n\t}\r\n\r\n\t.small-label {\r\n\t\tfont-family: \"Arial\", sans-serif;\r\n\t\tfont-size: 10px;\r\n\t\tfont-weight: bold;\r\n\t\tmargin-left: 10px;\r\n\t}\r\n\r\n\t.faded-table tbody tr td  {\r\n\t\tborder: 1px solid #000;\r\n\t}\r\n\r\n\t.faded-table tbody tr td .small-label {\r\n\t\tcolor: #999;\r\n\t}\r\n</style>\r\n</head>\r\n<body>\r\n\t<h1>Online Applications – Direct Debit option</h1>\r\n\t<div class=\"container\" style=\"height:920px;\">\r\n\t\t<table>\r\n\t\t\t<tbody>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td><img src=\"data:image/gif;base64,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\"/></td>\r\n\t\t\t\t\t<td valign=\"top\">\r\n\t\t\t\t\t\t<table>\r\n\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t<td width=\"40%\"></td>\r\n\t\t\t\t\t\t\t\t\t<td width=\"60%\">\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"right-box\">\r\n\t\t\t\t\t\t\t\t\t\t\t<table>\r\n\t\t\t\t\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<tr><td>Official Use Only:</td></tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<tr><td>ID:</td></tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<tr><td>Entered:</td></tr>\r\n\t\t\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t</table>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td colspan=\"2\"><h2>Direct Debit Request (DDR) Authorisation Form:</h2></td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td>\r\n\t\t\t\t\t\t<table>\r\n\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t<td width=\"110\"><strong class=\"normal-font\">Web Application ID:</strong></td>\r\n\t\t\t\t\t\t\t\t\t<td>['.$node->nid.']</td>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t</table>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t\t<td align=\"right\" class=\"normal-font\"><strong>Date of Application:</strong> '.date('d/m/Y').'</td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td colspan=\"2\">\r\n\t\t\t\t\t\t<table>\r\n\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t<td width=\"110\"><strong class=\"normal-font\">Name of Applicant:</strong></td>\r\n\t\t\t\t\t\t\t\t\t<td class=\"normal-font\">'.$title.\". \".$result->data[4]['value'][0].\" \".$middle_name.\" \".$result->data[5]['value'][0].'</td>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t</table>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td colspan=\"2\">\r\n\t\t\t\t\t\t<table>\r\n\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t<td width=\"110\"><strong class=\"normal-font\">Member Type:</strong></td>\r\n\t\t\t\t\t\t\t\t\t<td class=\"normal-font\">'.$member12_type[0].'</td>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t</table>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td colspan=\"2\">\r\n\t\t\t\t\t\t<table>\r\n\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t<td width=\"110\"><strong class=\"normal-font\">Member Category:</strong></td>\r\n\t\t\t\t\t\t\t\t\t<td class=\"normal-font\">'.$member12_type[1].'</td>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t</table>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td colspan=\"2\">\r\n\t\t\t\t\t\t<table>\r\n\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t<td colspan=\"2\"><strong class=\"normal-font und\">Subscriptions Applied:</strong></td>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t</table>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td colspan=\"2\">\r\n\t\t\t\t\t\t<table>\r\n\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t<td width=\"50%\">\r\n\t\t\t\t\t\t\t\t\t\t<table>\r\n\t\t\t\t\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t\t\t\t\t'.$subscriptions_details.'\r\n\t\t\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t<td width=\"50%\"></td>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t</table>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td colspan=\"2\" height=\"0\">\r\n\t\t\t\t\t\t<hr />\r\n\t\t\t\t\t\t<table>\r\n\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t<td width=\"50%\">\r\n\t\t\t\t\t\t\t\t\t\t<table>\r\n\t\t\t\t\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td><strong class=\"normal-font\">Subtotal for Membership Year 2014 to 2015:</strong></td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td align=\"right\">'.uc_currency_format($total12).'</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t<td width=\"50%\"></td>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t</table>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td colspan=\"2\"><strong class=\"normal-font und\">Installment information:</strong>'.uc_currency_format($price_per_month) .'/month - '.$total_month.' months remaining until June '.$expire_year_wew.'</td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td colspan=\"2\" height=\"30\"></td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td valign=\"top\"><strong class=\"normal-font und\">Customer’s Authority:</strong></td>\r\n\t\t\t\t\t<td class=\"normal-font\">\r\n\t\t\t\t\t\tI, We '.$title.\". \".$result->data[4]['value'][0].\" \".$middle_name.\" \".$result->data[5]['value'][0].' authorise and request the Australian Veterinary Association Ltd APCA User ID 402563 until further notice in writing, to arrange for funds to be taken debited through the Bulk Electronic Clearing System (BECS) from my/our account at the Financial Institution identified below as instructed by me/us or any other amounts as instructed or authorised to be debited in accordance with the terms and conditions of the Direct Debit Service Request Service Agreement (DDRSA) as amended from time to time.\r\n\t\t\t\t\t\t<br />\r\n\t\t\t\t\t\t<br />\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td valign=\"top\"><strong class=\"normal-font und\">Payment Details</strong></td>\r\n\t\t\t\t\t<td class=\"normal-font\">This authority allows the debiting of amounts payable by the Customer under the Agreement between the Customer and <strong>The Australian Veterinary Association Ltd</strong></td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td valign=\"top\"><strong class=\"normal-font und\">Details of the Account to be debited</strong> All details must be supplied</td>\r\n\t\t\t\t\t<td>\r\n\t\t\t\t\t\t<table class=\"collapsed\">\r\n\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t<td colspan=\"2\" height=\"20\" valign=\"top\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"small-label\">Name of Financial Institution</span>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t<td height=\"20\" valign=\"top\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"small-label\">Branch Name</span>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t<td colspan=\"3\" height=\"20\" valign=\"top\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"small-label\">Account Name (please insert your name in full)</span>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t<td height=\"20\" valign=\"top\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"small-label\">BSB</span>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t<td height=\"20\" valign=\"top\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"small-label\">Account Number</span>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t<td height=\"20\" valign=\"top\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"small-label\">ABN/ARBN (if applicable)</span>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t</table>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td valign=\"top\"><strong class=\"normal-font und\">Customer Authorisation</strong></td>\r\n\t\t\t\t\t<td>\r\n\t\t\t\t\t\t<div class=\"normal-font\">By signing the below, I/we acknowledge that this Direct Debit arrangement is governed by the terms of the Authorisation the DDRSA attached to this request</div>\r\n\t\t\t\t\t\t<table class=\"faded-table\">\r\n\t\t\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t<td width=\"45\" height=\"36\" valign=\"top\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"small-label\">Signature</span>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t<td width=\"45\" height=\"36\" valign=\"top\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"small-label\">Date</span>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t\t</table>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t</tbody>\r\n\t\t</table>\r\n\t</div>\r\n\r\n\t<br />\r\n\r\n\t<div class=\"container\">\r\n\t\t<h2>Direct Debit Request Service Agreement (DDRSA)</h2>\r\n\t\t<table>\r\n\t\t\t<tbody>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td valign=\"top\" width=\"50%\">\r\n\t\t\t\t\t\t<ol>\r\n\t\t\t\t\t\t\t<li>By signing the Direct Debit Request, you authorise us to arrange for funds to be debited from your Account in accordance with the Agreement.</li>\r\n\t\t\t\t\t\t\t<li>We will advise you 14 days in advance of any changes to the Direct Debit Request.</li>\r\n\t\t\t\t\t\t\t<li>\r\n\t\t\t\t\t\t\t\tFor all matters relating to the Direct Debit Request, including cancellation, alteration or suspension of drawing arrangements or to stop or defer a payment, or to investigate or dispute a previous payment, you should:\r\n\t\t\t\t\t\t\t\t<ol class=\"abc-list\">\r\n\t\t\t\t\t\t\t\t\t<li>Contact AVA Membership 1300 137 309<br /><strong>And</strong></li>\r\n\t\t\t\t\t\t\t\t\t<li>Allow for 14 days for the amendments to take effect or to respond to a dispute.</li>\r\n\t\t\t\t\t\t\t\t</ol>\r\n\t\t\t\t\t\t\t\tIf our investigations show that your Account has been incorrectly debited, we will arrange for the Financial Institution to adjust your Account accordingly. We will also notify you in writing of the amount by which your Account has been adjusted. If, following our investigations, we believe on reasonable grounds that your Account has been correctly debited, we will respond to your query by providing you with reasons and copies of any evidence for this finding.\r\n\t\t\t\t\t\t\t\tIf we cannot resolve the matter, you can still refer it to your Financial Institution, which will obtain details from you of the disputed payment and may lodge a claim on your behalf.\r\n\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t<li>\r\n\t\t\t\t\t\t\t\tYou should be aware that:\r\n\t\t\t\t\t\t\t\t<ol class=\"abc-list\">\r\n\t\t\t\t\t\t\t\t\t<li>direct debiting through the Bulk Electronic Clearing System (BECS) is not available on all accounts; and</li>\r\n\t\t\t\t\t\t\t\t\t<li>You should check your Account details (including the Bank State Branch (BSB) number) directly against a recent statement from your Financial Institution.</li>\r\n\t\t\t\t\t\t\t\t</ol>\r\n\t\t\t\t\t\t\t\tIf you are in any doubt, please check with your Financial Institution before completing the drawing authority.\r\n\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t<li>\r\n\t\t\t\t\t\t\t\tIt is your responsibility to ensure that:\r\n\t\t\t\t\t\t\t\t<ol class=\"abc-list\">\r\n\t\t\t\t\t\t\t\t\t<li>sufficient cleared funds are in the Account when the payments are to be drawn;</li>\r\n\t\t\t\t\t\t\t\t\t<li>\r\n\t\t\t\t\t\t\t\t\t\tthe authorisation to debit the Account is in the same name as the Account signing instruction held by the Financial Institution where the Account is held;\r\n\t\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t\t\t<li>\r\n\t\t\t\t\t\t\t\t\t\tsuitable arrangements are made if the direct debit is cancelled:\r\n\t\t\t\t\t\t\t\t\t\t<ul class=\"unstyled\">\r\n\t\t\t\t\t\t\t\t\t\t\t<li>- by yourself;</li>\r\n\t\t\t\t\t\t\t\t\t\t\t<li>- by your Financial Institution; or</li>\r\n\t\t\t\t\t\t\t\t\t\t\t<li>- For any other reason.</li>\r\n\t\t\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t\t</ol>\r\n\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t<li>\r\n\t\t\t\t\t\t\t\tIf the due date for payment falls on a day other than a Banking Business Day, the payment will be processed on the next Banking Business Day. If you are uncertain when the payment will be debited from your Account, please check with your Financial Institution.\r\n\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t</ol>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t\t<td valign=\"top\" width=\"50%\">\r\n\t\t\t\t\t\t<ol>\r\n\t\t\t\t\t\t\t<li class=\"invisible\"></li>\r\n\t\t\t\t\t\t\t<li class=\"invisible\"></li>\r\n\t\t\t\t\t\t\t<li class=\"invisible\"></li>\r\n\t\t\t\t\t\t\t<li class=\"invisible\"></li>\r\n\t\t\t\t\t\t\t<li class=\"invisible\"></li>\r\n\t\t\t\t\t\t\t<li class=\"invisible\"></li>\r\n\t\t\t\t\t\t\t<li>\r\n\t\t\t\t\t\t\t\tFor returned unpaid transactions, the following procedures or policies will apply:\r\n\t\t\t\t\t\t\t\t<ol class=\"abc-list\">\r\n\t\t\t\t\t\t\t\t\t<li>we treat the payment as if it was never made;</li>\r\n\t\t\t\t\t\t\t\t\t<li>services may be suspended until the outstanding charges are paid; and/or</li>\r\n\t\t\t\t\t\t\t\t\t<li>A fee may be applied for drawings that are returned unpaid. We reserve the right to cancel the Direct Debit Request at any time if drawings are turned unpaid by your Financial Institution.</li>\r\n\t\t\t\t\t\t\t\t</ol>\r\n\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t<li>\r\n\t\t\t\t\t\t\t\tAll Customer records and Account details will be kept private and confidential to be disclosed only at your request or at the request of the Financial Institution in connection with a claim made to correct/investigate an alleged incorrect or wrongful debit or otherwise as required by law.\r\n\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t<li>\r\n\t\t\t\t\t\t\t\tIf any provision of this DDRSA is found to be illegal, void or unenforceable for unfairness or any other reason (for example, if a court or other tribunal or authority declares it so), the remaining provisions of this DDRSA will continue to apply to the extent possible as if the void or unenforceable provision had never existed.\r\n\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t</ol>\r\n\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<h4 style=\"margin:20px 0 10px 0;\">Definitions</h4>\r\n\t\t\t\t\t\t\tUnless otherwise defined, a term defined in the Agreement has the same meaning when used in this DDRSA and:<br /><br />\r\n\t\t\t\t\t\t\tAccount means the account nominated in the Direct Debit Request, held at your Financial Institution from which we are authorised to arrange for funds to be debited;<br /><br />\r\n\t\t\t\t\t\t\tAgreement means the Terms and Conditions (including BPAY), including the Schedules to those Terms and Conditions, as amended from time to time;<br /><br />\r\n\t\t\t\t\t\t\tDirect Debit Request means the Direct Debit Request between us and you as amended from time to time;<br /><br />\r\n\t\t\t\t\t\t\tFinancial Institution is the financial institution where you hold the account nominated in your Direct Debit Request as the account from which we are authorised to arrange for funds to be debited;<br /><br />\r\n\t\t\t\t\t\t\t<strong>We</strong> means <strong>The Australian Veterinary Association Ltd</strong> ; and<br /><br />\r\n\t\t\t\t\t\t\tYou mean the Customer/s who signed the Direct Debit Request.\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t</tbody>\r\n\t\t</table>\r\n\t</div>\r\n</body></html>';\r\n\t\t\t\t//print_r($html1); die();\r\n\t\t\t\t//$html1 = \"TEST\"; \r\n\t\t\t\tglobal $base_url;\r\n\t\t\t\trequire_once(\"sites/all/libraries/dompdf/dompdf_config.inc.php\");\r\n\t\t\t\t$dompdf = new DOMPDF;\r\n\t\t\t\t$dompdf->load_html($html);\r\n\t\t\t\t$dompdf->render(); \r\n\t\t\t\t$output = $dompdf->output();\r\n\t\t\t\t$filename = 'membership_'.$node1->nid.'.pdf';\r\n\t\t\t\t$file_to_save = 'public://application/'.$filename;\r\n\t\t\t\tfile_put_contents($file_to_save, $output);\r\n\t\t\t\t\r\n\t\t\t\t$dompdf1 = new DOMPDF;\r\n\t\t\t\t$dompdf1->load_html($html1);\r\n\t\t\t\t$dompdf1->render(); \r\n\t\t\t\t$output1 = $dompdf1->output();\r\n\t\t\t\t$filename2 = 'membership_debit_'.$node1->nid.'.pdf';\r\n\t\t\t\t$file_to_save2 = 'public://application/'.$filename2;\r\n\t\t\t\tfile_put_contents($file_to_save2, $output1);\r\n\t\t\t\t\r\n\t\t\t\t/* $attachment2[] = array(\r\n\t\t\t\t  'filecontent' => file_get_contents($file_to_save),\r\n\t\t\t\t  'filename' => $filename,// You can change the name and extension of the file you need to send.\r\n\t\t\t\t  'filemime' => 'application/pdf',  \r\n\t\t\t\t );\r\n\t\t\t\t  */\r\n\t\t\t\t \r\n\t\t\t\t/* $attachment2 =  array(\r\n\t\t\t\t  'filecontent' => file_get_contents($file_to_save2),\r\n\t\t\t\t  'filename' => $filename2,// You can change the name and extension of the file you need to send.\r\n\t\t\t\t  'filemime' => 'application/pdf',  \r\n\t\t\t\t ); */\r\n\t\t\t\t \r\n\t\t\t\t// print_r($attachment2); die();\r\n\t\t\t\t \r\n\t\t\t\t $body_email = \"Thank you for your application. <br/><br/>\r\n\t\t\t\t Your application is now received by the Membership Team.<br/><br/>\r\n\t\t\t\t You need to submit the form attached to AVA main office to complete your application and payment.<br/><br/>\r\n\t\t\t\t \r\n\t\t\t\t Please click on one of the below to download your authorisation form for monthly payments:<br/><br/>\r\n\t\t\t\t \r\n\t\t\t\t <a href='\".$base_url.\"/sites/default/files/application/\".$filename2.\"'>Download Direct Debit Request (DDR) Authorisation Form</a><br/>\r\n\t\t\t\t <a href='\".$base_url.\"/sites/default/files/application/\".$filename.\"'>Download Direct Debit (DDR) Request</a><br/>\r\n\t\t\t\t \r\n\t\t\t\t Thank you!\";\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\tdrupal_mail('ava_ebsco_bulk', 'notice', 'junnel@alphasys.com.au', user_preferred_language(), array('body' => $body_email, 'subject' =>\"AVA Membership Application - Pay By the Month Forms\", 'attachment' => $attachment2), 'donotreply@ava.com.au', TRUE); \r\n\t\t\t\t\t\t\t\r\n\t\t\t\tdrupal_mail('ava_ebsco_bulk', 'notice',$result->data[36]['value'][0], user_preferred_language(), array('body' => $body_email, 'subject' =>\"AVA Membership Application - Pay By the Month Forms\", 'attachment' => $attachment2), 'donotreply@ava.com.au', TRUE); \r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t$message = '\r\n\t\t\t\tA new membership application has been received using PBTM Option with the following details:<br/><br/>\r\n\t\t\t\tMember ID: <strong>'.$title.\". \".$result->data[4]['value'][0].\" \".$middle_name.\" \".$result->data[5]['value'][0].'<br/></strong>\r\n\t\t\t\t<a href=\"'.$base_url.'/sites/default/files/application/'.$filename2.'\">Direct Debit Request (DDR) Authorisation Form</a><br/>\r\n\t\t\t\t<a href=\"'.$base_url.'/sites/default/files/application/'.$filename.'\">Direct Debit (DDR) Request </a><br/>\r\n\t\t\t\t';\r\n\t\t\t\t\r\n\t\t\t\tif ((isset($result->data[42]['value'][0]) && $result->data[42]['value'][0] == 'STUDN')){\r\n\t\t\t\t\t$message .= \"Have you ever been subject to disciplinary proceedings for professional misconduct? - <strong>\".$result->data[96]['value'][1].\"</strong><br/>\";\r\n\t\t\t\t\t$message .= \"In the last 5 years has any claim been made against you or are you aware of any facts or circumstances which may give rise to a claim against you in the future? - <strong>\".$result->data[96]['value'][2].\"</strong><br/>\";\r\n\t\t\t\t\t$message .= \"Do you perform any professional services that fall outside the terms of your program of study as a veterinary student? - <strong>\".$result->data[96]['value'][3].\"</strong><br/>\";\r\n\t\t\t\t}else{\r\n\t\t\t\t\tif((isset($result->data[22]['value'][0]) && $result->data[22]['value'][0]  == 'FULL/Yr')){\r\n\t\t\t\t\t\t$yr_member = intval(date(\"Y\")) - intval($result->data[41]['value'][0]);\r\n\t\t\t\t\t\tif($yr_member <=1){\r\n\t\t\t\t\t\t\t// $pricing_list = json_decode(ava_websignup_api_call('POST', 'api/get_pricing', array('cat' => 'FULL/YR1')), true);\r\n\t\t\t\t\t\t\t$member12 = 'FULL/YR1';\r\n\t\t\t\t\t\t} else if($yr_member ==2){\r\n\t\t\t\t\t\t\t// $pricing_list = json_decode(ava_websignup_api_call('POST', 'api/get_pricing', array('cat' => 'FULL/YR2')), true);\r\n\t\t\t\t\t\t\t$member12 = 'FULL/YR2';\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// $pricing_list = json_decode(ava_websignup_api_call('POST', 'api/get_pricing', array('cat' => 'FULL/YR3')), true);\r\n\t\t\t\t\t\t\t$member12 = 'FULL/YR3';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif ($member12 == \"FULL/YR1\" || $member12==\"FULL/YR2\"){\r\n\t\t\t\t\t\t\t$message .= \"Have you ever been subject to disciplinary proceedings for professional misconduct? - <strong>\".$result->data[96]['value'][1].\"</strong><br/>\";\r\n\t\t\t\t\t\t\t$message .= \"In the last 5 years has any claim been made against you or are you aware of any facts or circumstances which may give rise to a claim against you in the future? - <strong>\".$result->data[96]['value'][2].\"</strong><br/>\";\r\n\t\t\t\t\t\t\t$message .= \"Do you perform any professional services that fall outside the terms of your program of study as a veterinary student? - <strong>\".$result->data[96]['value'][3].\"</strong><br/>\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t$message .= \"You can review the application here: \".$base_url.\"/node/\".$result->nid.\"/submission/\".$result->sid;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t$params = array(\r\n\t\t\t\t\t'subject' => 'New AVA Membership Application Received - PBTM',\r\n\t\t\t\t\t'message' => $message,\r\n\t\t\t\t);\r\n\t\t\t\t//  drupal_mail('imis_base', 'ava_membership_' . $contact_id, $email, language_default(), $params);\r\n\t\t\t\tdrupal_mail('imis_base', 'ava_membership_' . $contact_id, 'junnel@alphasys.com.au', language_default(), $params);\r\n\t\t\t\t\r\n\t\t\t\tdrupal_mail('imis_base', 'ava_membership_' . $contact_id, 'members@ava.com.au', language_default(), $params);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\tdrupal_goto('web_signup-thank-you');\r\n\t\t\t\t\r\n\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\tif(isset($submission->data[42]['value'][0]) && $submission->data[42]['value'][0] == 'STDOL'){\r\n\t\r\n\t\t\t\t  $result = webform_get_submission($node1->webform_id,$node1->submission_id);\r\n\t\t\t\t\t/*** Insert Data ***/\r\n\t\t\t\t\t$member = $result->data[22]['value'][0];\r\n\t\t\t\t\t\r\n\t\t\t\t\t//title \r\n\t\t\t\t\t\r\n\t\t\t\t\tswitch ($result->data[65]['value'][0]){\r\n\t\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\t\t$title = \"Miss\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\t\t$title = \"Mr\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\t\t$title = \"Mrs\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\t\t$title = \"Ms\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 4:\r\n\t\t\t\t\t\t\t$title = \"Dr\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 5:\r\n\t\t\t\t\t\t\t$title = \"Professor\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t$title = \"Dr\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t\t$state = explode(\"/\", $result->data[10]['value'][0]);\r\n\t\t\t\t\r\n\t\t\t\t\t$address = $result->data[11]['value'][0].\", \".$result->data[9]['value'][0].\", \".$state[1].\", \".$result->data[12]['value'][0].\", Australia\";\r\n\t\t\t\t\t\r\n\t\t\t\t\t$type = explode(\"/\", $member); //member type\r\n\t\t\t\t\t\r\n\t\t\t\t\t$chapter = explode(\"|\", $result->data[63]['value'][0]);\r\n\t\t\t\t\t$chapter = explode(\"/\", $chapter[0]);\r\n\t\t\t\t\t\r\n\t\t\t\t\t$middle_name = $result->data[6]['value'][0] != \"\" ? strtoupper(substr($result->data[6]['value'][0], 0)).\". \" : \" \";\r\n\t\t\t\t\t\r\n\t\t\t\t\t/* $data = array(\r\n\t\t\t\t\t\t'ORG_CODE' => 'AVA',\r\n\t\t\t\t\t\t'MEMBER_TYPE' => $type[0],\r\n\t\t\t\t\t\t'CATEGORY' =>  $type[1],\r\n\t\t\t\t\t\t'STATUS' => 'P',\r\n\t\t\t\t\t\t'LAST_FIRST' => strtoupper($result->data[5]['value'][0]).\", \".strtoupper($result->data[4]['value'][0]),\r\n\t\t\t\t\t\t'COMPANY_SORT' => '',\r\n\t\t\t\t\t\t'FULL_NAME' => $title.\". \".$result->data[4]['value'][0].\" \".$middle_name.\" \".$result->data[5]['value'][0],\r\n\t\t\t\t\t\t'COMPANY' => '',\r\n\t\t\t\t\t\t'FULL_ADDRESS' => $address,\r\n\t\t\t\t\t\t'PREFIX' => strtoupper($title),\r\n\t\t\t\t\t\t'FIRST_NAME' => $result->data[4]['value'][0],\r\n\t\t\t\t\t\t'MIDDLE_NAME' => $result->data[6]['value'][0],\r\n\t\t\t\t\t\t'LAST_NAME' => $result->data[5]['value'][0],\r\n\t\t\t\t\t\t'INFORMAL' => $result->data[4]['value'][0],\r\n\t\t\t\t\t\t'WORK_PHONE' => $result->data[13]['value'][0],\r\n\t\t\t\t\t\t'HOME_PHONE' => '',\r\n\t\t\t\t\t\t'FAX' => '',\r\n\t\t\t\t\t\t'TOLL_FREE' => $result->data[14]['value'][0],\r\n\t\t\t\t\t\t'CITY' => strtoupper($result->data[9]['value'][0]),\r\n\t\t\t\t\t\t'STATE_PROVINCE' => strtoupper($state[1]),\r\n\t\t\t\t\t\t'ZIP' => $result->data[12]['value'][0],\r\n\t\t\t\t\t\t'MAIL_ADDRESS' => $address,\r\n\t\t\t\t\t\t'BILL_ADDRESS' => $address,\r\n\t\t\t\t\t\t'GENDER' => $result->data[8]['value'][0],\r\n\t\t\t\t\t\t'BIRTH_DATE' =>  $result->data[7]['value'][0].\" 00:00:00\",\r\n\t\t\t\t\t\t'CHAPTER' => $chapter[0],\r\n\t\t\t\t\t\t'MEMBER_RECORD' => 'TRUE',\r\n\t\t\t\t\t\t'COMPANY_RECORD' => 'FALSE',\r\n\t\t\t\t\t\t'JOIN_DATE' => date('Y-m-d h:i:s'),\r\n\t\t\t\t\t\t'PAID_THRU' => '2015-06-30 00:00:00',\r\n\t\t\t\t\t\t'MEMBER_STATUS' => 'P',\r\n\t\t\t\t\t\t'MEMBER_STATUS_DATE' => '',\r\n\t\t\t\t\t\t'PREVIOUS_MT' => 'P',\r\n\t\t\t\t\t\t'MT_CHANGE_DATE' => date('Y-m-d h:i:s'),\r\n\t\t\t\t\t\t'DATE_ADDED' => date('Y-m-d h:i:s'),\r\n\t\t\t\t\t\t'LAST_UPDATED' => date('Y-m-d h:i:s'),\r\n\t\t\t\t\t\t'ADDRESS_NUM_1' => '', //save first address in Name Address tble before proceeding.\r\n\t\t\t\t\t\t'ADDRESS_NUM_2' => '', //save first address in Name Address tble before proceeding.\r\n\t\t\t\t\t\t'ADDRESS_NUM_3' => '', //save first address in Name Address tble before proceeding.\r\n\t\t\t\t\t\t'SHIP_ADDRESS_NUM' => '', //save first address in Name Address tble before proceeding.\r\n\t\t\t\t\t\t'EMAIL' => 'junnel@alphasys.com.au6',\r\n\t\t\t\t\t\t'SIG' => $result->data[51]['value'], \r\n\t\t\t\t\t\t'STREET' => $result->data[11]['value'],\r\n\t\t\t\t\t\t'COUNTRY' => 'Australia',\r\n\t\t\t\t\t);\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t$pricing_list = json_decode(ava_websignup_api_call('POST', 'http://10.0.10.202/jack_api/api/save_member_data', array('data'=>json_encode($data))), true);\r\n\t\t\t\t\t\r\n\t\t\t\t\tprint_r($result); die();\t */\t\t\t\r\n\r\n\t\t\t\t\t$submitted['Name']['Prefix'] = $title;\r\n\t\t\t\t\t$submitted['Name']['FirstName'] = $result->data[4]['value'][0];\r\n\t\t\t\t\t$submitted['Name']['Informal'] = $result->data[4]['value'][0];\r\n\t\t\t\t\t$submitted['Name']['MiddleName'] = $result->data[6]['value'][0];\r\n\t\t\t\t\t$submitted['Name']['LastName'] = $result->data[5]['value'][0];\r\n\t\t\t\t\t$submitted['Name']['BirthDate'] = $result->data[7]['value'][0].\" 00:00:00\";\r\n\t\t\t\t\t$submitted['Name_Demographics'][0]['DATE_OF_BIRTH'] = $result->data[7]['value'][0].\" 00:00:00\";\r\n\t\t\t\t\t //$submitted['Name']['Gender'] = substr($submission->data[6]['value'][0], 0, 1);\r\n\t\t\t\t\t$submitted['Name_Demographics'][0]['GENDER'] =\t$result->data[8]['value'][0];\r\n\t\t\t\t\t$submitted['Name']['HomePhone'] =$result->data[13]['value'][0];\r\n\t\t\t\t\t$submitted['Name']['WorkPhone'] = $result->data[13]['value'][0];\r\n\t\t\t\t\t$submitted['Name']['Fax'] = '';\r\n\t\t\t\t\t$submitted['Name']['Mobile'] =$result->data[14]['value'][0];\r\n\t\t\t\t\t$submitted['Name']['CustomerTypeCode'] = \"STDOL\"; //usbon ni siya\r\n\t\t\t\t\t$submitted['Name']['BillingCategory'] = \"STDOL\";\r\n\t\t\t\t\t$submitted['Address']['Postal']['Email'] = $result->data[36]['value'][0];\r\n\t\t\t\t\t$submitted['Address']['Postal']['Address1'] = $result->data[11]['value'];\r\n\t\t\t\t\t$submitted['Address']['Postal']['City'] =  strtoupper($result->data[9]['value'][0]);\r\n\t\t\t\t\t$submitted['Address']['Postal']['State'] = strtoupper($state[1]);\r\n\t\t\t\t\t$submitted['Address']['Postal']['PostalCode'] = $result->data[12]['value'][0];\r\n\t\t\t\t\t$submitted['Address']['Postal']['Country'] = 'Australia';\r\n\t\t\t\t\t$submitted['Address']['Postal']['IsPreferredMail'] = TRUE;\r\n\t\t\t\t\t$submitted['Address']['Postal']['IsPreferredBill'] = TRUE;\r\n\t\t\t\t\t$submitted['Address']['Postal']['IsPreferredShip'] = TRUE;\r\n\t\t\t\t\t  /*\r\n\t\t\t\t\t   Not needed as per spec\r\n\t\t\t\t\t   $submitted['Address']['Home']['Address1'] = $submission->data[11]['value'][0];\r\n\t\t\t\t\t   $submitted['Address']['Home']['City'] = $submission->data[12]['value'][0];\r\n\t\t\t\t\t   $submitted['Address']['Home']['State'] = $submission->data[66]['value'][0];\r\n\t\t\t\t\t   $submitted['Address']['Home']['PostalCode'] = $submission->data[67]['value'][0];\r\n\t\t\t\t\t   */\r\n\t\t\t\t\t   \r\n\t\t\t\t\t \r\n\t\t\t\t\t$email = $result->data[36]['value'][0];\r\n\t\t\t\t\t$activity = array();\r\n\t\t\t\t\t$activity['PRODUCT_CODE'] = $result->data[66]['value'][0]; //Degree\r\n\t\t\t\t\t$faculty = explode(\"|\",$result->data[17]['value'][0]);\r\n\t\t\t\t\t$activity['UF_1'] = $faculty[0]; //Faculty\r\n\t\t\t\t\t$activity['UF_2'] = 'AUS'; //Country\r\n\t\t\t\t\t$activity['DESCRIPTION'] =$result->data[67]['value'][0]; //Year\r\n\r\n\t\t\t\t\t$contact_id = imis_contact_insert_contact();\r\n\t\t\t\t\t$username = strtoupper($submitted['Name']['LastName']) . $contact_id;\r\n\t\t\t\t\t$password = 'member1001';\r\n\t\t\t\t\timis_user_promote_contact_to_web_user($contact_id, $username, $password); //gives username and password\r\n\r\n\t\t\t\t\timis_contact_sync_single($contact_id, FALSE);\r\n\t\t\t\t\t$c = imis_contact_load($contact_id);\r\n\t\t\t\t\t$account->name = $username;\r\n\t\t\t\t\t$account->imis['ContactId'] = $contact_id;\r\n\t\t\t\t\timis_contact_inflate($account);\r\n\r\n\t\t\t\t\t$modified_account = imis_base_clone($account);\r\n\t\t\t\t\t$modified_account->imis = $submitted;\r\n\t\t\t\t\timis_contact_submit_to_imis($account, $modified_account, array('Name-Membership' => 'Name-Membership', 'Name' => 'Name'));\r\n\t\t\t\t\timis_activities_save($contact_id, 'DEGREE', $activity);\r\n\t\t\t\t\t\r\n\t\t\t\t\t$res1 = 0;\r\n\t\t\t\t\t$res2 = 0;\r\n\t\t\t\t\t$res3 = 0;\r\n\t\t\t\t\t$res4 = 0;\r\n\t\t\t\t\t$res5 = 0;\r\n\t\t\t\t\t$res6 = \"\";\r\n\t\t\t\t\tif($result->data[39]['value'][0] == '0'){\r\n\t\t\t\t\t\t$res1 = 1;\r\n\t\t\t\t\t} else if($result->data[39]['value'][0] == '1'){\r\n\t\t\t\t\t\t$res2 = 1;\r\n\t\t\t\t\t} else if($result->data[39]['value'][0] == '2'){\r\n\t\t\t\t\t\t$res3 = 1;\r\n\t\t\t\t\t} else if($result->data[39]['value'][0] == '3'){\r\n\t\t\t\t\t\t$res4 = 1;\r\n\t\t\t\t\t} else if($result->data[39]['value'][0] == '4'){\r\n\t\t\t\t\t\t$res5 = 1;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$res6 = $result->data[53]['value'][0];\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$date_chop2 =explode(\"-\",$result->data[7]['value'][0]);\r\n\t\t\t\t\t$data = array(\r\n\t\t\t\t\t\t'STATUS' => 'A',\r\n\t\t\t\t\t\t'ID' => $contact_id,\r\n\t\t\t\t\t\t'JOIN_REASON_1' => $res1,\r\n\t\t\t\t\t\t'JOIN_REASON_2' => $res2,\r\n\t\t\t\t\t\t'JOIN_REASON_3' => $res3,\r\n\t\t\t\t\t\t'JOIN_REASON_4' => $res4,\r\n\t\t\t\t\t\t'JOIN_REASON_5' => $res5,\r\n\t\t\t\t\t\t'JOIN_REASON_6' => $res6,\r\n\t\t\t\t\t\t'EMAIL' => $result->data[36]['value'][0],\r\n\t\t\t\t\t\t'LAST_UPDATED' => date('Y-m-d h:i:s'),\r\n\t\t\t\t\t\t'ADDRESS_1' => $result->data[11]['value'][0],\r\n\t\t\t\t\t\t'CHAPTER' => $faculty[1],\r\n\t\t\t\t\t\t'GENDER' => $result->data[8]['value'][0] == \"F\" ? \"female\": \"male\",\r\n\t\t\t\t\t\t'birthDate' => array(\r\n\t\t\t\t\t\t\t\t\t\t\t'year' =>$date_chop2[0],\r\n\t\t\t\t\t\t\t\t\t\t\t'month' =>$date_chop2[1],\r\n\t\t\t\t\t\t\t\t\t\t\t'day' =>$date_chop2[2],\r\n\t\t\t\t\t\t\t\t\t\t\t),\r\n\t\t\t\t\t);\r\n\t\r\n\t\t\t\t\t$result1 =  json_decode(ava_websignup_api_call('POST', 'api/change_member_status_stdol', array('data'=>json_encode($data))), true);\r\n\t\t\t\t\t\r\n\t\t\t\t\t$key = imis_base_get_admin_key();\r\n\t\t\t\t\t$changed['Name']['BirthDate'] = $result->data[7]['value'][0].\" 00:00:00\";\r\n\t\t\t\t\t$changed['Name']['Gender'] = $result->data[8]['value'][0] == \"F\" ? \"Female\": \"Male\"; \r\n\t\t\t\t\timis_contact_update_contact($key, $contact_id, $changed['Name']);\r\n\t\t\t\t\t\r\n\t\t\t\t\t$stdol_now = intval(date(\"n\"));\r\n\t\t\t\t\t// $stdol_now = 2;\r\n\t\t\t\t\tif(($stdol_now >= 4 && $stdol_now <= 9) || ($stdol_now >= 10 && $stdol_now <= 12)){\r\n\t\t\t\t\t\t$expire_year = intval(date('Y') + 1);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$expire_year = date('Y');\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t$data_billing = array(\r\n\t\t\t\t\t\t'TYPE' => 'STDOL',\r\n\t\t\t\t\t\t'ID' => $contact_id,\r\n\t\t\t\t\t\t'CHAPT' => \"CHAPT/\".$faculty[1],\r\n\t\t\t\t\t\t// 'date_applied' => date('Y-m-d h:i:s'),\r\n\t\t\t\t\t\t'date_applied' => date('Y-m-d h:i:s'),\r\n\t\t\t\t\t\t// 'date_paid_thru' => date('2015-07-01 00:00:00'),\t\r\n\t\t\t\t\t\t'date_paid_thru' => ((string)$expire_year).\"-06-30 00:00:00\",\t\r\n\t\t\t\t\t\t// 'bill_begin' => date('Y-m-d h:i:s'), // january 1\r\n\t\t\t\t\t\t'bill_begin' => ((string)$expire_year).\"-07-01 00:00:00\",\r\n\t\t\t\t\t);\r\n\t\t\t\t\t\r\n\t\t\t\t\t$result2 =  json_decode(ava_websignup_api_call('POST', 'api/create_billing', array('data'=>json_encode($data_billing))), true);\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t$message = 'Thank you for joining up with the AVA. We welcome you as a online student member.\r\n\t\t\t\t\tYou can now log in to the AVA website with the following details:\r\n\t\t\t\t\tUsername: ' . $username . '\r\n\t\t\t\t\tPassword: member1001\r\n\r\n\t\t\t\t\tFor any enquiries, please contact the AVA membership staff on 1300137 3009.';\r\n\r\n\t\t\t\t\t  $params = array(\r\n\t\t\t\t\t\t'subject' => 'AVA membership',\r\n\t\t\t\t\t\t'message' => $message,\r\n\t\t\t\t\t  );\r\n\t\t\t\t\t//  drupal_mail('imis_base', 'ava_membership_' . $contact_id, $email, language_default(), $params);\r\n\t\t\t\t\t  drupal_mail('imis_base', 'ava_membership_' . $contact_id, 'junnel@alphasys.com.au', language_default(), $params);\r\n\t\t\t\t\t  drupal_mail('imis_base', 'ava_membership_' . $contact_id, $result->data[36]['value'][0], language_default(), $params);\r\n\t\t\t\t\t global $base_url;\r\n\t\t\t\t\t $body_email2 = \"\r\n\t\t\t\t\t A membership application for Student Free Online has been received with the ff details. <br/><br/>\r\n\t\t\t\t\t Member ID: \".$contact_id.\"<br/>\t\t\t \r\n\t\t\t\t\t Username: \".$username.\"<br/>\t\t\t \r\n\t\t\t\t\t Email Address: \". $result->data[36]['value'][0].\"<br/><br/>\r\n\t\t\t\t\t You can view the complete user's application here:\".$base_url.\"/node/\".$result->nid.\"/submission/\".$result->sid;\r\n\t\t\t\t\t \r\n\t\t\t\t\t\r\n\t\t\t\t\tdrupal_mail('ava_ebsco_bulk', 'notice', $result->data[36]['value'][0], user_preferred_language(), array('body' => $body_email2, 'subject' =>\"AVA Membership Application Received\"), 'donotreply@ava.com.au', TRUE); \r\n\t\t\t\t\t\r\n\t\t\t\t\tdrupal_goto('web_signup-thank-you-stdol');\r\n\t\t\t\t} else {\r\n\t\t\t\t\r\n\t\t\t\t\t$all_payment = $submission->data[85]['value'];\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t$total = 0;\r\n\t\t\t\t\t\r\n\t\t\t\t\t$sig_array = array();\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\tforeach($submission->data[51]['value'] as $sig){\r\n\t\t\t\t\t\t$sig_array[$sig] = $all_payment[$sig];\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t$total_a1 = $all_payment[$submission->data[64]['value'][0]]; //this is for national subscription\r\n\t\t\t\t\t$total_chapt = $all_payment[$submission->data[63]['value'][0]]; //this is for chapter subscription\r\n\t\t\t\t\r\n\t\t\t\t\t$message = t('To complete your membership transaction please continue through the checkout process');\r\n\t\t\t\t\t$data = array(\r\n\t\t\t\t\t\t'module' => 'ava_websignup',\r\n\t\t\t\t\t\t'shippable' => FALSE,\r\n\t\t\t\t\t\t'webform_id' => $node1->webform_id,\r\n\t\t\t\t\t\t'system' => 'membership',\r\n\t\t\t\t\t\t'submission_id' => $node1->submission_id,\r\n\t\t\t\t\t\t'pricing' => $all_payment,\r\n\t\t\t\t\t\t'title' => $submission->data[86]['value'],\r\n\t\t\t\t\t\t'A1_NATIONAL' => array($submission->data[64]['value'][0] => $total_a1),\r\n\t\t\t\t\t\t'CHAPT' => array($submission->data[63]['value'][0] => $total_chapt),\r\n\t\t\t\t\t\t'SIG' => $sig_array,\r\n\t\t\t\t\t\t'description' => ava_websignup_application_calculate_description($submission, $node),\r\n\t\t\t\t\t\t'price' => ava_websignup_application_calculate_price($submission, $node),\r\n\t\t\t\t\t);\r\n\t\t\t\t\t\r\n\t\t\t\t\tuc_cart_add_item($node1->nid, 1, $data, NULL, $message);\r\n\t\t\t\t\tdrupal_goto('cart');\r\n\t\t\t\t}\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t//\tprint_r($submission); die();\r\n\t\t\t//\texit();\r\n\t\t\t//print_r($node); die();\r\n\t\t\t\t\r\n\t\t\t//\tprint_r($submission); die();\r\n\t\t\t}\r\n\t\t\t// print_r($submission);die();\r\n\t\t\t/*\r\n\t\t\t$node = new stdClass();\r\n\t\t\t// $node->title = $submission->data[9]['value'][0];\r\n\t\t\t$node->type = 'ava_membership';\r\n\t\t\tnode_object_prepare($node);\r\n\t\t\t$node->language = LANGUAGE_NONE; \r\n\t\t\t$node->status = 1;\r\n\t\t\t\r\n\t\t\t$node->field_first_name[$node->language][0]['value'] = $submission->data[4]['value'][0];\r\n\t\t\t$node->field_last_name[$node->language][0]['value'] = $submission->data[5]['value'][0];\r\n\t\t\t$node->field_middle_name[$node->language][0]['value'] = $submission->data[6]['value'][0];\r\n\t\t\t$node->field_date_of_birth[$node->language][0]['value'] = $submission->data[7]['value'][0];\r\n\t\t\t$node->field_gender[$node->language][0]['value'] = $submission->data[8]['value'][0];\r\n\t\t\t$node->field_postal_street_address[$node->language][0]['value'] = $submission->data[11]['value'][0];\r\n\t\t\t$node->field_avawebsignup_city[$node->language][0]['value'] = $submission->data[9]['value'][0];\r\n\t\t\t$node->field_postal_state[$node->language][0]['value'] = $submission->data[10]['value'][0];\r\n\t\t\t$node->field_postal_postcode[$node->language][0]['value'] = $submission->data[12]['value'][0];\r\n\t\t\t$node->field_telephone_no[$node->language][0]['value'] = $submission->data[13]['value'][0];\r\n\t\t\t$node->field_mobile_no[$node->language][0]['value'] = $submission->data[14]['value'][0];\r\n\t\t\t$node->field_avawebsignup_email_address[$node->language][0]['value'] = $submission->data[36]['value'][0];\r\n\t\t\t$node->field_decision_factor[$node->language][0]['value'] = $submission->data[38]['value'][0];\r\n\t\t\t$node->field_educational_information[$node->language][0]['value'] = $submission->data[17]['value'][0];\r\n\t\t\t$node->field_year_attended[$node->language][0]['value'] = $submission->data[18]['value'][0];\r\n\t\t\t$node->field_educational_status[$node->language][0]['value'] = $submission->data[42]['value'][0];\r\n\t\t\t */\r\n\t\t\t\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction ava_websignup_check_validate($form, &$form_state) {\r\n\t\t// die();\r\n\t\t/* if($form_state['values']['details']['page_num'] == 2) {\r\n\t\t\techo \"2\";\r\n\t\t\tif($form_state['values']['submitted'][22] == 'FULL/SPOUS') {\r\n\t\t\t\techo \"spous\";\r\n\t\t\t//\techo \"<script>console.log('wew2');</script>\";\r\n\t\t\t\tif($form_state['values']['submitted'][70] == \"\"){\r\n\t\t\t\t\techo \"70\";\r\n\t\t\t\t\tdie();\r\n\t\t\t\t\tform_set_error('submitted[my_spouse_is]',\"Please input your spouse name.\");\r\n\t\t\t\t\t// print_r($form_state);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} */\r\n\t\t/* if($form_state['values']['op'] == t('Step 3')){\r\n\t\t\tif($form_state['values']['submitted'][70] == ''){ \r\n\t\t\t\tform_set_error('submitted[spouse_given_name]',\"Please input your spouse given name.\");\r\n\t\t\t\t// print_r($form_state);\r\n\t\t\t}\r\n\t\t} */\r\n\r\n\t}\r\n\t\r\n\tfunction ava_websignup_uc_product_alter(&$node){\r\n\t\tif ($node->data['module'] != 'ava_websignup') {\r\n\t\t\treturn;\r\n\t\t}\t\t\r\n\t\t$node->qty = 1;\r\n\t\t$node->price = $node->data['price'];\r\n\t}\r\n\r\n\r\n\tfunction ava_websignup_uc_cart_item_presave($entity){\r\n\t\tif ($entity->data['module'] != 'ava_websignup') {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t$entity->qty = 1;\r\n\t\t$entity->price = $entity->data['price'];\r\n\t\t\r\n\t}\r\n\t/**\r\n\t * Implements hook_cart_display().\r\n\t * @param $item\r\n\t *   An item in the shopping cart.\r\n\t * @param object $node\r\n\t *     Optional(this is not in the core hook).  Pass in a prepared node.\r\n\t *     This is used when asking for a quote - prioir to node_save being called\r\n\t *\r\n\t * @return\r\n\t *   A form element array to be processed by uc_cart_view_form().\r\n\t */\r\n\tfunction ava_websignup_uc_cart_display($item) {\r\n\t  global $user;\r\n\t  $node = node_load($item->nid);\r\n\t // print_r($node)\r\n\t  $description = $item->data['description'];\r\n\r\n\t  if (user_access('view all orders') || $user->uid == $item->cart_id) {\r\n\t\t$visible = TRUE;\r\n\t  }\r\n\t  else {\r\n\t\t$visible = FALSE;\r\n\t  }\r\n\r\n\t  $element = array();\r\n\t  $element['nid'] = array(\r\n\t\t'#type' => 'value',\r\n\t\t'#value' => $node->nid,\r\n\t  );\r\n\t  $element['module'] = array(\r\n\t\t'#type' => 'value',\r\n\t\t'#value' => 'ava_websignup',\r\n\t  );\r\n\t  $element['remove'] = array('#type' => 'checkbox');\r\n\t  $element['options'] = '';\r\n\t  $element['title'] = (!$visible) ? array('#markup' => check_plain($node->title)) : array('#markup' => l($node->title, 'node/' . $node->nid));\r\n\t  $element['description'] = array(\r\n\t\t'#markup' => '<p>' . $description . '</p>',\r\n\t\t//'#value' => \r\n\t  );\r\n\t  $element['#total'] = $item->price;\r\n\t  $element['data'] = array(\r\n\t\t'#type' => 'hidden',\r\n\t\t'#value' => serialize($item->data),\r\n\t  );\r\n\t  $element['qty'] = array(\r\n\t\t'#type' => 'textfield',\r\n\t\t'#default_value' => $item->qty,\r\n\t\t'#size' => 5,\r\n\t\t'#maxlength' => 6,\r\n\t  );\r\n\r\n\r\n\t  return $element;\r\n\t}\r\n\r\n\t/**\r\n\t * Implements hook_update_cart_item().\r\n\t *\r\n\t * Handles individual products or entire kits.\r\n\t */\r\n\tfunction ava_websignup_uc_update_cart_item($nid, $data = array(), $qty, $cid = NULL) {\r\n\t  if (!$nid) {\r\n\t\treturn NULL;\r\n\t  }\r\n\t  $cid = !(is_null($cid) || empty($cid)) ? $cid : uc_cart_get_id();\r\n\t  if ($qty < 1) {\r\n\t\tuc_cart_remove_item($nid, $cid, $data);\r\n\t  }\r\n\t  elseif ($qty > 1) {\r\n\t\tdrupal_set_message(t('You may only have one purchase one membership application.'));\r\n\t\tuc_product_update_cart_item($nid, $data, 1, $cid);\r\n\t  }\r\n\t}\r\n\t\r\n\tfunction ava_websignup_form_alter( &$form, &$form_state,$form_id ){\r\n\t\tif($form_id == 'webform_client_form_61802'){\r\n\t\t\tuc_cart_empty(uc_cart_get_id());\r\n\t\t\t$university_list = array();\r\n\t\t\t$university_list2 = array();\r\n\t\t\t$responseData_stud = json_decode(ava_websignup_api_call('POST', 'api/get_university', array('type' => 'stud')), true);\r\n\t\t\t$responseData_vet = json_decode(ava_websignup_api_call('POST', 'api/get_university', array('type' => 'full')), true);\r\n\t\t\t// print_r($responseData_stud);die();\r\n\t\t\t$form['#validate'][] = 'ava_websignup_check_validate';\r\n\t\t\t$form['#attached']['js'][] = drupal_get_path('module', 'ava_websignup') . '/ava_websignup.js';\r\n\t\t\t\r\n\t\t\t\t\t// print_r($form_state);\r\n\t\t\tif ($form_state['values']['details']['page_num'] == \"2\"){\r\n\t\t\t\t/* if($form_state['values']['submitted'][22] == 'FULL/SPOUS'){\r\n\t\t\t\t\tif($form_state['values']['submitted'][70] == \"\"){\r\n\t\t\t\t\t\tform_set_error('submitted[my_spouse_is]',\"Please input your spouse name.\");\r\n\t\t\t\t\t}\r\n\t\t\t\t} */\r\n\t\t\t\t\r\n\t\t\t\tif($form_state['values']['submitted'][42] == \"STDOL\" && $form_state['values']['op'] == t('Step 3')){\r\n\t\t\t\t\r\n\t\t\t\t\tglobal $user;\r\n\t\t\t\t\t$node = node_load(61802); //nid is the node id of your webform\r\n\t\t\t\t\t\r\n\r\n\t\t\t\t\t//the values to save\r\n\t\t\t\t\t$data = array(\r\n\t\t\t\t\t65 => array('value' => array($form_state['values']['submitted'][65])),\r\n\t\t\t\t\t4 => array('value' => array($form_state['values']['submitted'][4])),\r\n\t\t\t\t\t5 => array('value' => array($form_state['values']['submitted'][5])),\r\n\t\t\t\t\t6 => array('value' => array($form_state['values']['submitted'][6])),\r\n\t\t\t\t\t7 => array('value' => array($form_state['values']['submitted'][7])),\r\n\t\t\t\t\t8 => array('value' => array($form_state['values']['submitted'][8])),\r\n\t\t\t\t\t11 => array('value' => array($form_state['values']['submitted'][11])),\r\n\t\t\t\t\t9 => array('value' => array($form_state['values']['submitted'][9])),\r\n\t\t\t\t\t10 => array('value' => array($form_state['values']['submitted'][10])),\r\n\t\t\t\t\t12 => array('value' => array($form_state['values']['submitted'][12])),\r\n\t\t\t\t\t13 => array('value' => array($form_state['values']['submitted'][13])),\r\n\t\t\t\t\t14 => array('value' => array($form_state['values']['submitted'][14])),\r\n\t\t\t\t\t36 => array('value' => array($form_state['values']['submitted'][36])),\r\n\t\t\t\t\t39 => array('value' => array($form_state['values']['submitted'][39])),\r\n\t\t\t\t\t53 => array('value' => array($form_state['values']['submitted'][53])),\r\n\t\t\t\t\t38 => array('value' => array($form_state['values']['submitted'][38])),\r\n\t\t\t\t\t17 => array('value' => array($form_state['values']['submitted'][17])),\r\n\t\t\t\t\t66 => array('value' => array($form_state['values']['submitted'][66])),\r\n\t\t\t\t\t67 => array('value' => array($form_state['values']['submitted'][67])),\r\n\t\t\t\t\t41 => array('value' => array($form_state['values']['submitted'][41])),\r\n\t\t\t\t\t68 => array('value' => array($form_state['values']['submitted'][68])),\r\n\t\t\t\t\t69 => array('value' => array($form_state['values']['submitted'][69])),\t\t\t\t\t\r\n\t\t\t\t\t42 => array('value' => array($form_state['values']['submitted'][42])),\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\t$submission = (object) array(\r\n\t\t\t\t\t'nid' => 61802,\r\n\t\t\t\t\t'uid' => $user->uid,\r\n\t\t\t\t\t'submitted' => REQUEST_TIME,\r\n\t\t\t\t\t'remote_addr' => ip_address(),\r\n\t\t\t\t\t'is_draft' => FALSE,\r\n\t\t\t\t\t'data' => $data,\r\n\t\t\t\t  );\r\n\r\n\r\n\t\t\t\t  module_load_include('inc', 'webform', 'includes/webform.submissions');\r\n\t\t\t\t  webform_submission_insert($node, $submission);\r\n\t\t\t\t  webform_submission_send_mail($node, $submission);\r\n\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//unset($form['#validate']);\r\n\t\t\t//$form['#validate'][0] = 'ava_websignup_validate_function';\r\n\t\t\t// print_r($form_state);\r\n\t\t\tforeach($responseData_stud as $key=>$value){\r\n\t\t\t\t$university_list[$value['code'].\"|\".$value['division']] = $value['description'];\r\n\t\t\t}\r\n\t\t\tforeach($responseData_vet as $key=>$value){\r\n\t\t\t\t$university_list2[$value['code'].\"|\".$value['division']] = $value['description'];\r\n\t\t\t}\r\n\r\n\t\t \t$form['submitted']['stud_educational_information']['#options'] = $university_list;  \r\n\t\t \t$form['submitted']['vet_educational_information']['#options'] = $university_list2;  \r\n\t\t\t\r\n\t\t\t$chapter_list = array();\r\n\t\t\t$chapter_payment = array();\r\n\t\t\t$sig_list = array();\r\n\t\t\t$sig_payment = array();\r\n\t\t\t$dues_list = array();\r\n\t\t\t$dues_payment = array();\r\n\t\t\t$disabled_chapter = array();\r\n\t\t\t$all_payment = array();\r\n\t\t\t$stud_choosen = 0;\r\n\r\n\t\t\tif($form_state['storage']['submitted'][38] == 1){\r\n\t\t\t\tif($form_state['storage']['submitted'][22] == 'FULL/Yr'){\r\n\t\t\t\t\t$yr_send = intval(date(\"Y\")) - intval($form_state['storage']['submitted'][41]);\r\n\t\t\t\t\tif($yr_send <=1){\r\n\t\t\t\t\t\t$pricing_list = json_decode(ava_websignup_api_call('POST', 'api/get_pricing', array('cat' => 'FULL/YR1')), true);\r\n\t\t\t\t\t\t// $final_type = 'FULL/YR1';\r\n\t\t\t\t\t} else if($yr_send ==2){\r\n\t\t\t\t\t\t$pricing_list = json_decode(ava_websignup_api_call('POST', 'api/get_pricing', array('cat' => 'FULL/YR2')), true);\r\n\t\t\t\t\t\t// $final_type = 'FULL/YR2';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$pricing_list = json_decode(ava_websignup_api_call('POST', 'api/get_pricing', array('cat' => 'FULL/YR3')), true);\r\n\t\t\t\t\t\t// $final_type = 'FULL/YR3';\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$pricing_list = json_decode(ava_websignup_api_call('POST', 'api/get_pricing', array('cat' => $form_state['storage']['submitted'][22])), true);\r\n\t\t\t\t} \r\n\t\t\t} else if($form_state['storage']['submitted'][38] == 0 && $form_state['storage']['submitted'][17] != \"\" && $form_state['storage']['submitted'][42] == \"STUDN\"){\r\n\t\t\t\t$pricing_list = json_decode(ava_websignup_api_call('POST', 'api/get_pricing', array('cat' => 'STUDN')), true);\r\n\t\t\t\t$stud_choosen = 1;\r\n\t\t\t}\r\n\r\n\t\t\tif(isset($pricing_list) && !empty($pricing_list)){\r\n\t\t\t\tforeach($pricing_list as $key=>$value){\r\n\t\t\t\t\t\r\n\t\t\t\t\t$now = intval(date(\"n\")); // this will be used during final implementation.\r\n\t\t\t\t\t// $now = 2; // $now is the month of application. This is defaulted to 1(january) for testing purpose only.\r\n\t\t\t\t\tif($form_state['storage']['submitted'][42] == \"STUDN\") {\r\n\t\t\t\t\t\t$deducted_price = $value['BASE_1'];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif($now <= 3){\r\n\t\t\t\t\t\t\t$deducted_price = ($value['BASE_1']-($value['BASE_1']*.50));\r\n\t\t\t\t\t\t} else if($now >= 4 && $now <= 9){\r\n\t\t\t\t\t\t\t$deducted_price = $value['BASE_1'];\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t$deducted_price = ($value['BASE_1']-($value['BASE_1']*.25));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif($value['PROD_TYPE'] == \"CHAPT\"){\r\n\t\t\t\t\t\t$chapter_list[$value['PRODUCT_CODE']] = $value['TITLE'].\" $\". $deducted_price;\r\n\t\t\t\t\t\t$all_payment[$value['PRODUCT_CODE']] = $deducted_price;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t$all_title[$value['PRODUCT_CODE']] = $value['TITLE'];\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif($stud_choosen == 0){\r\n\t\t\t\t\t\t\tif($form_state['storage']['submitted'][10] == $value['PRODUCT_CODE']){\r\n\t\t\t\t\t\t\t\t$chapter_default = $value['PRODUCT_CODE'];\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tarray_push($disabled_chapter,$value['PRODUCT_CODE']);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t$the_chap = explode(\"|\",$form_state['storage']['submitted'][17]);\r\n\t\t\t\t\t\t\tif(substr($value['PRODUCT_CODE'],6) == $the_chap[1]){\r\n\t\t\t\t\t\t\t\t$chapter_default = $value['PRODUCT_CODE'];\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tarray_push($disabled_chapter,$value['PRODUCT_CODE']);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t} else if($value['PROD_TYPE'] == \"SEC\"){\r\n\t\t\t\t\t\t//\t$sig_list[$value['PRODUCT_CODE'].\"_\".$value['BASE_1']] = $value['TITLE'].\" $\". $deducted_price;\r\n\t\t\t\t\t\t//\t$all_payment[$value['PRODUCT_CODE'].\"_\".$value['BASE_1']] = $deducted_price;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t$sig_list[$value['PRODUCT_CODE']] = $value['TITLE'].\" $\". $deducted_price;\r\n\t\t\t\t\t\t$all_title[$value['PRODUCT_CODE']] = $value['TITLE'];\r\n\t\t\t\t\t\t$all_payment[$value['PRODUCT_CODE']] = $deducted_price;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t \t$form['submitted']['sig_options']['#options'] = $sig_list;\r\n\t\t\t\t\t    $form['submitted']['sig_options']['#theme'] = array('ava_websignup_multicolumn_options');  \r\n\t\t\t\t\t    $form['submitted']['sig_options']['#columns'] = 2;   \r\n\t\t\t\t\t    //$form['submitted']['sig_options']['#value'] = $sig_list['SG_AAHVJA|90.00'];\r\n\t\t\t\t\t\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$dues_list[$value['PRODUCT_CODE'].\"|\".$value['BASE_1']] = $value['TITLE'].\" $\". $deducted_price;\r\n\t\t\t\t\t\t$all_payment[$value['PRODUCT_CODE'].\"|\".$value['BASE_1']] = $deducted_price;\r\n\t\t\t\t\t\t$dues_default = $value['PRODUCT_CODE'].\"|\".$value['BASE_1'];\r\n\t\t\t\t\t\t$all_title[$value['PRODUCT_CODE'].\"|\".$value['BASE_1']] = $value['TITLE'];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\r\n\t\t\t\t$all_payment_array = $all_payment;\r\n\t\t\t\t$all_payment = json_encode($all_payment);\r\n\t\t\t\t\r\n\t\t\t\t$form['submitted']['chapter']['#options'] = $chapter_list;  \r\n\t\t\t\t$form['submitted']['chapter']['#theme'] = array('ava_websignup_multicolumn_options');  \r\n\t\t\t\t$form['submitted']['chapter']['#columns'] = 2;\r\n\t\t\t\t$form['submitted']['chapter']['#default_value'] = $chapter_default;  \r\n\t\t\t\tforeach($disabled_chapter as $key => $value){\r\n\t\t\t\t\t$form['submitted']['chapter'][$value] = array('#disabled' => TRUE,);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t$form['submitted']['national_subscription']['#options'] = $dues_list;  \r\n\t\t\t\t$form['submitted']['national_subscription']['#default_value'] = $dues_default; \r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t$form['submitted']['all_payment']['#value'] = $all_payment_array;\r\n\t\t\t\t$form['submitted']['all_title']['#value'] = $all_title;\r\n\t\t\t\t\r\n\t\t\t\t$form['submitted']['allprice']['#markup'] = \"<script>var all_payment=\" . $all_payment . \";</script>\";\r\n\t\t\t}\r\n\t\t//\tprint_r($form);\r\n\t\t\t/* if($form_state['storage']['submitted'][38] == 1){\r\n\t\t\t// echo \"wew\";\r\n\t\t\t\t// print_r($form_state);die();\r\n\t\t\t\t$pricing_list = json_decode(ava_websignup_api_call('POST', 'api/get_pricing', array('cat' => $form_state['storage']['submitted'][22])), true);\r\n\t\t\t\t// print_r($pricing_list);\r\n\t\t\t\t$chapter_list = array();\r\n\t\t\t\t$chapter_payment = array();\r\n\t\t\t\t$sig_list = array();\r\n\t\t\t\t$dues_list = array();\r\n\t\t\t\t$disabled_chapter = array();\r\n\t\t\t\tforeach($pricing_list as $key=>$value){\r\n\t\t\t\t\tif($value['PROD_TYPE'] == \"CHAPT\"){\r\n\t\t\t\t\t\t$chapter_list[$value['PRODUCT_CODE'].\"|\".$value['BASE_1']] = $value['TITLE'];\r\n\t\t\t\t\t\t$chapter_payment[$value['PRODUCT_CODE'].\"|\".$value['BASE_1']] = $value['BASE_1'];\r\n\t\t\t\t\t\tif($form_state['storage']['submitted'][10] == $value['PRODUCT_CODE']){\r\n\t\t\t\t\t\t\t$chapter_default = $value['PRODUCT_CODE'].\"|\".$value['BASE_1'];\r\n\t\t\t\t\t\t\t// echo $chapter_default;die();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tarray_push($disabled_chapter,$value['PRODUCT_CODE'].\"|\".$value['BASE_1']);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if($value['PROD_TYPE'] == \"SEC\"){\r\n\t\t\t\t\t\t$sig_list[$value['PRODUCT_CODE'].\"|\".$value['BASE_1']] = $value['TITLE'];\r\n\t\t\t\t\t\t// $form['submitted']['chapter'][$value['PRODUCT_CODE'].\"|\".$value['BASE_1']] = array('#disabled' => TRUE,);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$dues_list[$value['PRODUCT_CODE'].\"|\".$value['BASE_1']] = $value['TITLE'];\r\n\t\t\t\t\t\t$dues_default = $value['PRODUCT_CODE'].\"|\".$value['BASE_1'];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\t$wew = json_encode($chapter_list);\r\n\t\t\t\t\techo \"<script>var math=\" . $wew . \";</script>\";\r\n\t\t\t\t// print_r($disabled_chapter);\r\n\t\t\t\t $form['submitted']['sig_options']['#options'] = $sig_list;  \r\n\t\t\t\t\r\n\t\t\t\t$form['submitted']['chapter']['#options'] = $chapter_list;  \r\n\t\t\t\t$form['submitted']['chapter']['#default_value'] = $chapter_default;  \r\n\t\t\t\tforeach($disabled_chapter as $key => $value){\r\n\t\t\t\t\t$form['submitted']['chapter'][$value] = array('#disabled' => TRUE,);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t$form['submitted']['national_subscription']['#options'] = $dues_list;  \r\n\t\t\t\t$form['submitted']['national_subscription']['#default_value'] = $dues_default; \r\n\t\t\t\t\r\n\t\t\t} else if($form_state['storage']['submitted'][38] == 0 && $form_state['storage']['submitted'][17] != \"\" && $form_state['storage']['submitted'][47] == \"STUDN\"){\r\n\t\t\t\techo \"wow\";\r\n\t\t\t\tprint_r($form_state);\r\n\t\t\t\t$the_chap = explode(\"|\",$form_state['storage']['submitted'][17]);\r\n\t\t\t\t// echo $the_chap. \"----\";\r\n\t\t\t\t$pricing_list = json_decode(ava_websignup_api_call('POST', 'api/get_pricing', array('cat' => 'STUDN')), true);\r\n\t\t\t\t// print_r($pricing_list);die();\r\n\t\t\t\t$chapter_list = array();\r\n\t\t\t\t$chapter_payment = array();\r\n\t\t\t\t$sig_list = array();\r\n\t\t\t\t$sig_payment = array();\r\n\t\t\t\t$dues_list = array();\r\n\t\t\t\t$dues_payment = array();\r\n\t\t\t\t$disabled_chapter = array();\r\n\t\t\t\tforeach($pricing_list as $key=>$value){\r\n\t\t\t\t\tif($value['PROD_TYPE'] == \"CHAPT\"){\r\n\t\t\t\t\t\t$chapter_list[$value['PRODUCT_CODE'].\"|\".$value['BASE_1']] = $value['TITLE'];\r\n\t\t\t\t\t\t$chapter_payment[$value['PRODUCT_CODE'].\"|\".$value['BASE_1']] = $value['BASE_1'];\r\n\t\t\t\t\t\tif(substr($value['PRODUCT_CODE'],6) == $the_chap[1]){\r\n\t\t\t\t\t\t\t$chapter_default = $value['PRODUCT_CODE'].\"|\".$value['BASE_1'];\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tarray_push($disabled_chapter,$value['PRODUCT_CODE'].\"|\".$value['BASE_1']);\r\n\t\t\t\t\t\t} \r\n\t\t\t\t\t\t\r\n\t\t\t\t\t} else if($value['PROD_TYPE'] == \"SEC\"){\r\n\t\t\t\t\t\t$sig_list[$value['PRODUCT_CODE'].\"|\".$value['BASE_1']] = $value['TITLE'];\r\n\t\t\t\t\t\t$sig_payment[$value['PRODUCT_CODE'].\"|\".$value['BASE_1']] = $value['BASE_1'];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$dues_list[$value['PRODUCT_CODE'].\"|\".$value['BASE_1']] = $value['TITLE'];\r\n\t\t\t\t\t\t$dues_payment[$value['PRODUCT_CODE'].\"|\".$value['BASE_1']] = $value['BASE_1'];\r\n\t\t\t\t\t\t$dues_default = $value['PRODUCT_CODE'].\"|\".$value['BASE_1'];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t$form['submitted']['sig_options']['#options'] = $sig_list;  \r\n\t\t\t\t\r\n\t\t\t\t$form['submitted']['chapter']['#options'] = $chapter_list;  \r\n\t\t\t\t$form['submitted']['chapter']['#default_value'] = $chapter_default;  \r\n\t\t\t\tforeach($disabled_chapter as $key => $value){\r\n\t\t\t\t\t$form['submitted']['chapter'][$value] = array('#disabled' => TRUE,);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t$form['submitted']['national_subscription']['#options'] = $dues_list;  \r\n\t\t\t\t$form['submitted']['national_subscription']['#default_value'] = $dues_default;   \r\n\t\t\t} */\r\n\t\t}\r\n\t}\r\n\t\r\n/* \tfunction ava_websignup_select_title($form, $form_state){\r\n\t\techo $form_state; die();\r\n\t\t// $form['submitted']['ava_websignup_email_address']['#default_value'] = \"wew@wew.com\";\r\n\t\t// return $form['ava_websignup_email_address'];\r\n\t\t// print_r($form);die();\r\n\t\t// $form['submitted']['chapter']['#options'] = array(\"wew\" => \"Wew\"); \r\n\t\t// $form['chapter']['und']['#options'] = array(\"wew\" => \"Wew\"); \r\n\t\t// return $form['chapter'];\r\n\t\t// return $form['submitted']['national_subscription']['#options'];\r\n\t\t$element = $form['submitted']['chapter'];\r\n\t\t$element['#options'] = array(\"wew\"=>\"wew\");\r\n\t\treturn $element;\r\n\r\n\t} */\r\n\t\r\n\t/**\r\n\t * Theme function to format elements into multiple columns\r\n\t */\r\n\tfunction theme_ava_websignup_multicolumn_options($element) {\r\n\t\t// print_r($element);die();\r\n\t  $stripped_element = array_values($element);\r\n\t  $element = $stripped_element[0];\r\n\r\n\t  // Initialize variables.\r\n\t  $output = '';\r\n\t  $total_columns = (isset($element['#columns'])) ? $element['#columns'] : 2;\r\n\t  $total_options = count($element['#options']);\r\n\t  $options_per_column = ceil($total_options / $total_columns);\r\n\t  $keys = array_keys($element['#options']);\r\n\t  $type = $element[$keys[0]]['#type'];\r\n\r\n\t  // Start wrapper div.\r\n\t  $output .= '<div class=\"multicolumn-options-wrapper clearfix\">';\r\n\t  $current_column = 1;\r\n\t  $current_option = 0;\r\n\r\n\t  while ($current_column <= $total_columns) {\r\n\t\t// Start column div.\r\n\t\t$output .=  '<div class=\"multicolumn-options-column\" style=\"float:left;\">';\r\n\r\n\t\t// Keep looping through until the maximum options per column are reached,\r\n\t\t// or you run out of options.\r\n\t\twhile ($current_option < $options_per_column * $current_column \r\n\t\t\t\t  && $current_option < $total_options) {\r\n\t\t  // Output as either check or radio button depending on the element type.\r\n\t\t  $output .= drupal_render($element[$keys[$current_option]]);\r\n\t\t  $current_option++;\r\n\t\t}\r\n\r\n\t\t// End column div.\r\n\t\t$output .= '</div>';\r\n\t\t$current_column++;\r\n\t  }\r\n\r\n\t  // End wrapper div.\r\n\t  $output .= '</div>';\r\n\r\n\t  return $output;\r\n\t}\r\n\r\n\t/**\r\n\t * Implements hook_theme().\r\n\t */\r\n\tfunction ava_websignup_theme($existing, $type, $theme, $path) {\r\n\t  return array(\r\n\t\t'ava_websignup_multicolumn_options' => array(\r\n\t\t  'render element' => 'form',\r\n\t\t),\r\n\t  );\r\n\t}\r\n\t\r\n\t\r\n\t/*\r\n\t* This is the validate for review \r\n\t*/ \r\n/* \t\r\nfunction web_signup_review_form_validate($form, &$form_state) {\r\n\t$current_step = $form_state['storage']['step'];\r\n\t$form_state['storage'][$current_step] = $form_state['values'];\r\n\r\n\tif ($form_state['values']['op'] == t('<< Back')) { //back button\r\n\t\t$form_state['storage']['step'] = 1;\r\n\t\t$form_state['rebuild'] = TRUE;\r\n\t\t//don't validate required fields for the back button\r\n\t}\r\n\telse if ($form_state['values']['op'] == t('Next >>')) { //next button\r\n\t\t$form_state['storage']['step'] = 2;\r\n\t\t$form_state['rebuild'] = TRUE;\r\n\t\t// veted_calendar_listing_validate_fields($current_step, $form, $form_state); //validate required fields etc\r\n\t\t\r\n\t}\r\n\telse if ($form_state['values']['op'] == t('Submit')) { //finish button\r\n\t\t$form_state['rebuild'] = FALSE;\r\n\t\t// veted_calendar_listing_validate_fields($current_step, $form, $form_state); //validate required fields etc\r\n\t}\r\n}\r\n */\r\n\r\n/**\r\n * Implements hook_order().\r\n *\r\n * We listen for new orders arriving that need processing\r\n *\r\n * @param string $op the operating being performed\r\n * @param Order $arg1 the order object\r\n * @param mixed $arg2 depends on the arg\r\n */\r\nfunction ava_websignup_uc_order($op, &$arg1, $arg2) {\r\n\tmodule_load_include('inc','webform','includes/webform.submissions');\r\n\tglobal $base_url;\r\n\tswitch ($op) { \r\n\t\tcase 'update':\r\n\t\t\tforeach ($arg1->products as $item) {\r\n\t\t\t\tif ($arg2 == 'completed' && $item->data['module'] == 'ava_websignup'){ \r\n\t\t\t\t\r\n\t\t\t\t\t$result = webform_get_submission($item->data['webform_id'],$item->data['submission_id']);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// print_r($result);die();\r\n\t\t\t\t\t/*** Insert Data ***/\r\n\t\t\t\t\tif($result->data[22]['value'][0] == 'FULL/Yr'){\r\n\t\t\t\t\t\t$yr_member = intval(date(\"Y\")) - intval($result->data[41]['value'][0]);\r\n\t\t\t\t\t\tif($yr_member <=1){\r\n\t\t\t\t\t\t\t// $pricing_list = json_decode(ava_websignup_api_call('POST', 'api/get_pricing', array('cat' => 'FULL/YR1')), true);\r\n\t\t\t\t\t\t\t$member = 'FULL/YR1';\r\n\t\t\t\t\t\t} else if($yr_member ==2){\r\n\t\t\t\t\t\t\t// $pricing_list = json_decode(ava_websignup_api_call('POST', 'api/get_pricing', array('cat' => 'FULL/YR2')), true);\r\n\t\t\t\t\t\t\t$member = 'FULL/YR2';\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// $pricing_list = json_decode(ava_websignup_api_call('POST', 'api/get_pricing', array('cat' => 'FULL/YR3')), true);\r\n\t\t\t\t\t\t\t$member = 'FULL/YR3';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$member = $result->data[22]['value'][0];\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t//title \r\n\t\t\t\t\t\r\n\t\t\t\t\tswitch ($result->data[65]['value'][0]){\r\n\t\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\t\t$title = \"Miss\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\t\t$title = \"Mr\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\t\t$title = \"Mrs\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\t\t$title = \"Ms\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 4:\r\n\t\t\t\t\t\t\t$title = \"Dr\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 5:\r\n\t\t\t\t\t\t\t$title = \"Professor\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t$title = \"Dr\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t\t$state = explode(\"/\", $result->data[10]['value'][0]);\r\n\t\t\t\t\r\n\t\t\t\t\t$address = $result->data[11]['value'][0].\", \".$result->data[9]['value'][0].\", \".$state[1].\", \".$result->data[12]['value'][0].\", Australia\";\r\n\t\t\t\t\t\r\n\t\t\t\t\t$type = explode(\"/\", $member); //member type\r\n\t\t\t\t\t\r\n\t\t\t\t\t$chapter = explode(\"|\", $result->data[63]['value'][0]);\r\n\t\t\t\t\t$chapter = explode(\"/\", $chapter[0]);\r\n\t\t\t\t\t\r\n\t\t\t\t\t$middle_name = $result->data[6]['value'][0] != \"\" ? strtoupper(substr($result->data[6]['value'][0], 0)).\". \" : \" \";\r\n\t\t\t\t\t\r\n\t\t\t\t\t/* $data = array(\r\n\t\t\t\t\t\t'ORG_CODE' => 'AVA',\r\n\t\t\t\t\t\t'MEMBER_TYPE' => $type[0],\r\n\t\t\t\t\t\t'CATEGORY' =>  $type[1],\r\n\t\t\t\t\t\t'STATUS' => 'P',\r\n\t\t\t\t\t\t'LAST_FIRST' => strtoupper($result->data[5]['value'][0]).\", \".strtoupper($result->data[4]['value'][0]),\r\n\t\t\t\t\t\t'COMPANY_SORT' => '',\r\n\t\t\t\t\t\t'FULL_NAME' => $title.\". \".$result->data[4]['value'][0].\" \".$middle_name.\" \".$result->data[5]['value'][0],\r\n\t\t\t\t\t\t'COMPANY' => '',\r\n\t\t\t\t\t\t'FULL_ADDRESS' => $address,\r\n\t\t\t\t\t\t'PREFIX' => strtoupper($title),\r\n\t\t\t\t\t\t'FIRST_NAME' => $result->data[4]['value'][0],\r\n\t\t\t\t\t\t'MIDDLE_NAME' => $result->data[6]['value'][0],\r\n\t\t\t\t\t\t'LAST_NAME' => $result->data[5]['value'][0],\r\n\t\t\t\t\t\t'INFORMAL' => $result->data[4]['value'][0],\r\n\t\t\t\t\t\t'WORK_PHONE' => $result->data[13]['value'][0],\r\n\t\t\t\t\t\t'HOME_PHONE' => '',\r\n\t\t\t\t\t\t'FAX' => '',\r\n\t\t\t\t\t\t'TOLL_FREE' => $result->data[14]['value'][0],\r\n\t\t\t\t\t\t'CITY' => strtoupper($result->data[9]['value'][0]),\r\n\t\t\t\t\t\t'STATE_PROVINCE' => strtoupper($state[1]),\r\n\t\t\t\t\t\t'ZIP' => $result->data[12]['value'][0],\r\n\t\t\t\t\t\t'MAIL_ADDRESS' => $address,\r\n\t\t\t\t\t\t'BILL_ADDRESS' => $address,\r\n\t\t\t\t\t\t'GENDER' => $result->data[8]['value'][0],\r\n\t\t\t\t\t\t'BIRTH_DATE' =>  $result->data[7]['value'][0].\" 00:00:00\",\r\n\t\t\t\t\t\t'CHAPTER' => $chapter[0],\r\n\t\t\t\t\t\t'MEMBER_RECORD' => 'TRUE',\r\n\t\t\t\t\t\t'COMPANY_RECORD' => 'FALSE',\r\n\t\t\t\t\t\t'JOIN_DATE' => date('Y-m-d h:i:s'),\r\n\t\t\t\t\t\t'PAID_THRU' => '2015-06-30 00:00:00',\r\n\t\t\t\t\t\t'MEMBER_STATUS' => 'P',\r\n\t\t\t\t\t\t'MEMBER_STATUS_DATE' => '',\r\n\t\t\t\t\t\t'PREVIOUS_MT' => 'P',\r\n\t\t\t\t\t\t'MT_CHANGE_DATE' => date('Y-m-d h:i:s'),\r\n\t\t\t\t\t\t'DATE_ADDED' => date('Y-m-d h:i:s'),\r\n\t\t\t\t\t\t'LAST_UPDATED' => date('Y-m-d h:i:s'),\r\n\t\t\t\t\t\t'ADDRESS_NUM_1' => '', //save first address in Name Address tble before proceeding.\r\n\t\t\t\t\t\t'ADDRESS_NUM_2' => '', //save first address in Name Address tble before proceeding.\r\n\t\t\t\t\t\t'ADDRESS_NUM_3' => '', //save first address in Name Address tble before proceeding.\r\n\t\t\t\t\t\t'SHIP_ADDRESS_NUM' => '', //save first address in Name Address tble before proceeding.\r\n\t\t\t\t\t\t'EMAIL' => 'junnel@alphasys.com.au6',\r\n\t\t\t\t\t\t'SIG' => $result->data[51]['value'], \r\n\t\t\t\t\t\t'STREET' => $result->data[11]['value'],\r\n\t\t\t\t\t\t'COUNTRY' => 'Australia',\r\n\t\t\t\t\t);\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t$pricing_list = json_decode(ava_websignup_api_call('POST', 'http://10.0.10.202/jack_api/api/save_member_data', array('data'=>json_encode($data))), true);\r\n\t\t\t\t\t\r\n\t\t\t\t\tprint_r($result); die();\t */\t\t\t\r\n\r\n\t\t\t\t\t$submitted['Name']['Prefix'] = $title;\r\n\t\t\t\t\t$submitted['Name']['FirstName'] = $result->data[4]['value'][0];\r\n\t\t\t\t\t$submitted['Name']['Informal'] = $result->data[4]['value'][0];\r\n\t\t\t\t\t$submitted['Name']['MiddleName'] = $result->data[6]['value'][0];\r\n\t\t\t\t\t$submitted['Name']['LastName'] = $result->data[5]['value'][0];\r\n\t\t\t\t\t$submitted['Name']['BirthDate'] = $submission->data[7]['value'][0].\" 00:00:00\";\r\n\t\t\t\t\t$submitted['Name_Demographics'][0]['DATE_OF_BIRTH'] = $result->data[7]['value'][0].\" 00:00:00\";\r\n\t\t\t\t\t //$submitted['Name']['Gender'] = substr($submission->data[6]['value'][0], 0, 1);\r\n\t\t\t\t\t$submitted['Name_Demographics'][0]['GENDER'] =\t$result->data[8]['value'][0];\r\n\t\t\t\t\t$submitted['Name']['HomePhone'] =$result->data[13]['value'][0];\r\n\t\t\t\t\t$submitted['Name']['WorkPhone'] = $result->data[13]['value'][0];\r\n\t\t\t\t\t$submitted['Name']['Fax'] = '';\r\n\t\t\t\t\t$submitted['Name']['Mobile'] =$result->data[14]['value'][0];\r\n\t\t\t\t\t\r\n\t\t\t\t\tif ($result->data[42]['value'][0] == \"STUDN\"){\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t$submitted['Name']['BillingCategory'] = \"STUDN\";\r\n\t\t\t\t\t\t$submitted['Name']['CustomerTypeCode'] = \"STUDN\";\r\n\t\t\t\t\t\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$submitted['Name']['BillingCategory'] = $type[1];\r\n\t\t\t\t\t\t$submitted['Name']['CustomerTypeCode'] = $type[0];\r\n\t\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t$submitted['Address']['Postal']['Email'] = $result->data[36]['value'][0];\r\n\t\t\t\t\t$submitted['Address']['Postal']['Address1'] = $result->data[11]['value'];\r\n\t\t\t\t\t$submitted['Address']['Postal']['City'] =  strtoupper($result->data[9]['value'][0]);\r\n\t\t\t\t\t$submitted['Address']['Postal']['State'] = strtoupper($state[1]);\r\n\t\t\t\t\t$submitted['Address']['Postal']['PostalCode'] = $result->data[12]['value'][0];\r\n\t\t\t\t\t$submitted['Address']['Postal']['Country'] = 'Australia';\r\n\t\t\t\t\t$submitted['Address']['Postal']['IsPreferredMail'] = TRUE;\r\n\t\t\t\t\t$submitted['Address']['Postal']['IsPreferredBill'] = TRUE;\r\n\t\t\t\t\t$submitted['Address']['Postal']['IsPreferredShip'] = TRUE;\r\n\t\t\t\t\t  /*\r\n\t\t\t\t\t   Not needed as per spec\r\n\t\t\t\t\t   $submitted['Address']['Home']['Address1'] = $submission->data[11]['value'][0];\r\n\t\t\t\t\t   $submitted['Address']['Home']['City'] = $submission->data[12]['value'][0];\r\n\t\t\t\t\t   $submitted['Address']['Home']['State'] = $submission->data[66]['value'][0];\r\n\t\t\t\t\t   $submitted['Address']['Home']['PostalCode'] = $submission->data[67]['value'][0];\r\n\t\t\t\t\t   */\r\n\t\t\t\t\t$email = $result->data[36]['value'][0];\r\n\t\t\t\t\t\r\n\t\t\t\t\t$activity = array();\r\n\t\t\t\t\tif (isset($result->data[42]['value'][0]) && $result->data[42]['value'][0] == 'STUDN'){\r\n\t\t\t\t\t\t$activity['PRODUCT_CODE'] = $result->data[66]['value'][0]; //Degree\r\n\t\t\t\t\t\t$faculty = explode(\"|\",$result->data[17]['value'][0]);\r\n\t\t\t\t\t\t$activity['UF_1'] = $faculty[0]; //Faculty\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\t\t$faculty = explode(\"|\",$result->data[90]['value'][0]);\r\n\t\t\t\t\t\t$activity['UF_1'] = $faculty[0]; //Faculty\r\n\t\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t\t$activity['UF_2'] = 'AUS'; //Country\r\n\t\t\t\t\t$activity['DESCRIPTION'] =$result->data[67]['value'][0]; //Year\r\n\t\t\t\t\t\r\n\t\t\t\t\t$contact_id = imis_contact_insert_contact();\r\n\t\t\t\t\t$username = strtoupper($submitted['Name']['LastName']) . $contact_id;\r\n\t\t\t\t\t$password = 'member1001';\r\n\t\t\t\t\timis_user_promote_contact_to_web_user($contact_id, $username, $password); //gives username and password\r\n\r\n\t\t\t\t\timis_contact_sync_single($contact_id, FALSE);\r\n\t\t\t\t\t$c = imis_contact_load($contact_id);\r\n\t\t\t\t\t$account->name = $username;\r\n\t\t\t\t\t$account->imis['ContactId'] = $contact_id;\r\n\t\t\t\t\timis_contact_inflate($account);\r\n\r\n\t\t\t\t\t$modified_account = imis_base_clone($account);\r\n\t\t\t\t\t$modified_account->imis = $submitted;\r\n\t\t\t\t\timis_contact_submit_to_imis($account, $modified_account, array('Name-Membership' => 'Name-Membership', 'Name' => 'Name'));\r\n\t\t\t\t\timis_activities_save($contact_id, 'DEGREE', $activity);\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t$res1 = 0;\r\n\t\t\t\t\t$res2 = 0;\r\n\t\t\t\t\t$res3 = 0;\r\n\t\t\t\t\t$res4 = 0;\r\n\t\t\t\t\t$res5 = 0;\r\n\t\t\t\t\t$res6 = \"\";\r\n\t\t\t\t\tif($result->data[39]['value'][0] == '0'){\r\n\t\t\t\t\t\t$res1 = 1;\r\n\t\t\t\t\t} else if($result->data[39]['value'][0] == '1'){\r\n\t\t\t\t\t\t$res2 = 1;\r\n\t\t\t\t\t} else if($result->data[39]['value'][0] == '2'){\r\n\t\t\t\t\t\t$res3 = 1;\r\n\t\t\t\t\t} else if($result->data[39]['value'][0] == '3'){\r\n\t\t\t\t\t\t$res4 = 1;\r\n\t\t\t\t\t} else if($result->data[39]['value'][0] == '4'){\r\n\t\t\t\t\t\t$res5 = 1;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$res6 = $result->data[53]['value'][0];\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$date_chop =explode(\"-\",$result->data[7]['value'][0]);\r\n\t\t\t\t\tif (isset($result->data[42]['value'][0]) && $result->data[42]['value'][0] == 'STUDN'){\r\n\t\t\t\t\t\t$data = array(\r\n\t\t\t\t\t\t'STATUS' => 'A',\r\n\t\t\t\t\t\t'ID' => $contact_id,\r\n\t\t\t\t\t\t'JOIN_REASON_1' => $res1,\r\n\t\t\t\t\t\t'JOIN_REASON_2' => $res2,\r\n\t\t\t\t\t\t'JOIN_REASON_3' => $res3,\r\n\t\t\t\t\t\t'JOIN_REASON_4' => $res4,\r\n\t\t\t\t\t\t'JOIN_REASON_5' => $res5,\r\n\t\t\t\t\t\t'JOIN_REASON_6' => $res6,\r\n\t\t\t\t\t\t'EMAIL' => $result->data[36]['value'][0],\r\n\t\t\t\t\t\t'LAST_UPDATED' => date('Y-m-d h:i:s'),\r\n\t\t\t\t\t\t'CHAPTER' => $state[1],\r\n\t\t\t\t\t\t'ADDRESS_1' => $result->data[11]['value'][0],\r\n\t\t\t\t\t\t'TYPE' => 'STUDN',\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$data = array(\r\n\t\t\t\t\t\t'STATUS' => 'A',\r\n\t\t\t\t\t\t'ID' => $contact_id,\r\n\t\t\t\t\t\t'JOIN_REASON_1' => $res1,\r\n\t\t\t\t\t\t'JOIN_REASON_2' => $res2,\r\n\t\t\t\t\t\t'JOIN_REASON_3' => $res3,\r\n\t\t\t\t\t\t'JOIN_REASON_4' => $res4,\r\n\t\t\t\t\t\t'JOIN_REASON_5' => $res5,\r\n\t\t\t\t\t\t'JOIN_REASON_6' => $res6,\r\n\t\t\t\t\t\t'EMAIL' => $result->data[36]['value'][0],\r\n\t\t\t\t\t\t'LAST_UPDATED' => date('Y-m-d h:i:s'),\r\n\t\t\t\t\t\t'CHAPTER' => $state[1],\r\n\t\t\t\t\t\t'ADDRESS_1' => $result->data[11]['value'][0],\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t'segment' => $result->data[93]['value'][0],\r\n\t\t\t\t\t\t'work' => $result->data[99]['value'][0],\r\n\t\t\t\t\t\t'avj' => $result->data[101]['value'][0]==0?0:1,\r\n\t\t\t\t\t\t'payee' => $result->data[100]['value'][0],\r\n\t\t\t\t\t\t'terms' => 1,\r\n\t\t\t\t\t\t'gender' => $result->data[8]['value'][0] == \"F\" ? \"female\": \"male\",\r\n\t\t\t\t\t\t'birthDate' => array(\r\n\t\t\t\t\t\t\t\t\t\t\t'year' =>$date_chop[0],\r\n\t\t\t\t\t\t\t\t\t\t\t'month' =>$date_chop[1],\r\n\t\t\t\t\t\t\t\t\t\t\t'day' =>$date_chop[2],\r\n\t\t\t\t\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t'marketing' => $result->data[101]['value'][1]==1?0:1,\r\n\t\t\t\t\t\t'undergraduate' => '',\r\n\t\t\t\t\t\t'TYPE' => 'FULL',\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t$result1 =  json_decode(ava_websignup_api_call('POST', 'api/change_member_status', array('data'=>json_encode($data))), true);\r\n\t\t\t\t\t\r\n\t\t\t\t\t$key = imis_base_get_admin_key();\r\n\t\t\t\t\t$changed['Name']['BirthDate'] = $result->data[7]['value'][0].\" 00:00:00\";\r\n\t\t\t\t\t$changed['Name']['Gender'] = $result->data[8]['value'][0] == \"F\" ? \"Female\": \"Male\"; \r\n\t\t\t\t\timis_contact_update_contact($key, $contact_id, $changed['Name']);\r\n\t\t\t\t\t\r\n\t\t\t\t\t$studn = \"\";\r\n\t\t\t\t\tif (isset($result->data[42]['value'][0]) && !empty($result->data[42]['value'][0])){\r\n\t\t\t\t\t\tif ($result->data[42]['value'][0] == \"STUDN\"){\r\n\t\t\t\t\t\t\t$studn = 'STUDN';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else if(isset($result->data[22]['value'][0]) && !empty($result->data[22]['value'][0])) {\r\n\t\t\t\t\t\t$save_activity_data = array('ID' => $contact_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t'PRODUCT_CODE' => $result->data[68]['value'][0],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t'DESCRIPTION' => $result->data[41]['value'][0],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t'REG_NO' => $result->data[69]['value'][0],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\tjson_decode(ava_websignup_api_call('POST', 'api/save_activity_board', array('data'=>json_encode($save_activity_data))), true); \r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t/* This is for billing section\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\tTYPE = STUDN, FULL/NODIS, FULL/RED50, etc.\r\n\t\t\t\t\t\tSIG => All SIG's selected\r\n\t\t\t\t\t\tAI_NATIONAL => \r\n\t\t\t\t\r\n\t\t\t\t\t*/\r\n\t\t\t\t\t\r\n\t\t\t\t\t$stdol_now = intval(date(\"n\"));\r\n\t\t\t\t\t// $stdol_now = 2;\r\n\t\t\t\t\tif(($stdol_now >= 4 && $stdol_now <= 9) || ($stdol_now >= 10 && $stdol_now <= 12)){\r\n\t\t\t\t\t\t$expire_year1 = intval(date('Y') + 1);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$expire_year1 = date('Y');\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tforeach($item->data['A1_NATIONAL'] as $a1_key=>$a1_val){\r\n\t\t\t\t\t\t$a1_arr = $a1_val;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(isset($result->data[22]['value'][0]) && $result->data[22]['value'][0] =='FULL/SPOUS'){\r\n\t\t\t\t\t\t$data_billing = array(\r\n\t\t\t\t\t\t\t'TYPE' => $studn=='STUDN'?'STUDN':$result->data[22]['value'][0],\r\n\t\t\t\t\t\t\t'ID' => $contact_id,\r\n\t\t\t\t\t\t\t'SIG' => $item->data['SIG'],\r\n\t\t\t\t\t\t\t'A1_NATIONAL' => $item->data['A1_NATIONAL'],\r\n\t\t\t\t\t\t\t'CHAPT' => $item->data['CHAPT'],\r\n\t\t\t\t\t\t\t// 'date_applied' => date('Y-m-d h:i:s'),\r\n\t\t\t\t\t\t\t'date_applied' => date('Y-m-d h:i:s'),\r\n\t\t\t\t\t\t\t// 'date_paid_thru' => date('2015-07-01 00:00:00'),\t\r\n\t\t\t\t\t\t\t'date_paid_thru' => ((string)$expire_year1).\"-06-30 00:00:00\",\t\r\n\t\t\t\t\t\t\t// 'bill_begin' => date('Y-m-d h:i:s'), // january 1\r\n\t\t\t\t\t\t\t'bill_begin' => ((string)$expire_year1).\"-07-01 00:00:00\",\r\n\t\t\t\t\t\t\t'MEMBER_CATEGORY' => $result->data[93]['value'][0],\r\n\t\t\t\t\t\t\t'SPOUSE_ID' => $result->data[71]['value'][0],\r\n\t\t\t\t\t\t\t'SPOUSE_GIVEN' => $result->data[70]['value'][0],\r\n\t\t\t\t\t\t\t'SPOUSE_SURNAME' => $result->data[92]['value'][0],\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$final_type = $result->data[22]['value'][0];\r\n\t\t\t\t\t\tif(isset($result->data[22]['value'][0]) && $result->data[22]['value'][0] == 'FULL/Yr'){\r\n\t\t\t\t\t\t\t$yr_ans = intval(date(\"Y\")) - intval($result->data[41]['value'][0]);\r\n\t\t\t\t\t\t\tif($yr_ans <=1){\r\n\t\t\t\t\t\t\t\t$final_type = 'FULL/YR1';\r\n\t\t\t\t\t\t\t} else if($yr_ans <=2){\r\n\t\t\t\t\t\t\t\t$final_type = 'FULL/YR2';\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$final_type = 'FULL/YR3';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t$data_billing = array(\r\n\t\t\t\t\t\t\t'TYPE' => $studn=='STUDN'?'STUDN':$final_type,\r\n\t\t\t\t\t\t\t'ID' => $contact_id,\r\n\t\t\t\t\t\t\t'SIG' => $item->data['SIG'],\r\n\t\t\t\t\t\t\t'A1_NATIONAL' => $item->data['A1_NATIONAL'],\r\n\t\t\t\t\t\t\t'CHAPT' => $item->data['CHAPT'],\r\n\t\t\t\t\t\t\t// 'date_applied' => date('Y-m-d h:i:s'),\r\n\t\t\t\t\t\t\t'date_applied' => date('Y-m-d h:i:s'),\r\n\t\t\t\t\t\t\t// 'date_paid_thru' => date('2015-07-01 00:00:00'),\t\r\n\t\t\t\t\t\t\t'date_paid_thru' => ((string)$expire_year1).\"-06-30 00:00:00\",\t\r\n\t\t\t\t\t\t\t// 'bill_begin' => date('Y-m-d h:i:s'), // january 1\r\n\t\t\t\t\t\t\t'bill_begin' => ((string)$expire_year1).\"-07-01 00:00:00\",\r\n\t\t\t\t\t\t\t'MEMBER_CATEGORY' => $result->data[93]['value'][0],\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\t\r\n\t\t\t\t\t \r\n\t\t\t\t\t$result2 =  json_decode(ava_websignup_api_call('POST', 'api/create_billing', array('data'=>json_encode($data_billing))), true); \r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t/* This is for transaction and Batches */ \r\n\t\t\t\t\t\r\n\t\t\t\t\t$imis_order['BillToContactId'] = $contact_id;\r\n\r\n\r\n\t\t\t\t\t$system_id = '001';\r\n\r\n\r\n\t\t\t\t\tif (!variable_get('imis_ubercart_batch_management', FALSE)) {\r\n\t\t\t\t\t\t$formula = variable_get('imis_ubercart_batch_formula', '');\r\n\t\t\t\t\t\t$batch = eval($formula);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t$order = $item->order;\r\n\t\t\t\t\t\r\n\t\t\t\t\t$payments = uc_payment_load_payments($order->order_id);\r\n\r\n\t\t\t\t\t// Assume the credit card payment is in the first\r\n\t\t\t\t\t$payment = array_shift($payments);\r\n\t\t\t\t\tif (!is_array($payment->data)) {\r\n\t\t\t\t\t  $payment->data = unserialize($payment->data);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$imis_order['PaymentType'] = imis_ubercart_payment_type('CreditCard');\r\n\t\t\t\t\t$imis_order['CreditCardNumber'] = $order->payment_details['cc_number'];\r\n\t\t\t\t\t$imis_order['CreditCardExpiration'] = $order->payment_details['cc_exp_month'] . '/' . substr($order->payment_details['cc_exp_year'], 2);\r\n\t\t\t\t\t$imis_order['CreditDebitCardHoldersName'] = $order->payment_details['cc_owner'];\r\n\t\t\t\t\t$imis_order['PaymentAmount'] = $payment_amount;\r\n\t\t\t\t\t//print_r($ubercart_order);\r\n\t\t\t\t\t// print_r($payment);die();\r\n\t\t\t\t\t// store the reference as Ubercart order ID - credit card transaction ID, but since there's a limit of\r\n\t\t\t\t\t// 9 chars, if it goes off this, truncate the credit card ID, as it's kept in drupal anyway\r\n\t\t\t\t\t$trans_ref = substr($order->order_id . '-' . $payment->data['authcode'], 0, 9);\r\n\t\t\t\t\t$imis_order['CreditDebitCardAuthorizationCode'] = $trans_ref;\r\n\r\n\t\t\t\t\t$first_cc_number = substr($order->payment_details['cc_number'], 0, 1);\r\n\t\t\t\t\t$cc_number_length = strlen($order->payment_details['cc_number']);\r\n\t\t\t\t\tif ($first_cc_number == '3' && $cc_number_length == 14) {\r\n\t\t\t\t\t\t$imis_order['CashAccountCode'] = variable_get('imis_ubercart_cash_account_diners', '');\r\n\t\t\t\t\t}\r\n\t\t\t\t\telseif ($first_cc_number == '3' && $cc_number_length == 15) {\r\n\t\t\t\t\t\t$imis_order['CashAccountCode'] = variable_get('imis_ubercart_cash_account_americanexpress', '');\r\n\t\t\t\t\t}\r\n\t\t\t\t\telseif ($first_cc_number == '4') {\r\n\t\t\t\t\t\t$imis_order['CashAccountCode'] = variable_get('imis_ubercart_cash_account_visa', '');\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if ($first_cc_number == '5') {\r\n\t\t\t\t\t\t$imis_order['CashAccountCode'] = variable_get('imis_ubercart_cash_account_mastercard', '');\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if ($first_cc_number == '6') {\r\n\t\t\t\t\t\t$imis_order['CashAccountCode'] = variable_get('imis_ubercart_cash_account_discover', '');\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t$imis_order['CashAccountCode'] = variable_get('imis_ubercart_cash_account_default', '');\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$imis_order['SourceCode'] = variable_get('imis_ubercart_source_code', '');\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t$title = $item->data['title'];\r\n\t\t\t\t\t$pricing = $item->data['pricing'];\r\n\t\t\t\t\t\r\n\t\t\t\t\tforeach ($item->data['A1_NATIONAL'] as $key => $value){\r\n\t\t\t\t\t\t$ai_key = $key; \r\n\t\t\t\t\t\t$ai_value = $value; \r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tforeach ($item->data['CHAPT'] as $key => $value){\r\n\t\t\t\t\t\t$chapt_key = $key; \r\n\t\t\t\t\t\t$chapt_value = $value; \r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t$key_code = explode(\"|\", $ai_key);\r\n\t\t\t\t\t\r\n\t\t\t\t\t$trans_data[] = array(\r\n\t\t\t\t\t\t\t'LINE_NUMBER' => 1,\r\n\t\t\t\t\t\t\t'BATCH_NUM'\t=> $batch,\r\n\t\t\t\t\t\t\t'OWNER_ORG_CODE' => 'AVA',\r\n\t\t\t\t\t\t\t'SOURCE_SYSTEM' => 'DUES',\r\n\t\t\t\t\t\t\t'JOURNAL_TYPE' => 'PAY',\r\n\t\t\t\t\t\t\t'TRANSACTION_TYPE' => 'DIST',\r\n\t\t\t\t\t\t\t'TRANSACTION_DATE' => date('Y-m-d'),\r\n\t\t\t\t\t\t\t'BT_ID' => $contact_id,\r\n\t\t\t\t\t\t\t'ST_ID' => $contact_id,\r\n\t\t\t\t\t\t\t'DESCRIPTION' => $title[$ai_key],\r\n\t\t\t\t\t\t\t'SOURCE_CODE' => $imis_order['SourceCode'],\r\n\t\t\t\t\t\t\t'PRODUCT_CODE' => $key_code[0],\r\n\t\t\t\t\t\t\t'EFFECTIVE_DATE' => date('Y-m-d h:i:s'),\r\n\t\t\t\t\t\t\t'PAID_THRU' => ((string)$expire_year1).\"-06-30 00:00:00\",\r\n\t\t\t\t\t\t\t'MONTHS_PAID' => '12',\r\n\t\t\t\t\t\t\t'GL_ACCT_ORG_CODE' => 'AVA',\t\r\n\t\t\t\t\t\t\t'PSEUDO_ACCOUNT' => 'AVA-DUES-'.$key_code[0],\r\n\t\t\t\t\t\t\t'QUANTITY' => '1',\r\n\t\t\t\t\t\t\t'PROD_TYPE' => 'DUES',\t\t\t\r\n\t\t\t\t\t\t\t'ACTIVITY_TYPE' => 'DUES',\r\n\t\t\t\t\t\t\t'ACTION_CODES' => 'A',\r\n\t\t\t\t\t\t\t'DATE_ENTERED' =>  date('Y-m-d'),\r\n\t\t\t\t\t\t\t'ENTERED_BY' => 'MANAGER',\r\n\t\t\t\t\t\t\t'SUB_LINE_NUMBER' => 1,\r\n\t\t\t\t\t\t\t'AMOUNT' => -1 * floatval($ai_value), //should be negative\t\r\n\t\t\t\t\t);\r\n\t\t\t\t\t\r\n\t\t\t\t\t$trans_data[] = array(\r\n\t\t\t\t\t\t\t'LINE_NUMBER' => 2,\r\n\t\t\t\t\t\t\t'BATCH_NUM'\t=> $batch,\r\n\t\t\t\t\t\t\t'OWNER_ORG_CODE' => 'AVA',\r\n\t\t\t\t\t\t\t'SOURCE_SYSTEM' => 'DUES',\r\n\t\t\t\t\t\t\t'JOURNAL_TYPE' => 'PAY',\r\n\t\t\t\t\t\t\t'TRANSACTION_TYPE' => 'DIST',\r\n\t\t\t\t\t\t\t'TRANSACTION_DATE' => date('Y-m-d'),\r\n\t\t\t\t\t\t\t'BT_ID' => $contact_id,\r\n\t\t\t\t\t\t\t'ST_ID' => $contact_id,\r\n\t\t\t\t\t\t\t'DESCRIPTION' => $title[$chapt_key],\r\n\t\t\t\t\t\t\t'SOURCE_CODE' => $imis_order['SourceCode'],\r\n\t\t\t\t\t\t\t'PRODUCT_CODE' => $chapt_key,\r\n\t\t\t\t\t\t\t'EFFECTIVE_DATE' => date('Y-m-d h:i:s'),\r\n\t\t\t\t\t\t\t'PAID_THRU' => ((string)$expire_year1).\"-06-30 00:00:00\",\r\n\t\t\t\t\t\t\t'MONTHS_PAID' => '12',\r\n\t\t\t\t\t\t\t'GL_ACCT_ORG_CODE' => 'AVA',\t\r\n\t\t\t\t\t\t\t'PSEUDO_ACCOUNT' => 'AVA-DUES-'.$chapt_key,\r\n\t\t\t\t\t\t\t'QUANTITY' => '1',\r\n\t\t\t\t\t\t\t'PROD_TYPE' => 'CHAPT',\t\t\t\r\n\t\t\t\t\t\t\t'ACTIVITY_TYPE' => 'DUES',\r\n\t\t\t\t\t\t\t'ACTION_CODES' => 'A',\r\n\t\t\t\t\t\t\t'DATE_ENTERED' =>  date('Y-m-d'),\r\n\t\t\t\t\t\t\t'ENTERED_BY' => 'MANAGER',\r\n\t\t\t\t\t\t\t'SUB_LINE_NUMBER' => 1,\r\n\t\t\t\t\t\t\t'AMOUNT' => -1 * floatval($chapt_value),\t//should be negative\t\t\r\n\t\t\t\t\t);\r\n\t\t\t\t\t\r\n\r\n\t\t\t\t\t$counter = 3;\r\n\t\t\t\t\t\r\n\t\t\t\t\tforeach ($item->data['SIG'] as $key => $values) {\r\n\t\t\t\t\t\t/*  $contact = imis_contact_load($product->data['contact_id']);\r\n\t\t\t\t\t\t//This will fetch a new copy of any billing data into $contact\r\n\t\t\t\t\t\timis_billing_imis_contact_process($contact);\r\n\t\t\t\t\t\t$node = node_load($product->nid);\r\n\t\t\t\t\t\t$price = imis_billing_renewal_quote($node, $contact, $tax);\r\n\t\t\t\t\t\t$amount = ($price - $tax) * $product->qty;\r\n\t\t\t\t\t\t$effective_date = \"July 01, \".(date('Y') + 1);\r\n\t\t\t\t\t\t$effective_date = date('Y-m-d', strtotime($effective_date));\r\n\t\t\t\t\t\t$thru_date = \"June 30, \".date('Y');\r\n\t\t\t\t\t\t$thru_date = date('Y-m-d', strtotime($thru_date)); */\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t$trans_data[] = array(\r\n\t\t\t\t\t\t\t'LINE_NUMBER' => $counter,\r\n\t\t\t\t\t\t\t'BATCH_NUM'\t=> $batch,\r\n\t\t\t\t\t\t\t'OWNER_ORG_CODE' => 'AVA',\r\n\t\t\t\t\t\t\t'SOURCE_SYSTEM' => 'DUES',\r\n\t\t\t\t\t\t\t'JOURNAL_TYPE' => 'PAY',\r\n\t\t\t\t\t\t\t'TRANSACTION_TYPE' => 'DIST',\r\n\t\t\t\t\t\t\t'TRANSACTION_DATE' => date('Y-m-d'),\r\n\t\t\t\t\t\t\t'BT_ID' => $contact_id,\r\n\t\t\t\t\t\t\t'ST_ID' => $contact_id,\r\n\t\t\t\t\t\t\t'DESCRIPTION' => $title[$key],\r\n\t\t\t\t\t\t\t'SOURCE_CODE' => $imis_order['SourceCode'],\r\n\t\t\t\t\t\t\t'PRODUCT_CODE' => $key,\r\n\t\t\t\t\t\t\t'EFFECTIVE_DATE' => date('Y-m-d h:i:s'),\r\n\t\t\t\t\t\t\t'PAID_THRU' => ((string)$expire_year1).\"-06-30 00:00:00\",\r\n\t\t\t\t\t\t\t'MONTHS_PAID' => '12',\r\n\t\t\t\t\t\t\t'GL_ACCT_ORG_CODE' => 'AVA',\t\r\n\t\t\t\t\t\t\t'PSEUDO_ACCOUNT' => 'AVA-DUES-'.$key,\r\n\t\t\t\t\t\t\t'QUANTITY' => '1',\r\n\t\t\t\t\t\t\t'PROD_TYPE' => 'SEC',\t\t\t\r\n\t\t\t\t\t\t\t'ACTIVITY_TYPE' => 'DUES',\r\n\t\t\t\t\t\t\t'ACTION_CODES' => 'A',\r\n\t\t\t\t\t\t\t'DATE_ENTERED' =>  date('Y-m-d'),\r\n\t\t\t\t\t\t\t'ENTERED_BY' => 'MANAGER',\r\n\t\t\t\t\t\t\t'SUB_LINE_NUMBER' => 1,\r\n\t\t\t\t\t\t\t'AMOUNT' => -1 * floatval($values),\t//should be negative\t\t\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\t$counter++;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t$final_cc_num = \"\";\r\n\t\t\t\t\t$the_cc_number = strlen($imis_order['CreditCardNumber']) - 4;\r\n\t\t\t\t\tfor($x=0;$x<$the_cc_number;$x++){\r\n\t\t\t\t\t\t$final_cc_num .='*';\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$final_cc_num = $final_cc_num.substr($imis_order['CreditCardNumber'],-4);\r\n\t\t\t\t\t //This is for payment;\r\n\t\t\t\t\t$trans_data[] = array(\r\n\t\t\t\t\t\t'LINE_NUMBER' => $counter,\r\n\t\t\t\t\t\t'BATCH_NUM'\t=> $batch,\r\n\t\t\t\t\t\t'OWNER_ORG_CODE' => 'AVA',\r\n\t\t\t\t\t\t'SOURCE_SYSTEM' => 'DUES',\r\n\t\t\t\t\t\t'JOURNAL_TYPE' => 'PAY',\r\n\t\t\t\t\t\t'TRANSACTION_TYPE' => 'PAY',\r\n\t\t\t\t\t\t'TRANSACTION_DATE' => date('Y-m-d'),\r\n\t\t\t\t\t\t'BT_ID' => $contact_id,\r\n\t\t\t\t\t\t'ST_ID' => $contact_id,\r\n\t\t\t\t\t\t'SOURCE_CODE' => $imis_order['SourceCode'],\r\n\t\t\t\t\t\t'PSEUDO_ACCOUNT' => 'AVA-DUES-PAY',\r\n\t\t\t\t\t\t'PAYMENT_TYPE' =>  imis_ubercart_payment_type('CreditCard'),\r\n\t\t\t\t\t\t'CHECK_NUMBER' =>\t$imis_order['CashAccountCode'] ,\r\n\t\t\t\t\t\t// 'CC_NUMBER' => \t$imis_order['CreditCardNumber'], //make this to ****************1234\r\n\t\t\t\t\t\t'CC_NUMBER' => \t$final_cc_num, //make this to ****************1234\r\n\t\t\t\t\t\t'CC_EXPIRE' => $imis_order['CreditCardExpiration'] ,\r\n\t\t\t\t\t\t'CC_AUTHORIZE' =>$payment->data['authcode'],\r\n\t\t\t\t\t\t'CC_NAME' => $imis_order['CreditDebitCardHoldersName'],\r\n\t\t\t\t\t\t'DATE_ENTERED' =>  date('Y-m-d'),\r\n\t\t\t\t\t\t'SUB_LINE_NUMBER' => 1,\r\n\t\t\t\t\t\t'ENTERED_BY' => 'MANAGER',\r\n\t\t\t\t\t\t'AMOUNT' => $order->order_total,\t\t\t//print_r($order) to get total amount.\r\n\t\t\t\t\t\t'GL_ACCT_ORG_CODE' => 'AVA',\t\t\t\r\n\t\t\t\t\t);\r\n\t\t\t\t\t\r\n\r\n\t\t\t\t\tif ($result->data[42]['value'][0] == \"STUDN\"){\r\n\t\t\t\t\t\t$the_member_type = 'STUDN';\r\n\t\t\t\t\t\t$the_member_category = 'STUDN';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$the_member_category = $type[1];\r\n\t\t\t\t\t\t$the_member_type = $type[0];\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$passData = array(\r\n\t\t\t\t\t\t 'data'=>\r\n\t\t\t\t\t\t\t json_encode(array(\r\n\t\t\t\t\t\t\t\t 'transaction' => $trans_data,\r\n\t\t\t\t\t\t\t\t 'BATCH_NUM' => $batch,\r\n\t\t\t\t\t\t\t\t 'total' => $order->order_total,\r\n\t\t\t\t\t\t\t\t 'SIG'\t=> (isset($result->data[51]['value']))?$result->data[51]['value']:'',\r\n\t\t\t\t\t\t\t\t 'A1_NATIONAL'\t=> $result->data[64]['value'][0],\r\n\t\t\t\t\t\t\t\t 'CHAPTER'\t=> $result->data[63]['value'][0],\r\n\t\t\t\t\t\t\t\t 'price_list'\t=> $result->data[85]['value'],\r\n\t\t\t\t\t\t\t\t 'description_list'\t=> $result->data[86]['value'],\r\n\t\t\t\t\t\t\t\t 'ID'\t=> $contact_id,\r\n\t\t\t\t\t\t\t\t 'MEMBER_TYPE'\t=> $the_member_type,\r\n\t\t\t\t\t\t\t\t 'CATEGORY'\t=> $the_member_category,\r\n\t\t\t\t\t\t\t )\r\n\t\t\t\t\t\t )\r\n\t\t\t\t\t );\t\t\r\n\t\t\t\t\t// print_r(ava_websignup_api_call('POST', 'api/set_billing_transaction',$passData));die();\r\n\t\t\t\t\t//$responseData = ava_event_api_call('POST','api/set_billing_transaction',$passData);  \r\n\t\t\t\t\t$responseData =  json_decode(ava_websignup_api_call('POST', 'api/set_billing_transaction',$passData), true); \r\n\t\t\t\t\t//print_r($responseData);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t/* End code */\r\n\t\t\t\t\t\r\n\t\t\t\t\t$message = \"Welcome to the AVA!<br/><br/>\r\n\t\t\t\t\t\r\n\t\t\t\t\tYou can now log in to the AVA website with the following details:<br/><br/>\r\n\t\t\t\t\tUsername: \" . $username . \"<br/>\r\n\t\t\t\t\tPassword: member1001<br/><br/>\r\n\t\t\t\t\t\r\n\t\t\t\t\tYour member pack will be sent to you in the post shortly to your nominated postal address. Also, an electronic receipt will also be emailed to you in any moment. <br/><br/>\r\n\t\t\t\t\t\r\n\t\t\t\t\tPlease contact AVA membership if you have any questions via email <a href='mailto:members@ava.com.au'>members@ava.com.au</a>\";\r\n\r\n\t\t\t\t\t  $params = array(\r\n\t\t\t\t\t\t'subject' => 'AVA membership',\r\n\t\t\t\t\t\t'message' => $message,\r\n\t\t\t\t\t  );\r\n\t\t\t\t\t//  drupal_mail('imis_base', 'ava_membership_' . $contact_id, $email, language_default(), $params);\r\n\t\t\t\t\tdrupal_mail('imis_base', 'ava_membership_' . $contact_id, $result->data[36]['value'][0], language_default(), $params);\r\n\t\t\t\t\t\r\n\t\t\t\t\tdrupal_mail('imis_base', 'ava_membership_' . $contact_id, 'junnel@alphasys.com.au', language_default(), $params);\r\n\t\t\t\t\t\r\n\t\t\t\t\t$message = '\r\n\t\t\t\t\tA new membership application has been received with the following details:<br/><br/>\r\n\t\t\t\t\tMember ID: <strong>'.$contact_id.'<br/></strong>\r\n\t\t\t\t\tBatch Number: <strong>'.$batch.'<br/></strong>\r\n\t\t\t\t\t';\r\n\t\t\t\t\t\r\n\t\t\t\t\tif ((isset($result->data[42]['value'][0]) && $result->data[42]['value'][0] == 'STUDN')){\r\n\t\t\t\t\t\t$message .= \"Have you ever been subject to disciplinary proceedings for professional misconduct? - <strong>\".$result->data[96]['value'][1].\"</strong><br/>\";\r\n\t\t\t\t\t\t$message .= \"In the last 5 years has any claim been made against you or are you aware of any facts or circumstances which may give rise to a claim against you in the future? - <strong>\".$result->data[96]['value'][2].\"</strong><br/>\";\r\n\t\t\t\t\t\t$message .= \"Do you perform any professional services that fall outside the terms of your program of study as a veterinary student? - <strong>\".$result->data[96]['value'][3].\"</strong><br/>\";\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tif((isset($result->data[22]['value'][0]) && $result->data[22]['value'][0]  == 'FULL/Yr')){\r\n\t\t\t\t\t\t\t$yr_member = intval(date(\"Y\")) - intval($result->data[41]['value'][0]);\r\n\t\t\t\t\t\t\tif($yr_member <=1){\r\n\t\t\t\t\t\t\t\t// $pricing_list = json_decode(ava_websignup_api_call('POST', 'api/get_pricing', array('cat' => 'FULL/YR1')), true);\r\n\t\t\t\t\t\t\t\t$member12 = 'FULL/YR1';\r\n\t\t\t\t\t\t\t} else if($yr_member ==2){\r\n\t\t\t\t\t\t\t\t// $pricing_list = json_decode(ava_websignup_api_call('POST', 'api/get_pricing', array('cat' => 'FULL/YR2')), true);\r\n\t\t\t\t\t\t\t\t$member12 = 'FULL/YR2';\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t// $pricing_list = json_decode(ava_websignup_api_call('POST', 'api/get_pricing', array('cat' => 'FULL/YR3')), true);\r\n\t\t\t\t\t\t\t\t$member12 = 'FULL/YR3';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif ($member12 == \"FULL/YR1\" || $member12==\"FULL/YR2\"){\r\n\t\t\t\t\t\t\t\t$message .= \"Have you ever been subject to disciplinary proceedings for professional misconduct? - <strong>\".$result->data[96]['value'][1].\"</strong><br/>\";\r\n\t\t\t\t\t\t\t\t$message .= \"In the last 5 years has any claim been made against you or are you aware of any facts or circumstances which may give rise to a claim against you in the future? - <strong>\".$result->data[96]['value'][2].\"</strong><br/>\";\r\n\t\t\t\t\t\t\t\t$message .= \"Do you perform any professional services that fall outside the terms of your program of study as a veterinary student? - <strong>\".$result->data[96]['value'][3].\"</strong><br/>\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tglobal $base_url;\r\n\t\t\t\t\t$message .= \"You can review the application here: \".$base_url.\"/node/\".$result->nid.\"/submission/\".$result->sid;\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t$params = array(\r\n\t\t\t\t\t\t'subject' => 'New AVA Membership Application Received',\r\n\t\t\t\t\t\t'message' => $message,\r\n\t\t\t\t\t);\r\n\t\t\t\t\t//  drupal_mail('imis_base', 'ava_membership_' . $contact_id, $email, language_default(), $params);\r\n\t\t\t\t\tdrupal_mail('imis_base', 'ava_membership_' . $contact_id, 'junnel@alphasys.com.au', language_default(), $params);\r\n\t\t\t\t\t\r\n\t\t\t\t\tdrupal_mail('imis_base', 'ava_membership_' . $contact_id, 'members@ava.com.au', language_default(), $params);\r\n\t\t\t\t\t\r\n\t\t\t\t\tdrupal_goto(\"order-confirmation-page\", array(\r\n\t\t\t\t\t\t'query' => array(\r\n\t\t\t\t\t\t\t'id' => $order->order_id,\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t));\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\tbreak;\r\n  }\r\n\r\n}\r\n\r\n\r\nmembership_websignup.js:\r\n\r\n/* Copyright (C) Alphasys Pty Ltd, Inc - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by John Hope Ondona, John Lennon Maghanoy & John Mark, January 2015\r\n */\r\n\r\n/* Immediately-invoked function expression\r\n * ---------------------------------------\r\n * Used to avoid variable hoisting from within blocks,\r\n * protect against polluting the global environment\r\n * and simultaneously allow public access to methods\r\n * while retaining privacy for variables defined\r\n * within the function\r\n */\r\n(function($, window, undefined) { /* Parameters can be shortened or renamed */\r\n\r\n'use strict'; // uses strict coding standard\r\n\r\n/**\r\n * jQuery's DOM Load callback\r\n * initialize function\r\n */\r\n$(document).ready(function() {\r\n\r\n\tweb_signup_default_add();\r\n\tshow_step2();\r\n\r\n\t$(\"#webform-component-spouse-given-name label\").html($(\"#webform-component-spouse-given-name label\").text() + \"<span class='form-required' title='This field is required.'>*</span>\");\r\n\t$(\"#webform-component-spouse-surname label\").html($(\"#webform-component-spouse-surname label\").text() + \"<span class='form-required' title='This field is required.'>*</span>\");\r\n\t$(\"#webform-component-spouses-ava-member-number label\").html($(\"#webform-component-spouses-ava-member-number label\").text() + \"<span class='form-required' title='This field is required.'>*</span>\");\r\n\r\n\r\n\t$('#edit-submitted-sig-options .form-checkbox').click(function() {\r\n\t\tconsole.log($(this).val());\r\n\t\tvar tot = 0;\r\n\t\tvar sum = parseFloat(all_payment[$(\"input[name='submitted[chapter]']:checked\").val()]) + parseFloat(all_payment[$(\"input[name='submitted[national_subscription]']:checked\").val()]);\r\n\t\t$(\"#webform-component-sig-options .form-checkbox\").each(function() {\r\n\t\t\t// alert($(this).val());\r\n\t\t\tvar wew = this.checked ? parseFloat(all_payment[$(this).val()]) : 0;\r\n\t\t\tsum = sum + wew;\r\n\t\t\ttot = tot + wew;\r\n\t\t});\r\n\t\t$('#ava_websignup_bill').html('$' + sum.toFixed(2));\r\n\t\t$('#sig_total').html('$' + tot.toFixed(2));\r\n\t});\r\n\r\n\t/* this part is for step 2 showing of data start here \r\n\t * note : some of this part will be omitted when it will be put in the live site\r\n\t */\r\n\r\n\t$(\".page-node-61802 #webform-component-are-you-eligible-for #edit-submitted-are-you-eligible-for\").change(function(e) {\r\n\t\tshow_step2();\r\n\t});\r\n\r\n\t$(\"#node-61802 #edit-actions #edit-next\").click(function(e) {\r\n\t\tconsole.log(\"Navigating to next page...\");\r\n\t\tvar yrcompleted = $(\"#edit-submitted-vet-year-completed\").val();\r\n\r\n\t\tif ($(this).val() == \"Step 2\") {\r\n\t\t\tlocalStorage.setItem(\"yrcompleted\", yrcompleted);\r\n\t\t}\r\n\r\n\t\tif ($(this).val() == \"Step 3\") {\r\n\r\n\t\t\t$(\".messages.error\").remove();\r\n\r\n\t\t\tvar eligib_type2 = $('.page-node-61802 #webform-component-are-you-eligible-for #edit-submitted-are-you-eligible-for').val();\r\n\t\t\tvar STUDENT_TYPE = $(\"#webform-component-type-of-student-membership-appliied #edit-submitted-type-of-student-membership-appliied\").val();\r\n\r\n\t\t\tif (eligib_type2 == 'FULL/SPOUS') {\r\n\t\t\t\tvar error = 0, message = \"\"; // check for errors and define the message to apply\r\n\r\n\t\t\t\tif ($(\"#edit-submitted-spouse-given-name\").val() == \"\") {\r\n\t\t\t\t\terror = 1;\r\n\t\t\t\t\tmessage = \"Please input your spouse given name.<br/>\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($(\"#edit-submitted-spouse-surname\").val() == \"\") {\r\n\t\t\t\t\terror = 1;\r\n\t\t\t\t\tmessage += \"Please input your spouse surname.<br/>\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($(\"#edit-submitted-spouses-ava-member-number\").val() == \"\") {\r\n\t\t\t\t\terror = 1;\r\n\t\t\t\t\tmessage += \"Please input your spouse member number.<br/>\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (error == 1) {\r\n\t\t\t\t\tconsole.log(\"naay error\");\r\n\t\t\t\t\t$('.page-node-61802 #title').prepend(\"<div class='messages error'>\" + message + \"</div>\");\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(\".messages.error\").remove();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (STUDENT_TYPE == 'STUDN' || eligib_type2 == 'FULL/Yr') {\r\n\t\t\t\t\tvar error = 0, message = \"\"; // check for errors and define the message to apply\r\n\t\t\t\t\tvar sample2 = localStorage.getItem(\"yrcompleted\");\r\n\t\t\t\t\tvar currtime = new Date();\r\n\t\t\t\t\tvar curryr = currtime.getFullYear();\r\n\t\t\t\t\tvar yrcalc2 = curryr - parseInt(sample2);\r\n\r\n\t\t\t\t\tif (STUDENT_TYPE == 'STUDN' || (eligib_type2 == 'FULL/Yr' && yrcalc2 <= 2)) {\r\n\r\n\t\t\t\t\t\tconsole.log('sulod jud unta sa 2');\r\n\r\n\t\t\t\t\t\tif (!(atLeastOneRadioIsChecked('submitted[insurance][relation__student_master_policy][1]') && atLeastOneRadioIsChecked('submitted[insurance][relation__student_master_policy][2]') && atLeastOneRadioIsChecked('submitted[insurance][relation__student_master_policy][3]'))) {\r\n\t\t\t\t\t\t\t$('.page-node-61802 #title').prepend(\"<div class='messages error'>Please answer all the student master policy question.<br/></div>\");\r\n\t\t\t\t\t\t\t$('html,body').animate({ scrollTop: 0 }, 'slow');\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t$(\".messages.error\").remove();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// if (error == 1) {\r\n\t\t\t\t\t\t\t// $('.page-node-61802 #title').prepend(\"<div class='messages error'>\" + message + \"</div>\");\r\n\t\t\t\t\t\t\t// return false;\r\n\t\t\t\t\t\t// } else {\r\n\t\t\t\t\t\t\t// $(\".messages.error\").remove();\r\n\t\t\t\t\t\t// }\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t/*\r\n\t\t\t\t\t\tif (!($(\"input[name='submitted[insurance][relation__student_master_policy][1]']:checked\").val())) {\r\n\t\t\t\t\t\t\terror = 1;\r\n\t\t\t\t\t\t\tmessage = \"Please answer all the student master policy question.<br/>\";\r\n\t\t\t\t\t\t} else if (!($(\"input[name='submitted[insurance][relation__student_master_policy][2]']:checked\").val())) {\r\n\t\t\t\t\t\t\terror = 1;\r\n\t\t\t\t\t\t\tmessage = \"Please answer all the student master policy question.<br/>\";\r\n\t\t\t\t\t\t} else if (!($(\"input[name='submitted[insurance][relation__student_master_policy][3]']:checked\").val())) {\r\n\t\t\t\t\t\t\terror = 1;\r\n\t\t\t\t\t\t\tmessage = \"Please answer all the student master policy question.<br/>\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (error == 1) {\r\n\t\t\t\t\t\t\t$('.page-node-61802 #title').prepend(\"<div class='messages error'>\" + message + \"</div>\");\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t$(\".messages.error\").remove();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t*/\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t});\r\n\r\n\r\n\t$(\"#webform-component-type-of-student-membership-appliied #edit-submitted-type-of-student-membership-appliied\").change(function(e) {\r\n\t\tconsole.log($(this).val());\r\n\t\tvar eligib_type = $(this).val();\r\n\t\tif (eligib_type == 'STDOL') {\r\n\t\t\t$(\".page-node-61802 #webform-component-insurance\").hide();\r\n\t\t\t$(\".page-node-61802 #webform-component-student-online legend .fieldset-legend\").text(\"Student Online\");\r\n\t\t\t$(\".page-node-61802 #webform-component-student-online div .fieldset-description\").text(\"Student Online Members have free access to AVA Website. To receive the AVJ and free GUILD insurance as a Student Member, you need to upgrade to a Paid Student Member\");\r\n\t\t} else if (eligib_type == 'STUDN') {\r\n\t\t\t$(\".page-node-61802 #webform-component-insurance\").show().css({\r\n\t\t\t\t'display': 'inline',\r\n\t\t\t\t'width': '92%'\r\n\t\t\t});\r\n\t\t\t$(\".page-node-61802 #webform-component-student-online legend .fieldset-legend\").text(\"Student Paid\");\r\n\t\t\t$(\".page-node-61802 #webform-component-student-online div .fieldset-description\").text(\"Paid Student Members are eligible for complimentary PI insurance under the AVA Student Master Policy\");\r\n\r\n\t\t}\r\n\t});\r\n\r\n\t$(\"#edit-submitted-type-category\").change(function(evt) {\r\n\t\tswitch (this.value) {\r\n\t\t\tcase \"0\":\r\n\t\t\t\tclearFields([\"edit-submitted-stud-educational-information\",\r\n\t\t\t\t\t\t\t \"edit-submitted-degree\",\r\n\t\t\t\t\t\t\t \"edit-submitted-degree-year\"]);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"1\":\r\n\t\t\t\tclearFields([\"edit-submitted-vet-educational-information\",\r\n\t\t\t\t\t\t\t \"edit-submitted-vet-year-completed\",\r\n\t\t\t\t\t\t\t \"edit-submitted-state-board-registered\",\r\n\t\t\t\t\t\t\t \"edit-submitted-state-board-registration-number\"]);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t});\r\n\r\n\t// $(\".page-node-61802 #webform-component-are-you-eligible-for #edit-submitted-are-you-eligible-for\").change(function(e) {\r\n\t// });\r\n\t/* this part is for step 2 showing of data start here */\r\n});\r\n\r\n/**\r\n * [clearFields description]\r\n * @param  {String[]} fieldsArray Array of String ids\r\n */\r\nfunction clearFields(fieldsArray) {\r\n\twhile (true) {\r\n\t\tdocument.getElementById(fieldsArray.pop()).value = \"\";\r\n\t\tif (fieldsArray.length == 0) break;\r\n\t}\r\n}\r\n\r\n/**\r\n * [atLeastOneRadioIsChecked description]\r\n * @param  {String} name [description]\r\n * @return {Boolean}      [description]\r\n */\r\nfunction atLeastOneRadioIsChecked(name) {\r\n    return ($('input[name=\"' + name + '\"]:checked').size() > 0);\r\n}\r\n\r\n/**\r\n * [web_signup_default_add description]\r\n * @return {[type]} [description]\r\n */\r\nfunction web_signup_default_add() {\r\n\tif (typeof all_payment != 'undefined') {\r\n\t\t$(\"#edit-submitted-chapter .multicolumn-options-column .form-item-submitted-chapter .option\").each(function() {\r\n\t\t\tvar res = $(this).text().split(\"$\");\r\n\t\t\t$(this).html(\"<div class='websignup_option_name'>\" + res[0] + \"</div><div class='websignup_option_price'> $\" + res[1] + \"</div>\");\r\n\t\t});\r\n\r\n\t\t$(\"#edit-submitted-sig-options .multicolumn-options-column .form-type-checkbox .option\").each(function() {\r\n\t\t\tvar res = $(this).text().split(\"$\");\r\n\t\t\t$(this).html(\"<div class='websignup_option_name'>\" + res[0] + \"</div><div class='websignup_option_price'> $\" + res[1] + \"</div>\");\r\n\t\t});\r\n\t\t\r\n\t\tvar tot = 0;\r\n\t\t/* $('.form-item-submitted-chapter .add-checkbox:checked').each(function() {\r\n\t\ttot += math[$(this).attr('id')];\r\n\t\t}); */\r\n\t\tvar sum = parseFloat(all_payment[$(\"input[name='submitted[chapter]']:checked\").val()]) + parseFloat(all_payment[$(\"input[name='submitted[national_subscription]']:checked\").val()]);\r\n\t\t$(\"#webform-component-sig-options .form-checkbox\").each(function() {\r\n\t\t\t\t// alert($(this).val());\r\n\t\t\t\tvar wew = this.checked ? parseFloat(all_payment[$(this).val()]) : 0;\r\n\t\t\t\tsum = sum + wew;\r\n\t\t\t\ttot = tot + wew;\r\n\t\t\t});\r\n\t\t$('#ava_websignup_bill').html('$' + sum.toFixed(2));\r\n\t\t$('#sig_total').html('$' + tot.toFixed(2));\r\n\t\t$('#national_subscription_total').html('$' + all_payment[$(\"input[name='submitted[national_subscription]']:checked\").val()]);\r\n\t\t$('#chapter_total').html('$' + all_payment[$(\"input[name='submitted[chapter]']:checked\").val()]);\r\n\t}\r\n}\r\n\r\n/**\r\n * [hidden_step2 description]\r\n * @return {[type]} [description]\r\n */\r\nfunction hidden_step2() {\r\n\ttry\t{\r\n\t\t$(\".page-node-61802 #webform-component-yr1-2, .page-node-61802 #webform-component-yr3, .page-node-61802 #webform-component-graduate-description, .page-node-61802 #webform-component-spouse-given-name, .page-node-61802 #webform-component-spouses-ava-member-number, .page-node-61802 #webform-component-spouse-membership-status, .page-node-61802 #webform-component-spouse-surname, .page-node-61802 #webform-component-insurance\").hide();\r\n\t} catch (exception) {\r\n\t\t// do nothing\r\n\t}\r\n}\r\n\r\n/**\r\n * [show_step2 description]\r\n * @return {[type]} [description]\r\n */\r\nfunction show_step2() {\r\n\r\n\t/**\r\n\t * Reset all form element's values\r\n\t * ------------------------------\r\n\t * @author John Mark\r\n\t * @date 2/17/2015\r\n\t */\r\n\t// console.log(\"Resetting all form fields to empty value...\");\r\n\t// iterate all radio and set its checked state to false\r\n\t$(\"#webform-component-insurance--relation--student-master-policy input:radio\").each(function(index) {\r\n\t\tthis.checked = false;\r\n\t});\r\n\t// set every select form field's value to empty string (\"\")\r\n\t$('#edit-submitted-type-of-student-membership-appliied').val(\"STDOL\");\r\n\r\n\thidden_step2();\r\n\r\n\tvar eligib_type = $('.page-node-61802 #webform-component-are-you-eligible-for #edit-submitted-are-you-eligible-for').val();\r\n\tconsole.log($(eligib_type).val());\r\n\r\n\t// $.ajax({\r\n\t// url : \"http://10.0.10.202/jack_api/api/get_university\",\r\n\t// type: \"POST\",\r\n\t// data : {cat:eligib_type},\r\n\t// contentType\t:\"application/json\",\r\n\t// success:function(result){\r\n\t// console.log(result);\r\n\t// }\r\n\t// }); \r\n\r\n\tif (eligib_type == 'FULL/NODIS') {\r\n\r\n\t\t$(\"#webform-component-graduate-description\").show();\r\n\t\t$(\".page-node-61802 #webform-component-graduate-description legend .fieldset-legend\").text(\"Not eligible for a concession\");\r\n\t\t$(\".page-node-61802 #webform-component-graduate-description div .fieldset-description\").text(\"Not eligible for discount\");\r\n\t\t$(\"#webform-component-spouse-given-name, #webform-component-spouses-ava-member-number, #webform-component-spouse-membership-status, #webform-component-spouse-surname, #webform-component-insurance,#webform-component-yr1-2\").hide();\r\n\t\t// $(\"#webform-component-spouses-ava-member-number\").hide();\r\n\t\t// $(\"#webform-component-spouse-membership-status\").hide();\r\n\r\n\t} else if (eligib_type == 'FULL/RED50') {\r\n\t\t$(\".page-node-61802 #webform-component-graduate-description\").show();\r\n\t\t$(\".page-node-61802 #webform-component-graduate-description legend .fieldset-legend\").text(\"Reduce Income Concession\");\r\n\t\t$(\".page-node-61802 #webform-component-graduate-description div .fieldset-description\").text(\"I am currently earning $35,000 or less gross annual income from both veterinary and non-veterinary activities.\");\r\n\t\t$(\"#webform-component-spouse-given-name, #webform-component-spouses-ava-member-number, #webform-component-spouse-membership-status, #webform-component-spouse-surname, #webform-component-insurance,#webform-component-yr1-2\").hide();\r\n\t\t// $(\".page-node-61802 #webform-component-spouse-given-name\").hide();\r\n\t\t// $(\".page-node-61802 #webform-component-spouses-ava-member-number\").hide();\r\n\t\t// $(\".page-node-61802 #webform-component-spouse-membership-status\").hide();\r\n\t} else if (eligib_type == 'FULL/SPOUS') {\r\n\t\t$(\"#webform-component-graduate-description, #webform-component-spouse-given-name, #webform-component-spouse-membership-status, #webform-component-spouses-ava-member-number, #webform-component-spouse-surname\").show();\r\n\t\t// $(\".page-node-61802 #webform-component-graduate-description\").show();\r\n\t\t// $(\"#webform-component-spouse-given-name\").show();\r\n\t\t// $(\"#webform-component-spouse-membership-status\").show();\r\n\t\t// $(\"#webform-component-spouses-ava-member-number\").show();\r\n\t\t$(\".page-node-61802 #webform-component-graduate-description legend .fieldset-legend\").text(\"Spousal Concession\");\r\n\t\t$(\".page-node-61802 #webform-component-graduate-description div .fieldset-description\").text(\"I am married or in a de facto relationship with a current AVA member who is paying full membership fees.I currently share the same residential address and am financially interdependent with this member.\");\r\n\t} else if (eligib_type == 'FULL/Yr') {\r\n\t\t$(\".page-node-61802 #webform-component-graduate-description\").show();\r\n\t\t$(\".page-node-61802 #webform-component-spouse-given-name, .page-node-61802 #webform-component-spouses-ava-member-number, .page-node-61802 #webform-component-spouse-membership-status, #webform-component-spouse-surname,#webform-component-yr1-2\").hide();\r\n\t\t$(\".page-node-61802 #webform-component-graduate-description legend .fieldset-legend\").text(\"Graduate Concession\");\r\n\t\t$(\".page-node-61802 #webform-component-graduate-description div .fieldset-description\").text(\"I have graduated from a recognised Australian University in the past three years.\");\r\n\r\n\t\tvar sample = localStorage.getItem(\"yrcompleted\");\r\n\t\tconsole.log(sample);\r\n\r\n\t\tvar currtime = new Date();\r\n\t\tvar curryr = currtime.getFullYear();\r\n\r\n\t\tvar yrcalc = curryr - parseInt(sample);\r\n\t\tconsole.log(yrcalc);\r\n\r\n\t\tif (yrcalc <= 2) {\r\n\t\t\t\r\n\t\t\t$(\".page-node-61802 #webform-component-yr1-2\").show();\r\n\t\t\t$(\".page-node-61802 #webform-component-yr1-2 legend\").css(\"display\", \"inline\");\r\n\t\t\t$(\".page-node-61802 #webform-component-yr1-2 legend .fieldset-legend\").text(\"Year 1 & 2 Graduates\");\r\n\t\t\t$(\".page-node-61802 #webform-component-yr1-2 div .fieldset-description\").text(\"Year 1 & 2 Graduates: GUILD Graduate Master Policy Declaration and link to FAQ and PDS.\");\r\n\t\t\t$(\".page-node-61802 #webform-component-insurance\").show().css({\r\n\t\t\t\t'display': 'inline',\r\n\t\t\t\t'width': '92%'\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tconsole.log(\"jlm ga test ani\");\r\n\t\t\t\r\n\t\t\t$(\".page-node-61802 #webform-component-insurance--insurance #yr1and2\").text(\"As a first and second year graduate member of the AVA, members receive complimentary professional indemnity(PI) insurance provided through Guild. If you're employed as a veterinarian, your work will be covered by your employer's professional indemnity(PI) insurance, however, if you do any veterinary work outside the practice such as at competition events or as a volunteer, you should think about having your own PI insurance cover.\");\r\n\t\t\t\r\n\t\t\t$(\".page-node-61802 #webform-component-insurance--relation--student-master-policy label\").text(\"Please answer the following questions in relation to the Graduate Master Policy\");\r\n\t\t\t\r\n\t\t\t$(\".page-node-61802 #webform-component-insurance--relation--student-master-policy table.webform-grid tbody tr.odd:nth-child(3) td:first-child\").text(\"3. Do you perform any professional services that fall outside the terms of your registration with the Veterinary Registration Board in your state or territory?\");\r\n\t\t\t\r\n\t\t\t$(\".page-node-61802 #webform-component-insurance--information-on-your-insurance-cover #text1\").text(\"If you answered yes to any of the above questions or, if you do not have current registration with an Australian veterinary registration board, your application will be referred to the insurer for individual review and you may be contacted by the insurer for additional information. Please note that your membership information will be provided to the insurer.\");\r\n\t\t\t\r\n\t\t\t$(\".page-node-61802 #webform-component-insurance--information-on-your-insurance-cover #text2\").text(\"The AVA holds a Graduate Master Policy for Graduate Year 1 and Graduate Year 2 members of the AVA and the cover is only available to financial members of the AVA.\");\r\n\t\t\t\r\n\t\t\t$(\".page-node-61802 #webform-component-insurance--information-on-your-insurance-cover #text3\").text(\"Guild Insurance Limited, ABN 55 004 538 863 AFSL 23379 has underwritten this AVA Graduate Master Policy and limit liability for Professional Indemnity, Public Liability and Products Liability Insurance is $10 million.\");\r\n\t\t\t\r\n\t\t\t$(\".page-node-61802 #webform-component-insurance--information-on-your-insurance-cover #text4\").text(\"The policy commenced 1 January 2013 with renewal taking place on 30 June annually. A certificate of cover will be automatically provided to Graduate Year 1 and Graduate Year 2 members. For detailed information on policy coverage please refer to the certificate of cover or contact the AVA.\");\r\n\t\t\t\r\n\t\t\t$(\".page-node-61802 #webform-component-insurance--information-on-your-insurance-cover #text5\").text(\"Please note that the underwriting conditions may apply. At the end of graduate Year 2, you will need to purchase your own insurance policy to continue to protect you against these liabilities and Guild Insurance will send you an invitation to commence your own individual policy.\");\r\n\t\t\t\r\n\t\t} else if (yrcalc > 2) {\r\n\t\t\t$(\".page-node-61802 #webform-component-yr1-2\").show();\r\n\t\t\t// $(\".page-node-61802 #webform-component-yr1-2 legend .fieldset-legend\").text(\"Year 3 Graduates\");\r\n\t\t\t$(\".page-node-61802 #webform-component-yr1-2 legend\").css(\"display\", \"none\");\r\n\t\t\t// $(\".page-node-61802 #webform-component-yr1-2 div .fieldset-description\").text(\"Concession ONLY no insurance reference.\");\r\n\t\t\t$(\".page-node-61802 #webform-component-yr1-2 div .fieldset-description\").text(\"If you are a graduate 3 years out, you are eligible for the graduate concession but not complimentary professional indemnity insurance.\");\r\n\t\t} else {\r\n\t\t\t$(\".page-node-61802 #webform-component-yr1-2\").hide();\r\n\t\t}\r\n\t} else if (eligib_type == '') {\r\n\t\thidden_step2();\r\n\t\t// $(\".page-node-61802 #webform-component-graduate-description\").hide();\r\n\t\t// $(\".page-node-61802 #webform-component-spouse-given-name\").hide();\r\n\t\t// $(\".page-node-61802 #webform-component-spouses-ava-member-number\").hide();\r\n\t\t// $(\".page-node-61802 #webform-component-spouse-membership-status\").hide();\r\n\t\t// $(\".page-node-61802 #webform-component-member-id\").hide();\r\n\t}\r\n}\r\n\r\n/** ----------end---------- **/\r\n\r\n}(jQuery, window)) // end of siaf\r\n\r\nmembership_websignup_review.js:\r\n\r\njQuery(document).ready(function(){\r\n\t\r\n\tcheck_field_eligible();\r\n\tset_chapter();\r\n\r\nfunction check_field_eligible() {\r\n\tjQuery(\".form-item-paid-a1national-yr1\").css('display','none');\r\n\tjQuery(\".form-item-paid-a1national-yr2\").css('display','none');\r\n\tjQuery(\".form-item-paid-a1national-yr3\").css('display','none');\r\n\t\r\n\tjQuery(\".form-item-paid-chapter-yr1\").css('display','none');\r\n\tjQuery(\".form-item-paid-chapter-yr2\").css('display','none');\r\n\tjQuery(\".form-item-paid-chapter-yr3\").css('display','none');\r\n\t\r\n\t\r\n\t\r\n\tif(jQuery(\"select[name='field_eligible']\").val() == \"FULL/Yr\"){\r\n\t\tvar year = new Date().getFullYear();\r\n\t\tvar input = parseInt(jQuery(\"input[name='field_year_of_completion']\").val());\r\n\t\tvar ans = year - input;\r\n\t\tif(ans <= 1){\r\n\t\t// jQuery(\"input[name='hiddenyear']\").val(\"1\");\r\n\t\t\tjQuery(\".form-item-paid-a1national-yr1\").css('display','block');\r\n\t\t\tjQuery(\".form-item-paid-a1national-yr2\").css('display','none');\r\n\t\t\tjQuery(\".form-item-paid-a1national-yr3\").css('display','none');\r\n\t\t\t\r\n\t\t\tjQuery(\".form-item-paid-chapter-yr1\").css('display','block');\r\n\t\t\tjQuery(\".form-item-paid-chapter-yr2\").css('display','none');\r\n\t\t\tjQuery(\".form-item-paid-chapter-yr3\").css('display','none');\r\n\t\t} else if(ans == 2){\r\n\t\t\tjQuery(\".form-item-paid-a1national-yr1\").css('display','none');\r\n\t\t\tjQuery(\".form-item-paid-a1national-yr2\").css('display','block');\r\n\t\t\tjQuery(\".form-item-paid-a1national-yr3\").css('display','none');\t\r\n\t\t\t\r\n\t\t\tjQuery(\".form-item-paid-chapter-yr1\").css('display','none');\r\n\t\t\tjQuery(\".form-item-paid-chapter-yr2\").css('display','block');\r\n\t\t\tjQuery(\".form-item-paid-chapter-yr3\").css('display','none');\r\n\t\t}else if(ans >= 3){\r\n\t\t\tjQuery(\".form-item-paid-a1national-yr1\").css('display','none');\r\n\t\t\tjQuery(\".form-item-paid-a1national-yr2\").css('display','none');\r\n\t\t\tjQuery(\".form-item-paid-a1national-yr3\").css('display','block');\r\n\r\n\t\t\tjQuery(\".form-item-paid-chapter-yr1\").css('display','none');\r\n\t\t\tjQuery(\".form-item-paid-chapter-yr2\").css('display','none');\r\n\t\t\tjQuery(\".form-item-paid-chapter-yr3\").css('display','block');\r\n\t\t}\r\n\t}\r\n}\r\n\t\r\n\tjQuery(\"select[name='field_eligible']\").change(function(){\r\n\t\tcheck_field_eligible();\r\n\t});\r\n\tjQuery(\"select[name='field_postal_state']\").change(function(){\r\n\t\tset_chapter();\r\n\t});\r\n\tjQuery(\"input[name='field_year_of_completion']\").change(function(){\r\n\t\tcheck_field_eligible();\r\n\t});\r\n\r\nfunction set_chapter(){\r\n\tvar postal_state = jQuery(\"select[name='field_postal_state']\").val();\r\n\tjQuery('input:radio[name=paid_chapter_full], input:radio[name=paid_chapter_red], input:radio[name=paid_chapter_spouse], input:radio[name=paid_chapter_yr1], input:radio[name=paid_chapter_yr2], input:radio[name=paid_chapter_yr3]').filter(\"[value='\"+postal_state+\"']\").prop('checked', true);\r\n\tconsole.log(postal_state);\r\n}\r\n\r\n})\r\n\r\nmembership_websignup_review.inc:\r\n\r\n<?php\r\n\r\ninclude_once(drupal_get_path('module', 'webform') .\"/includes/webform.submissions.inc\");\r\nfunction ava_web_signup_review_form($form, &$form_state, $value) {\r\n\t// $pricing_list = json_decode(ava_websignup_api_call('POST', 'api/get_pricing', array('cat' => 'STUDN')), true);\r\n\t// print_r($pricing_list);die();\r\n\t // $pricing_list2 = json_decode(ava_websignup_api_call('GET', 'api/get_all_pricing'), true);\r\n\t // print_r($pricing_list2);die();\r\n\t$node = node_load($value);\r\n\t$submission = webform_get_submission($node->webform_id,$node->submission_id);\r\n\t\r\n\tif ($node->type != 'ava_membership_application'){\r\n\t\tdrupal_not_found();\r\n\t\tdie();\r\n\t} \r\n\t\t$form['#attached']['js'][] = drupal_get_path('module', 'ava_websignup') . '/ava_websignup_review.js';\r\n\t\tdrupal_set_title('Membership and Web Sign-up - Review');\r\n\t\t// title\r\n\t\t$form['personal_info'] = array(\r\n\t\t\t'#type' => 'fieldset', \r\n\t\t\t'#title' => t('1. Personal Details'), \r\n\t\t\t'#collapsible' => FALSE, \r\n\t\t);\r\n\t\t\r\n\t\t// $form['personal_info']['field_title'] = array(\r\n\t\t\t// '#type' => 'select',\r\n\t\t\t// '#required' => true,\r\n\t\t\t// '#title' => t('Title'),\r\n\t\t\t// '#options' => array('Miss','Mr','Mrs','Ms','Dr','Prof'),\r\n\t\t\t// '#default_value' => $node->field_title['und'][0]['value'],\r\n\t\t\t// '#multiple' => false,\r\n\t\t// );\r\n\t\t\r\n\t\t$form['personal_info']['field_first_name'] = array(\r\n\t\t\t'#type' => 'textfield', \r\n\t\t\t'#title' => t('First Name'), \r\n\t\t\t'#size' => 60, \r\n\t\t\t'#maxlength' => 128,\r\n\t\t\t'#required' => TRUE,\r\n\t\t\t'#default_value' => $submission->data[4]['value'][0],\r\n\t\t);\r\n\t\t\r\n\t\t$form['personal_info']['field_last_name'] = array(\r\n\t\t\t'#type' => 'textfield', \r\n\t\t\t'#title' => t('Last Name'), \r\n\t\t\t'#size' => 60, \r\n\t\t\t'#maxlength' => 128,\r\n\t\t\t'#required' => TRUE,\r\n\t\t\t'#default_value' => $submission->data[5]['value'][0],\r\n\t\t);\r\n\t\t\r\n\t\t$form['personal_info']['field_middle_name'] = array(\r\n\t\t\t'#type' => 'textfield', \r\n\t\t\t'#title' => t('Middle Name'), \r\n\t\t\t'#size' => 60, \r\n\t\t\t'#maxlength' => 128,\r\n\t\t\t'#required' => TRUE,\r\n\t\t\t'#default_value' => $submission->data[6]['value'][0],\r\n\t\t);\r\n\t\t\r\n\t\t$form['personal_info']['field_date_of_birth'] = array(\r\n\t\t  '#type' => 'date_popup', \r\n\t\t  '#title' => t('Date of Birth'), \r\n\t\t  '#default_value' => $submission->data[7]['value'][0],\r\n\t\t  '#required' => TRUE,\r\n\t\t);\r\n\t\t\r\n\t\t$form['personal_info']['field_gender'] = array(\r\n\t\t\t'#type' => 'select',\r\n\t\t\t'#required' => true,\r\n\t\t\t'#title' => t('Gender'),\r\n\t\t\t'#options' => array(\r\n\t\t\t\t'M' => 'Male',\r\n\t\t\t\t'F'\t=> 'Female',\r\n\t\t\t),\r\n\t\t\t'#default_value' => $submission->data[8]['value'][0],\r\n\t\t\t'#multiple' => false,\r\n\t\t);\r\n\t\t\r\n\t\t$form['personal_info']['field_postal_street_address'] = array(\r\n\t\t\t'#type' => 'textfield', \r\n\t\t\t'#title' => t('Postal Street Address'), \r\n\t\t\t'#size' => 60,\r\n\t\t\t'#required' => TRUE,\r\n\t\t\t'#default_value' => $submission->data[11]['value'][0],\r\n\t\t);\r\n\t\t\r\n\t\t$form['personal_info']['field_avawebsignup_city'] = array(\r\n\t\t\t'#type' => 'textfield', \r\n\t\t\t'#title' => t('City'), \r\n\t\t\t'#size' => 60,\r\n\t\t\t'#required' => TRUE,\r\n\t\t\t'#default_value' => $submission->data[9]['value'][0],\r\n\t\t);\r\n\t\t\r\n\t\t$form['personal_info']['field_postal_state'] = array(\r\n\t\t\t'#type' => 'select',\r\n\t\t\t'#required' => true,\r\n\t\t\t'#title' => t('Postal State'),\r\n\t\t\t'#options' => array(\r\n\t\t\t\t'CHAPT/ACT' => 'ACT Division',\r\n\t\t\t\t'CHAPT/NSW'\t=> 'NSW Division',\r\n\t\t\t\t'CHAPT/NT'\t=> 'NT Division',\r\n\t\t\t\t'CHAPT/QLD'\t=> 'QLD Division',\r\n\t\t\t\t'CHAPT/SA'\t=> 'SA Division',\r\n\t\t\t\t'CHAPT/TAS'\t=> 'TAS Division',\r\n\t\t\t\t'CHAPT/VIC'\t=> 'VIC Division',\r\n\t\t\t\t'CHAPT/WA'\t=> 'WA Division',\r\n\t\t\t),\r\n\t\t\t'#default_value' => $submission->data[10]['value'][0],\r\n\t\t\t'#multiple' => false,\r\n\t\t);\r\n\t\t\r\n\t\t$form['personal_info']['field_postal_postcode'] = array(\r\n\t\t\t'#type' => 'textfield', \r\n\t\t\t'#title' => t('Postal Postcode'), \r\n\t\t\t'#size' => 60,\r\n\t\t\t'#required' => TRUE,\r\n\t\t\t'#default_value' => $submission->data[12]['value'][0],\r\n\t\t);\r\n\t\t\r\n\t\t$form['personal_info']['field_telephone_no'] = array(\r\n\t\t\t'#type' => 'textfield', \r\n\t\t\t'#title' => t('Telephone No.'), \r\n\t\t\t'#size' => 60,\r\n\t\t\t'#required' => TRUE,\r\n\t\t\t'#default_value' => $submission->data[13]['value'][0],\r\n\t\t);\r\n\t\t\r\n\t\t$form['personal_info']['field_mobile_no'] = array(\r\n\t\t\t'#type' => 'textfield', \r\n\t\t\t'#title' => t('Mobile No.'), \r\n\t\t\t'#size' => 60,\r\n\t\t\t'#required' => TRUE,\r\n\t\t\t'#default_value' => $submission->data[14]['value'][0],\r\n\t\t);\r\n\t\t\r\n\t\t$form['personal_info']['field_avawebsignup_email_address'] = array(\r\n\t\t\t'#type' => 'textfield', \r\n\t\t\t'#title' => t('Email Address'), \r\n\t\t\t'#size' => 60,\r\n\t\t\t'#required' => TRUE,\r\n\t\t\t'#default_value' => $submission->data[36]['value'][0],\r\n\t\t);\r\n\t\t\r\n\t\t$form['personal_info']['field_decision_factor'] = array(\r\n\t\t\t'#type' => 'select',\r\n\t\t\t'#required' => true,\r\n\t\t\t'#title' => t('Why join the AVA ?'),\r\n\t\t\t'#options' => array(\r\n\t\t\t\t0 => 'Being part of the profession',\r\n\t\t\t\t1\t=> 'Events and education',\r\n\t\t\t\t2\t=> 'Encouraged by colleagues',\r\n\t\t\t\t3\t=> 'Member benefits',\r\n\t\t\t\t4\t=> 'Employer paid for membership',\r\n\t\t\t\t5\t=> 'Other',\r\n\t\t\t),\r\n\t\t\t'#default_value' => $submission->data[39]['value'][0],\r\n\t\t\t'#multiple' => false,\r\n\t\t);\r\n\t\t\r\n\t\t// category\r\n\t\t$form['category'] = array(\r\n\t\t\t'#type' => 'fieldset', \r\n\t\t\t'#title' => t(''), \r\n\t\t\t'#collapsible' => FALSE, \r\n\t\t);\r\n\t\t\r\n\t\t$form['category']['field_type_category'] = array(\r\n\t\t\t'#type' => 'select',\r\n\t\t\t'#required' => true,\r\n\t\t\t'#title' => t('I am a...'),\r\n\t\t\t'#options' => array(\r\n\t\t\t\t0 => 'I am student enrolled in Vet Science',\r\n\t\t\t\t1\t=> 'I am a qualified veterinarian',\r\n\t\t\t),\r\n\t\t\t'#default_value' => $submission->data[38]['value'][0],\r\n\t\t\t'#multiple' => false,\r\n\t\t);\r\n\t\t\r\n\t\t/* $form['category']['field_type_category'] = array(\r\n\t\t\t'#type' => 'select',\r\n\t\t\t'#required' => true,\r\n\t\t\t'#title' => t('I am a...'),\r\n\t\t\t'#options' => array(\r\n\t\t\t\t0 => 'I am student enrolled in Vet Science',\r\n\t\t\t\t1\t=> 'I am a qualified veterinarian',\r\n\t\t\t),\r\n\t\t\t'#default_value' => $node->field_type_category['und'][0]['value'],\r\n\t\t\t'#multiple' => false,\r\n\t\t); */\r\n\t\t\r\n\t\t$university_list = array();\r\n\t\t$university_list2 = array();\r\n\t\t$responseData_stud = json_decode(ava_websignup_api_call('POST', 'api/get_university', array('type' => 'stud')), true);\r\n\t\t$responseData_vet = json_decode(ava_websignup_api_call('POST', 'api/get_university', array('type' => 'full')), true);\r\n\t\t\r\n\t\t\r\n\t\tforeach($responseData_stud as $key=>$value){\r\n\t\t\t$university_list[$value['code'].\"|\".$value['division']] = $value['description'];\r\n\t\t}\r\n\t\tforeach($responseData_vet as $key=>$value){\r\n\t\t\t$university_list2[$value['code'].\"|\".$value['division']] = $value['description'];\r\n\t\t}\r\n\t\t\r\n\t\t$form['category']['field_university_stud'] = array(\r\n\t\t\t'#type' => 'select',\r\n\t\t\t// '#required' => true,\r\n\t\t\t'#title' => t('University Student'),\r\n\t\t\t'#options' => $university_list,\r\n\t\t\t'#default_value' => $submission->data[17]['value'][0] != \"\"?$submission->data[17]['value'][0]:$submission->data[40]['value'][0],\r\n\t\t\t'#multiple' => false,\r\n\t\t\t'#states' => array(\r\n\t\t\t\t  'visible' => array(   // action to take.\r\n\t\t\t\t\t':input[name=field_type_category]' => array('value' => 0),\r\n\t\t\t\t  ),\r\n\t\t\t\t),\r\n\t\t);\r\n\t\t\r\n\t\t$form['category']['field_degree'] = array(\r\n\t\t\t'#type' => 'select',\r\n\t\t\t// '#required' => true,\r\n\t\t\t'#title' => t('Degree'),\r\n\t\t\t'#options' => array(\r\n\t\t\t\t'BVSC' => 'BVSC',\r\n\t\t\t\t'DVM' => 'DVM',\r\n\t\t\t\t'BVMS' => 'BVMS',\r\n\t\t\t),\r\n\t\t\t'#default_value' => $submission->data[66]['value'][0],\r\n\t\t\t'#multiple' => false,\r\n\t\t\t'#states' => array(\r\n\t\t\t\t  'visible' => array(   // action to take.\r\n\t\t\t\t\t':input[name=field_type_category]' => array('value' => 0),\r\n\t\t\t\t  ),\r\n\t\t\t\t),\r\n\t\t);\r\n\t\t\r\n\t\t$form['category']['field_degree_year'] = array(\r\n\t\t\t'#type' => 'select',\r\n\t\t\t// '#required' => true,\r\n\t\t\t'#title' => t('Degree'),\r\n\t\t\t'#options' => array(\r\n\t\t\t\t1 => '1',\r\n\t\t\t\t2 => '2',\r\n\t\t\t\t3 => '3',\r\n\t\t\t\t4 => '4',\r\n\t\t\t\t5 => '5',\r\n\t\t\t\t6 => '6',\r\n\t\t\t),\r\n\t\t\t'#default_value' => $submission->data[67]['value'][0],\r\n\t\t\t'#multiple' => false,\r\n\t\t\t'#states' => array(\r\n\t\t\t\t  'visible' => array(   // action to take.\r\n\t\t\t\t\t':input[name=field_type_category]' => array('value' => 0),\r\n\t\t\t\t  ),\r\n\t\t\t\t),\r\n\t\t);\r\n\t\t\r\n\t\t$form['category']['field_type_of_student_membership'] = array(\r\n\t\t\t'#type' => 'select',\r\n\t\t\t// '#required' => true,\r\n\t\t\t'#title' => t('Student Membership Options'),\r\n\t\t\t'#options' => array(\r\n\t\t\t\t'STDOL' => 'Student Online',\r\n\t\t\t\t'STUDN' => 'Student Paid',\r\n\t\t\t),\r\n\t\t\t'#default_value' => $submission->data[42]['value'][0],\r\n\t\t\t'#multiple' => false,\r\n\t\t\t'#states' => array(\r\n\t\t\t\t  'visible' => array(   // action to take.\r\n\t\t\t\t\t':input[name=field_type_category]' => array('value' => 0),\r\n\t\t\t\t  ),\r\n\t\t\t\t),\r\n\t\t);\r\n\t\t\r\n\t\t$form['category']['field_university_vet'] = array(\r\n\t\t\t'#type' => 'select',\r\n\t\t\t// '#required' => true,\r\n\t\t\t'#title' => t('University Veterinarian'),\r\n\t\t\t'#options' => $university_list2,\r\n\t\t\t'#default_value' => $submission->data[40]['value'][0],\r\n\t\t\t'#multiple' => false,\r\n\t\t\t'#states' => array(\r\n\t\t\t\t  'visible' => array(   // action to take.\r\n\t\t\t\t\t':input[name=field_type_category]' => array('value' => 1),\r\n\t\t\t\t  ),\r\n\t\t\t\t),\r\n\t\t);\r\n\t\t\r\n\t\t$form['category']['field_year_of_completion'] = array(\r\n\t\t\t'#type' => 'textfield', \r\n\t\t\t'#title' => t('Year of Completion'), \r\n\t\t\t'#size' => 60,\r\n\t\t\t// '#required' => TRUE,\r\n\t\t\t'#default_value' => $submission->data[41]['value'][0],\r\n\t\t\t'#states' => array(\r\n\t\t\t\t  'visible' => array(   // action to take.\r\n\t\t\t\t\t':input[name=field_type_category]' => array('value' => 1),\r\n\t\t\t\t  ),\r\n\t\t\t\t),\r\n\t\t);\r\n\t\t\r\n\t\t$form['category']['field_state_board_registered'] = array(\r\n\t\t\t'#type' => 'select',\r\n\t\t\t// '#required' => true,\r\n\t\t\t'#title' => t('State Board Registered'),\r\n\t\t\t'#options' => array(\r\n\t\t\t\t'CHAPT/ACT' => 'ACT Division',\r\n\t\t\t\t'CHAPT/NSW'\t=> 'NSW Division',\r\n\t\t\t\t'CHAPT/NT'\t=> 'NT Division',\r\n\t\t\t\t'CHAPT/OS'\t=> 'Overseas Member',\r\n\t\t\t\t'CHAPT/QLD'\t=> 'QLD Division',\r\n\t\t\t\t'CHAPT/SA'\t=> 'SA Division',\r\n\t\t\t\t'CHAPT/TAS'\t=> 'TAS Division',\r\n\t\t\t\t'CHAPT/VIC'\t=> 'VIC Division',\r\n\t\t\t\t'CHAPT/WA'\t=> 'WA Division',\r\n\t\t\t),\r\n\t\t\t'#default_value' => $submission->data[68]['value'][0],\r\n\t\t\t'#multiple' => false,\r\n\t\t\t'#states' => array(\r\n\t\t\t\t  'visible' => array(   // action to take.\r\n\t\t\t\t\t':input[name=field_type_category]' => array('value' => 1),\r\n\t\t\t\t  ),\r\n\t\t\t\t),\r\n\t\t);\r\n\t\t\r\n\t\t$form['category']['field_state_board_registration_n'] = array(\r\n\t\t\t'#type' => 'textfield', \r\n\t\t\t'#title' => t('State Board Registration Number'), \r\n\t\t\t'#size' => 60,\r\n\t\t\t// '#required' => TRUE,\r\n\t\t\t'#default_value' => $submission->data[69]['value'][0],\r\n\t\t\t'#states' => array(\r\n\t\t\t\t  'visible' => array(   // action to take.\r\n\t\t\t\t\t':input[name=field_type_category]' => array('value' => 1),\r\n\t\t\t\t  ),\r\n\t\t\t\t),\r\n\t\t);\r\n\t\t\r\n\t\t$form['category']['field_eligible'] = array(\r\n\t\t\t'#type' => 'select',\r\n\t\t\t// '#required' => true,\r\n\t\t\t'#title' => t('I am eligible for...'),\r\n\t\t\t'#options' => array(\r\n\t\t\t\t'FULL/NODIS' => 'Not eligible for a concession',\r\n\t\t\t\t'FULL/RED50'\t=> 'Reduced Income concession',\r\n\t\t\t\t'FULL/SPOUS'\t=> 'Spousal Concession',\r\n\t\t\t\t'FULL/Yr'\t=> 'Graduate Concession',\r\n\t\t\t),\r\n\t\t\t'#default_value' => $submission->data[22]['value'][0],\r\n\t\t\t'#multiple' => false,\r\n\t\t\t'#states' => array(\r\n\t\t\t\t  'visible' => array(   // action to take.\r\n\t\t\t\t\t':input[name=field_type_category]' => array('value' => 1),\r\n\t\t\t\t  ),\r\n\t\t\t\t),\r\n\t\t);\r\n\t\t\r\n\t\t$form['category']['field_my_spouse_is'] = array(\r\n\t\t\t'#type' => 'textfield', \r\n\t\t\t'#title' => t('My Spouse is'), \r\n\t\t\t'#size' => 60,\r\n\t\t\t// '#required' => TRUE,\r\n\t\t\t'#default_value' => $submission->data[70]['value'][0],\r\n\t\t\t'#states' => array(\r\n\t\t\t\t  'visible' => array(   // action to take.\r\n\t\t\t\t\t':input[name=field_type_category]' => array('value' => 1),\r\n\t\t\t\t\t':input[name=field_eligible]' => array('value' => 'FULL/SPOUS'),\r\n\t\t\t\t  ),\r\n\t\t\t\t),\r\n\t\t);\r\n\t\t\r\n\t\t$form['category']['field_spouse_s_ava_member_number'] = array(\r\n\t\t\t'#type' => 'textfield', \r\n\t\t\t'#title' => t(\"Spouse's AVA Member Number\"), \r\n\t\t\t'#size' => 60,\r\n\t\t\t// '#required' => TRUE,\r\n\t\t\t'#default_value' => $submission->data[71]['value'][0],\r\n\t\t\t'#states' => array(\r\n\t\t\t\t  'visible' => array(   // action to take.\r\n\t\t\t\t\t':input[name=field_type_category]' => array('value' => 1),\r\n\t\t\t\t\t':input[name=field_eligible]' => array('value' => 'FULL/SPOUS'),\r\n\t\t\t\t  ),\r\n\t\t\t\t),\r\n\t\t);\r\n\t\t\r\n\t\t$form['category']['field_spouse_membership_status'] = array(\r\n\t\t\t'#type' =>'checkbox', \r\n\t\t\t'#title' => t('Spouse Membership Status'),\r\n\t\t\t'#default_value' => $submission->data[84]['value'][0],\r\n\t\t\t'#states' => array(\r\n\t\t\t\t  'visible' => array(   // action to take.\r\n\t\t\t\t\t':input[name=field_type_category]' => array('value' => 1),\r\n\t\t\t\t\t':input[name=field_eligible]' => array('value' => 'FULL/SPOUS'),\r\n\t\t\t\t  ),\r\n\t\t\t\t),\r\n\t\t);\r\n\t\t\r\n\t\tif($submission->data[87]['value'][0] == 'rejected') {\r\n\t\t\t$stat = 0;\r\n\t\t} else if($submission->data[87]['value'][0] == 'approved') {\r\n\t\t\t$stat = 1;\r\n\t\t} else {\r\n\t\t\t$stat = 2;\r\n\t\t}\r\n\t\t\r\n\t\t$form['category']['field_membership_status'] = array(\r\n\t\t\t'#type' =>'radios', \r\n\t\t\t'#title' => t('Status'),\r\n\t\t\t'#options' => array('Rejected','Approved'),\r\n\t\t\t'#default_value' => $stat,\r\n\t\t\t'#required' => TRUE,\r\n\t\t);\r\n\t\t\r\n\t\t$form['category']['field_payment_option'] = array(\r\n\t\t\t'#type' =>'radios', \r\n\t\t\t'#title' => t('Paid By'),\r\n\t\t\t'#options' => array(\r\n\t\t\t\t'CC' => 'Credit Card',\r\n\t\t\t\t'PBTM' => 'Pay by the month'\r\n\t\t\t),\r\n\t\t\t'#default_value' => $submission->data[58]['value'][0],\r\n\t\t\t'#required' => TRUE,\r\n\t\t);\r\n\t\t\r\n\t\t$chapter_list = array();\r\n\t\t$chapter_list_full = array();\r\n\t\t\r\n\t\t\r\n\t\t$chapter_payment = array();\r\n\t\t$sig_list = array();\r\n\t\t$sig_payment = array();\r\n\t\t\r\n\t\t\r\n\t\t$dues_list = array();\r\n\t\t$dues_list_full = array();\r\n\t\t\r\n\t\t\r\n\t\t$dues_payment = array();\r\n\t\t$disabled_chapter = array();\r\n\t\t$all_payment = array();\r\n\t\t$stud_choosen = 0;\r\n\r\n\t\t// if($submission->data[38]['value'][0] == 1){\r\n\t\t\t// $pricing_list = json_decode(ava_websignup_api_call('POST', 'api/get_pricing', array('cat' => $submission->data[22]['value'][0])), true);\r\n\t\t// } else if($submission->data[38]['value'][0] == 0 && $submission->data[40]['value'][0] != \"\" && $submission->data[42]['value'][0] == \"STUDN\"){\r\n\t\t\t// $pricing_list = json_decode(ava_websignup_api_call('POST', 'api/get_pricing', array('cat' => 'STUDN')), true);\r\n\t\t\t// $stud_choosen = 1;\r\n\t\t// }\r\n\t\t$pricing_list = json_decode(ava_websignup_api_call('GET', 'api/get_all_pricing'), true);\r\n\t\tif(isset($pricing_list) && !empty($pricing_list)){\r\n\t\t\r\n\t\t\tforeach($pricing_list as $key=>$value){\r\n\t\t\t\t\r\n\t\t\t// $now = intval(date(\"n\")); // this will be used during final implementation.\r\n\t\t\t\t$now = 2; // $now is the month of application. This is defaulted to 1(january) for testing purpose only.\r\n\t\t\t\tif($now <= 3){\r\n\t\t\t\t\t$deducted_price = ($value['BASE_1']-($value['BASE_1']*.50));\r\n\t\t\t\t} else if($now >= 4 && $now <= 9){\r\n\t\t\t\t\t$deducted_price = $value['BASE_1'];\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$deducted_price = ($value['BASE_1']-($value['BASE_1']*.25));\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif($value['PROD_TYPE'] == \"CHAPT\"){\r\n\t\t\t\t\tif($value['CUSTOMER_TYPE'] == \"FULL\"){\r\n\t\t\t\t\t\t$chapter_list_full[$value['PRODUCT_CODE']] = $value['TITLE'].\" $\". $deducted_price;\r\n\t\t\t\t\t\t$all_payment_full[$value['PRODUCT_CODE']] = $deducted_price;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t$all_title_full[$value['PRODUCT_CODE']] = $value['TITLE'];\t\r\n\t\t\t\t\t} else if($value['CUSTOMER_TYPE'] == \"FULL/RED50\"){\r\n\t\t\t\t\t\t$chapter_list_red[$value['PRODUCT_CODE']] = $value['TITLE'].\" $\". $deducted_price;\r\n\t\t\t\t\t\t$all_payment_red[$value['PRODUCT_CODE']] = $deducted_price;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t$all_title_red[$value['PRODUCT_CODE'].\"|\".$value['BASE_1']] = $value['TITLE'];\t\r\n\t\t\t\t\t} else if($value['CUSTOMER_TYPE'] == \"FULL/SPOUS\"){\r\n\t\t\t\t\t\t// $chapter_list_spouse[$value['PRODUCT_CODE'].\"|\".$value['BASE_1']] = $value['TITLE'].\" $\". $deducted_price;\r\n\t\t\t\t\t\t// $all_payment_spouse[$value['PRODUCT_CODE'].\"|\".$value['BASE_1']] = $deducted_price;\r\n\t\t\t\t\t\t$chapter_list_spouse[$value['PRODUCT_CODE']] = $value['TITLE'].\" $\". $deducted_price;\r\n\t\t\t\t\t\t$all_payment_spouse[$value['PRODUCT_CODE']] = $deducted_price;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t$all_title_spouse[$value['PRODUCT_CODE'].\"|\".$value['BASE_1']] = $value['TITLE'];\t\r\n\t\t\t\t\t} else if($value['CUSTOMER_TYPE'] == \"FULL/YR1\"){\r\n\t\t\t\t\t\t$chapter_list_yr1[$value['PRODUCT_CODE']] = $value['TITLE'].\" $\". $deducted_price;\r\n\t\t\t\t\t\t$all_payment_yr1[$value['PRODUCT_CODE']] = $deducted_price;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t$all_title_yr1[$value['PRODUCT_CODE'].\"|\".$value['BASE_1']] = $value['TITLE'];\t\r\n\t\t\t\t\t} else if($value['CUSTOMER_TYPE'] == \"FULL/YR2\"){\r\n\t\t\t\t\t\t$chapter_list_yr2[$value['PRODUCT_CODE']] = $value['TITLE'].\" $\". $deducted_price;\r\n\t\t\t\t\t\t$all_payment_yr2[$value['PRODUCT_CODE']] = $deducted_price;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t$all_title_yr2[$value['PRODUCT_CODE'].\"|\".$value['BASE_1']] = $value['TITLE'];\t\r\n\t\t\t\t\t} else if($value['CUSTOMER_TYPE'] == \"FULL/YR3\"){\r\n\t\t\t\t\t\t$chapter_list_yr3[$value['PRODUCT_CODE']] = $value['TITLE'].\" $\". $deducted_price;\r\n\t\t\t\t\t\t$all_payment_yr3[$value['PRODUCT_CODE']] = $deducted_price;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t$all_title_yr3[$value['PRODUCT_CODE'].\"|\".$value['BASE_1']] = $value['TITLE'];\t\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t/* if($stud_choosen == 0){\r\n\t\t\t\t\t\tif($form_state['storage']['submitted'][10] == $value['PRODUCT_CODE']){\r\n\t\t\t\t\t\t\t$chapter_default = $value['PRODUCT_CODE'].\"|\".$value['BASE_1'];\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tarray_push($disabled_chapter,$value['PRODUCT_CODE'].\"|\".$value['BASE_1']);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$the_chap = explode(\"|\",$form_state['storage']['submitted'][17]);\r\n\t\t\t\t\t\tif(substr($value['PRODUCT_CODE'],6) == $the_chap[1]){\r\n\t\t\t\t\t\t\t$chapter_default = $value['PRODUCT_CODE'].\"|\".$value['BASE_1'];\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tarray_push($disabled_chapter,$value['PRODUCT_CODE'].\"|\".$value['BASE_1']);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} */\r\n\t\t\t\t\t\r\n\t\t\t\t} else if($value['PROD_TYPE'] == \"SEC\"){\r\n\t\t\t\t\t//\t$sig_list[$value['PRODUCT_CODE'].\"_\".$value['BASE_1']] = $value['TITLE'].\" $\". $deducted_price;\r\n\t\t\t\t\t//\t$all_payment[$value['PRODUCT_CODE'].\"_\".$value['BASE_1']] = $deducted_price;\r\n\t\t\t\t\t\r\n\t\t\t\t\t$sig_list[$value['PRODUCT_CODE']] = $value['TITLE'].\" $\". $deducted_price;\r\n\t\t\t\t\t$all_title[$value['PRODUCT_CODE']] = $value['TITLE'];\r\n\t\t\t\t\t$all_payment[$value['PRODUCT_CODE']] = $deducted_price;\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t// $form['category']['field_sig']['#options'] = $sig_list;\r\n\t\t\t\t\t\r\n\t\t\t\t\t// $form['submitted']['sig_options']['#theme'] = array('ava_websignup_multicolumn_options');  \r\n\t\t\t\t\t// $form['submitted']['sig_options']['#columns'] = 2;   \r\n\t\t\t\t\t//$form['submitted']['sig_options']['#value'] = $sig_list['SG_AAHVJA|90.00'];\r\n\t\t\t\t\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// $dues_list_full[$value['PRODUCT_CODE'].\"|\".$value['BASE_1']] = $value['TITLE'].\" $\". $deducted_price;\r\n\t\t\t\t\t// $all_payment[$value['PRODUCT_CODE'].\"|\".$value['BASE_1']] = $deducted_price;\r\n\t\t\t\t\t// $dues_default = $value['PRODUCT_CODE'].\"|\".$value['BASE_1'];\r\n\t\t\t\t\t// $all_title[$value['PRODUCT_CODE'].\"|\".$value['BASE_1']] = $value['TITLE'];\r\n\t\t\t\t\t\r\n\t\t\t\t\tif($value['CUSTOMER_TYPE'] == \"FULL\"){\r\n\t\t\t\t\t\t$dues_list_full[$value['PRODUCT_CODE'].\"|\".$value['BASE_1']] = $value['TITLE'].\" $\". $deducted_price;\r\n\t\t\t\t\t\t$dues_default_full = $value['PRODUCT_CODE'].\"|\".$value['BASE_1'];\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t} else if($value['CUSTOMER_TYPE'] == \"FULL/RED50\"){\r\n\t\t\t\t\t\t$dues_list_red[$value['PRODUCT_CODE'].\"|\".$value['BASE_1']] = $value['TITLE'].\" $\". $deducted_price;\r\n\t\t\t\t\t\t$dues_default_red = $value['PRODUCT_CODE'].\"|\".$value['BASE_1'];\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t} else if($value['CUSTOMER_TYPE'] == \"FULL/SPOUS\"){\r\n\t\t\t\t\t\t$dues_list_spouse[$value['PRODUCT_CODE'].\"|\".$value['BASE_1']] = $value['TITLE'].\" $\". $deducted_price;\r\n\t\t\t\t\t\t$dues_default_spouse = $value['PRODUCT_CODE'].\"|\".$value['BASE_1'];\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t} else if($value['CUSTOMER_TYPE'] == \"FULL/YR1\"){\r\n\t\t\t\t\t\t$dues_list_yr1[$value['PRODUCT_CODE'].\"|\".$value['BASE_1']] = $value['TITLE'].\" $\". $deducted_price;\r\n\t\t\t\t\t\t$dues_default_yr1 = $value['PRODUCT_CODE'].\"|\".$value['BASE_1'];\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t} else if($value['CUSTOMER_TYPE'] == \"FULL/YR2\"){\r\n\t\t\t\t\t\t$dues_list_yr2[$value['PRODUCT_CODE'].\"|\".$value['BASE_1']] = $value['TITLE'].\" $\". $deducted_price;\r\n\t\t\t\t\t\t$dues_default_yr2 = $value['PRODUCT_CODE'].\"|\".$value['BASE_1'];\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t} else if($value['CUSTOMER_TYPE'] == \"FULL/YR3\"){\r\n\t\t\t\t\t\t$dues_list_yr3[$value['PRODUCT_CODE'].\"|\".$value['BASE_1']] = $value['TITLE'].\" $\". $deducted_price;\r\n\t\t\t\t\t\t$dues_default_yr3 = $value['PRODUCT_CODE'].\"|\".$value['BASE_1'];\r\n\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// print_r($dues_list_full);\r\n\t\t\r\n\t\t\t$all_payment_array = $all_payment;\r\n\t\t\t$all_payment = json_encode($all_payment);\r\n\t\t\t\r\n\t\t\t$form['submitted']['chapter']['#options'] = $chapter_list;  \r\n\t\t\t$form['submitted']['chapter']['#theme'] = array('ava_websignup_multicolumn_options');  \r\n\t\t\t$form['submitted']['chapter']['#columns'] = 2;\r\n\t\t\t$form['submitted']['chapter']['#default_value'] = $chapter_default;  \r\n\t\t\tforeach($disabled_chapter as $key => $value){\r\n\t\t\t\t$form['submitted']['chapter'][$value] = array('#disabled' => TRUE,);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t$form['submitted']['national_subscription']['#options'] = $dues_list;  \r\n\t\t\t$form['submitted']['national_subscription']['#default_value'] = $dues_default; \r\n\t\t\t\r\n\t\t\t\r\n\t\t\t$form['submitted']['all_payment']['#value'] = $all_payment_array;\r\n\t\t\t$form['submitted']['all_title']['#value'] = $all_title;\r\n\r\n\t\t\t$sig_tid = array();\r\n\t\t\tforeach($submission->data[51]['value'] as $id){\r\n\t\t\t\t$sig_tid[] = $id;\r\n\t\t\t}\r\n\t\t\r\n\t\t}\r\n\t// for full no dis\r\n\t$form['payment'] = array(\r\n\t\t'#type' => 'fieldset', \r\n\t\t'#title' => t(''), \r\n\t\t'#collapsible' => FALSE, \r\n\t); \r\n\t\r\n\t/* a1 national starts here */\r\n\t$form['payment']['paid_a1national_full'] = array ( \r\n\t'#type' =>'radios', \r\n\t'#title' => t('National Subscription'),\r\n\t'#default_value' => $dues_default_full,\r\n\t'#options' => $dues_list_full,\r\n\t'#states' => array(\r\n\t\t\t  'visible' => array(\t// action to take.\r\n\t\t\t\t':input[name=field_type_category]' => array('value' => 1),\r\n\t\t\t\t':input[name=field_eligible]' => array('value' => 'FULL/NODIS'),\r\n\t\t\t  ),\r\n\t\t\t),\r\n\t);\r\n\t\r\n\t$form['payment']['paid_a1national_red'] = array(\r\n\t'#type' =>'radios', \r\n\t'#title' => t('National Subscription'),\r\n\t'#default_value' => $dues_default_red,\r\n\t'#options' => $dues_list_red,\r\n\t'#states' => array(\r\n\t\t\t  'visible' => array(   // action to take.\r\n\t\t\t\t':input[name=field_type_category]' => array('value' => 1),\r\n\t\t\t\t':input[name=field_eligible]' => array('value' => 'FULL/RED50'),\r\n\t\t\t  ),\r\n\t\t\t),\r\n\t);\r\n\t\r\n\t$form['payment']['paid_a1national_spouse'] = array(\r\n\t'#type' =>'radios', \r\n\t'#title' => t('National Subscription spousal'),\r\n\t// '#default_value' => $submission->data[64]['value'][0],\r\n\t'#default_value' => $dues_default_spouse,\r\n\t'#options' => $dues_list_spouse,\r\n\t'#states' => array(\r\n\t\t\t  'visible' => array(   // action to take.\r\n\t\t\t\t':input[name=field_type_category]' => array('value' => 1),\r\n\t\t\t\t':input[name=field_eligible]' => array('value' => 'FULL/SPOUS'),\r\n\t\t\t  ),\r\n\t\t\t),\r\n\t);\r\n\t\r\n\t$form['payment']['paid_a1national_yr1'] = array(\r\n\t'#type' =>'radios', \r\n\t'#title' => t('National Subscription yr1'),\r\n\t'#default_value' => $dues_default_yr1,\r\n\t'#options' => $dues_list_yr1,\r\n\t'#states' => array(\r\n\t\t\t  'visible' => array(   // action to take.\r\n\t\t\t\t':input[name=field_type_category]' => array('value' => 1),\r\n\t\t\t\t':input[name=field_eligible]' => array('value' => 'FULL/Yr'),\r\n\t\t\t  ),\r\n\t\t\t),\r\n\t);\r\n\t\r\n\t$form['payment']['paid_a1national_yr2'] = array(\r\n\t'#type' =>'radios', \r\n\t'#title' => t('National Subscription yr2'),\r\n\t'#default_value' => $dues_default_yr2,\r\n\t'#options' => $dues_list_yr2,\r\n\t'#states' => array(\r\n\t\t\t  'visible' => array(   // action to take.\r\n\t\t\t\t':input[name=field_type_category]' => array('value' => 1),\r\n\t\t\t\t':input[name=field_eligible]' => array('value' => 'FULL/Yr'),\r\n\t\t\t  ),\r\n\t\t\t),\r\n\t);\r\n\t\r\n\t$form['payment']['paid_a1national_yr3'] = array(\r\n\t'#type' =>'radios', \r\n\t'#title' => t('National Subscription yr3'),\r\n\t'#default_value' => $dues_default_yr3,\r\n\t'#options' => $dues_list_yr3,\r\n\t'#states' => array(\r\n\t\t\t  'visible' => array(   // action to take.\r\n\t\t\t\t':input[name=field_type_category]' => array('value' => 1),\r\n\t\t\t\t':input[name=field_eligible]' => array('value' => 'FULL/Yr'),\r\n\t\t\t  ),\r\n\t\t\t),\r\n\t);\r\n\t/* a1 national end here */\r\n\t/* chapter starts here */\r\n\t$form['payment']['paid_chapter_full'] = array(\r\n\t\t'#type' =>'radios', \r\n\t\t'#title' => t('Chapter full'),\r\n\t\t// '#default_value' => $submission->data[63]['value'][0],\r\n\t\t'#options' => $chapter_list_full,\r\n\t\t'#disabled' => TRUE,\r\n\t\t'#states' => array(\r\n\t\t\t\t  'visible' => array(\t// action to take.\r\n\t\t\t\t\t':input[name=field_type_category]' => array('value' => 1),\r\n\t\t\t\t\t':input[name=field_eligible]' => array('value' => 'FULL/NODIS'),\r\n\t\t\t\t  ),\r\n\t\t\t\t),\r\n\t);\r\n\t\r\n\t$form['payment']['paid_chapter_red'] = array(\r\n\t\t'#type' =>'radios', \r\n\t\t'#title' => t('Chapter red'),\r\n\t\t'#default_value' => $submission->data[63]['value'][0],\r\n\t\t'#options' => $chapter_list_red,\r\n\t\t'#disabled' => TRUE,\r\n\t\t'#states' => array(\r\n\t\t\t\t  'visible' => array(\t// action to take.\r\n\t\t\t\t\t':input[name=field_type_category]' => array('value' => 1),\r\n\t\t\t\t\t':input[name=field_eligible]' => array('value' => 'FULL/RED50'),\r\n\t\t\t\t  ),\r\n\t\t\t\t),\r\n\t);\r\n\t\t\r\n\t$form['payment']['paid_chapter_spouse'] = array(\r\n\t\t'#type' =>'radios', \r\n\t\t'#title' => t('Chapter spouse'),\r\n\t\t'#default_value' => $submission->data[63]['value'][0],\r\n\t\t'#options' => $chapter_list_spouse,\r\n\t\t'#disabled' => TRUE,\r\n\t\t'#states' => array(\r\n\t\t\t\t  'visible' => array(\t// action to take.\r\n\t\t\t\t\t':input[name=field_type_category]' => array('value' => 1),\r\n\t\t\t\t\t':input[name=field_eligible]' => array('value' => 'FULL/SPOUS'),\r\n\t\t\t\t  ),\r\n\t\t\t\t),\r\n\t);\r\n\t\t\r\n\t$form['payment']['paid_chapter_yr1'] = array(\r\n\t\t'#type' =>'radios', \r\n\t\t'#title' => t('Chapter yr1'),\r\n\t\t'#default_value' => $submission->data[63]['value'][0],\r\n\t\t'#options' => $chapter_list_yr1,\r\n\t\t'#disabled' => TRUE,\r\n\t\t'#states' => array(\r\n\t\t\t\t  'visible' => array(\t// action to take.\r\n\t\t\t\t\t':input[name=field_type_category]' => array('value' => 1),\r\n\t\t\t\t\t':input[name=field_eligible]' => array('value' => 'FULL/Yr'),\r\n\t\t\t\t  ),\r\n\t\t\t\t),\r\n\t);\r\n\t\t\r\n\t$form['payment']['paid_chapter_yr2'] = array(\r\n\t\t'#type' =>'radios', \r\n\t\t'#title' => t('Chapter yr2'),\r\n\t\t'#default_value' => $submission->data[63]['value'][0],\r\n\t\t'#options' => $chapter_list_yr2,\r\n\t\t'#disabled' => TRUE,\r\n\t\t'#states' => array(\r\n\t\t\t\t  'visible' => array(\t// action to take.\r\n\t\t\t\t\t':input[name=field_type_category]' => array('value' => 1),\r\n\t\t\t\t\t':input[name=field_eligible]' => array('value' => 'FULL/Yr'),\r\n\t\t\t\t  ),\r\n\t\t\t\t),\r\n\t);\r\n\t\r\n\t$form['payment']['paid_chapter_yr3'] = array(\r\n\t\t'#type' =>'radios', \r\n\t\t'#title' => t('Chapter yr3'),\r\n\t\t'#default_value' => $submission->data[63]['value'][0],\r\n\t\t'#options' => $chapter_list_yr3,\r\n\t\t'#disabled' => TRUE,\r\n\t\t'#states' => array(\r\n\t\t\t\t  'visible' => array(\t// action to take.\r\n\t\t\t\t\t':input[name=field_type_category]' => array('value' => 1),\r\n\t\t\t\t\t':input[name=field_eligible]' => array('value' => 'FULL/Yr'),\r\n\t\t\t\t  ),\r\n\t\t\t\t),\r\n\t);\r\n\t/* chapter end here */\r\n\t\r\n\t$form['payment']['field_sig'] = array(\r\n\t'#type' =>'checkboxes', \r\n\t'#title' => t('Special Interest Groups'),\r\n\t'#default_value' => $sig_tid,\r\n\t'#options' => $sig_list,\r\n\t);\r\n\t\t\r\n\t$form['webform_id'] = array(\r\n\t\t'#type' => 'hidden',\r\n\t\t'#value' => $node->webform_id,\r\n\t); \r\n\t\r\n\t$form['submission_id'] = array(\r\n\t\t'#type' => 'hidden',\r\n\t\t'#value' => $node->submission_id,\r\n\t); \r\n\t\r\n\t$form['submit'] = array(\r\n\t  '#type' => 'submit',\r\n\t  '#value' => t('Submit'),\r\n\t);\r\n\t\r\n\treturn $form;\r\n}\r\n\r\nfunction ava_web_signup_review_form_validate($form, &$form_state) {\r\n\t// print_r($form_state);die();\r\n\tif(!valid_email_address($form_state['values']['field_avawebsignup_email_address'])){\r\n\t\tform_set_error('field_avawebsignup_email_address',\"Please supply a valid email address\");\r\n\t}\r\n\t// this is used when a field type category is veterenarian.\r\n\tif($form_state['values']['field_type_category'] == 1){\r\n\t\tif($form_state['values']['field_university_vet'] == \"\" || empty($form_state['values']['field_university_vet'])){\r\n\t\t\tform_set_error('field_university_vet',\"Please select university\");\r\n\t\t}\r\n\t\tif(!is_numeric($form_state['values']['field_year_of_completion'])) {\r\n\t\t\tform_set_error('field_year_of_completion',\"Please input valid data for year of completion\");\r\n\t\t}\r\n\t\tif($form_state['values']['field_state_board_registered'] == \"\" || empty($form_state['values']['field_state_board_registered'])){\r\n\t\t\tform_set_error('field_state_board_registered',\"Please select state board Registered\");\r\n\t\t}\r\n\t\tif($form_state['values']['field_state_board_registration_n'] == \"\" || empty($form_state['values']['field_state_board_registration_n'])){\r\n\t\t\tform_set_error('field_state_board_registration_n',\"Please input state board registration number\");\r\n\t\t}\r\n\t\tif($form_state['values']['field_eligible'] == 'FULL/SPOUS'){\r\n\t\t\tif($form_state['values']['field_my_spouse_is'] == \"\" || empty($form_state['values']['field_my_spouse_is'])){\r\n\t\t\t\tform_set_error('field_my_spouse_is',\"Please input your spouse name\");\r\n\t\t\t}\r\n\t\t\tif($form_state['values']['field_spouse_s_ava_member_number'] == \"\" || empty($form_state['values']['field_spouse_s_ava_member_number'])){\r\n\t\t\t\tform_set_error('field_spouse_s_ava_member_number',\"Please input your spouse member number\");\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n} \r\n\r\nfunction ava_web_signup_review_form_submit($form, &$form_state) {\r\n\t$webform = node_load($form_state['values']['webform_id']);\r\n\t$submission = webform_get_submission($form_state['values']['webform_id'],$form_state['values']['submission_id']);\r\n\t// $submission->data[65]['value'][0] = $form_state['values']['field_first_name'];\r\n\t$submission->data[4]['value'][0] = $form_state['values']['field_first_name'];\r\n\t$submission->data[5]['value'][0] = $form_state['values']['field_last_name'];\r\n\t$submission->data[6]['value'][0] = $form_state['values']['field_middle_name'];\r\n\t$submission->data[7]['value'][0] = $form_state['values']['field_date_of_birth'];\r\n\t$submission->data[8]['value'][0] = $form_state['values']['field_gender'];\r\n\t$submission->data[11]['value'][0] = $form_state['values']['field_postal_street_address'];\r\n\t$submission->data[9]['value'][0] = $form_state['values']['field_avawebsignup_city'];\r\n\t$submission->data[10]['value'][0] = $form_state['values']['field_postal_state'];\r\n\t$submission->data[12]['value'][0] = $form_state['values']['field_postal_postcode'];\r\n\t$submission->data[13]['value'][0] = $form_state['values']['field_telephone_no'];\r\n\t$submission->data[14]['value'][0] = $form_state['values']['field_mobile_no'];\r\n\t$submission->data[36]['value'][0] = $form_state['values']['field_avawebsignup_email_address'];\r\n\t$submission->data[39]['value'][0] = $form_state['values']['field_decision_factor'];\r\n\t\r\n\t$submission->data[38]['value'][0] = $form_state['values']['field_type_category'];\r\n\t\r\n\t/* if($form_state['values']['field_type_category'] == 0) {\r\n\t\t$submission->data[17]['value'][0] = $form_state['values']['field_university_stud'];\r\n\t\t$submission->data[66]['value'][0] = $form_state['values']['field_degree'];\r\n\t\t$submission->data[67]['value'][0] = $form_state['values']['field_degree_year'];\r\n\t\t$submission->data[42]['value'][0] = $form_state['values']['field_type_of_student_membership'];\r\n\t} */\r\n\tif($form_state['values']['field_type_category'] == 1){\r\n\t\t$submission->data[40]['value'][0] = $form_state['values']['field_university_vet'];\r\n\t\t$submission->data[41]['value'][0] = $form_state['values']['field_year_of_completion'];\r\n\t\t$submission->data[68]['value'][0] = $form_state['values']['field_state_board_registered'];\r\n\t\t$submission->data[69]['value'][0] = $form_state['values']['field_state_board_registration_n'];\r\n\t\t$submission->data[22]['value'][0] = $form_state['values']['field_eligible'];\r\n\t\tif($form_state['values']['field_eligible'] == 'FULL/SPOUS'){\r\n\t\t\t$submission->data[70]['value'][0] = $form_state['values']['field_my_spouse_is'];\r\n\t\t\t$submission->data[71]['value'][0] = $form_state['values']['field_spouse_s_ava_member_number'];\r\n\t\t\tif($form_state['values']['field_spouse_membership_status'] == 1){\r\n\t\t\t\t$submission->data[84]['value'][0] = $form_state['values']['field_spouse_membership_status'];\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif($form_state['values']['field_eligible'] == 'FULL/NODIS'){\r\n\t\t\t$final_a1 = $form_state['values']['paid_a1national_full'];\r\n\t\t} else if($form_state['values']['field_eligible'] == 'FULL/RED50'){\r\n\t\t\t$final_a1 = $form_state['values']['paid_a1national_red'];\r\n\t\t} else if($form_state['values']['field_eligible'] == 'FULL/SPOUS'){\r\n\t\t\t$final_a1 = $form_state['values']['paid_a1national_spouse'];\r\n\t\t} else if($form_state['values']['field_eligible'] == 'FULL/Yr'){\r\n\t\t\t$final_a1 = $form_state['values']['paid_a1national_yr1'];\r\n\t\t}\r\n\t\t\r\n\t\t$submission->data[64]['value'][0] = $final_a1;\r\n\t\t$submission->data[63]['value'][0] = $form_state['values']['field_postal_state'];\r\n\t\t\r\n\t\t$sig_counter = 0;\r\n\t\t/* foreach($form_state['values']['field_sig'] as $key=>$value){\r\n\t\t\tif($value != \"\" && $value != \"0\"){\r\n\t\t\t\t// echo $key.\" = \".$value;\r\n\t\t\t\t$submission->data[51]['value'][$sig_counter] = $value;\r\n\t\t\t\t$sig_counter++;\r\n\t\t\t}\r\n\t\t} */\r\n\t\t$the_sig = array();\r\n\t\tforeach($form_state['values']['field_sig'] as $key=>$value){\r\n\t\t\tif($value != \"\" && $value != \"0\"){\r\n\t\t\t\tarray_push($the_sig,$value);\r\n\t\t\t}\r\n\t\t} \r\n\t\t$submission->data[51]['value'] = $the_sig;\r\n\t}\r\n\t\r\n\t\r\n\tif($form_state['values']['field_membership_status'] == 0) {\r\n\t\t$new_stat = 'rejected';\r\n\t} else if($form_state['values']['field_membership_status'] == 1) {\r\n\t\t$new_stat = 'approved';\r\n\t} else {\r\n\t\t$new_stat = '';\r\n\t}\r\n\t$submission->data[87]['value'][0] = $new_stat;\r\n\t\r\n\t\r\n\t$submission->data[58]['value'][0] = $form_state['values']['field_payment_option'];\r\n\twebform_submission_update($webform, $submission);\r\n\t\r\n} \r\n\r\n?>\r\n\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}